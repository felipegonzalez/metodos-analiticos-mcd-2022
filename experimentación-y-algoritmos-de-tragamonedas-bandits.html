<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Experimentación y algoritmos de tragamonedas (bandits) | Métodos analíticos, ITAM 2022</title>
  <meta name="description" content="Notas para métodos analíticos 2022" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Experimentación y algoritmos de tragamonedas (bandits) | Métodos analíticos, ITAM 2022" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas para métodos analíticos 2022" />
  <meta name="github-repo" content="felipexgonzalez/metodos-analiticos-mcd-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Experimentación y algoritmos de tragamonedas (bandits) | Métodos analíticos, ITAM 2022" />
  
  <meta name="twitter:description" content="Notas para métodos analíticos 2022" />
  

<meta name="author" content="Felipe González" />


<meta name="date" content="2022-05-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="t-sne-y-reducción-de-dimensionalidad.html"/>
<link rel="next" href="referencias.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Métodos Analíticos</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Temario</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#evaluación"><i class="fa fa-check"></i>Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#simlitud-en-dimensión-alta"><i class="fa fa-check"></i>Simlitud en dimensión alta</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#medidas-de-distancia-o-similitud"><i class="fa fa-check"></i>Medidas de distancia o similitud</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#tipos-de-soluciones"><i class="fa fa-check"></i>Tipos de soluciones</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#proyección-y-búsqueda-de-marginales-interesantes"><i class="fa fa-check"></i>Proyección y búsqueda de marginales interesantes</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#proyecciones-globales"><i class="fa fa-check"></i>Proyecciones globales</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#descripción-de-estructura-local"><i class="fa fa-check"></i>Descripción de estructura local</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#inmersiones-embeddings"><i class="fa fa-check"></i>Inmersiones (embeddings)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="frecuentes.html"><a href="frecuentes.html"><i class="fa fa-check"></i><b>2</b> Análisis de conjuntos frecuentes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="frecuentes.html"><a href="frecuentes.html#datos-de-canastas"><i class="fa fa-check"></i><b>2.1</b> Datos de canastas</a></li>
<li class="chapter" data-level="2.2" data-path="frecuentes.html"><a href="frecuentes.html#conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.2</b> Conjuntos frecuentes</a></li>
<li class="chapter" data-level="2.3" data-path="frecuentes.html"><a href="frecuentes.html#monotonicidad-de-conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.3</b> Monotonicidad de conjuntos frecuentes</a></li>
<li class="chapter" data-level="2.4" data-path="frecuentes.html"><a href="frecuentes.html#algoritmo-a-priori"><i class="fa fa-check"></i><b>2.4</b> Algoritmo a-priori</a></li>
<li class="chapter" data-level="2.5" data-path="frecuentes.html"><a href="frecuentes.html#modelos-simples-para-análisis-de-canastas"><i class="fa fa-check"></i><b>2.5</b> Modelos simples para análisis de canastas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-3"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#modelo-de-artículos-independientes"><i class="fa fa-check"></i>Modelo de artículos independientes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="frecuentes.html"><a href="frecuentes.html#soporte-teórico-y-conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.6</b> Soporte teórico y conjuntos frecuentes</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-4"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="frecuentes.html"><a href="frecuentes.html#reglas-de-asociación"><i class="fa fa-check"></i><b>2.7</b> Reglas de asociación</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-5"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-6"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="frecuentes.html"><a href="frecuentes.html#dificultades-en-el-análisis-de-canastas"><i class="fa fa-check"></i><b>2.8</b> Dificultades en el análisis de canastas</a></li>
<li class="chapter" data-level="2.9" data-path="frecuentes.html"><a href="frecuentes.html#otras-medidas-de-calidad-de-reglas"><i class="fa fa-check"></i><b>2.9</b> Otras medidas de calidad de reglas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#hyper-lift-bajo-hipótesis-de-independencia"><i class="fa fa-check"></i>Hyper-lift bajo hipótesis de independencia</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#hyper-lift-para-datos-de-canastas"><i class="fa fa-check"></i>Hyper-lift para datos de canastas</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="frecuentes.html"><a href="frecuentes.html#selección-de-reglas"><i class="fa fa-check"></i><b>2.10</b> Selección de reglas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-canastas-grandes"><i class="fa fa-check"></i>Ejemplo: canastas grandes</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="frecuentes.html"><a href="frecuentes.html#búsqueda-de-reglas-especializadas"><i class="fa fa-check"></i><b>2.11</b> Búsqueda de reglas especializadas</a></li>
<li class="chapter" data-level="2.12" data-path="frecuentes.html"><a href="frecuentes.html#visualización-de-asociaciones"><i class="fa fa-check"></i><b>2.12</b> Visualización de asociaciones</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-canastas"><i class="fa fa-check"></i><b>2.12.1</b> Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="frecuentes.html"><a href="frecuentes.html#otras-aplicaciones"><i class="fa fa-check"></i><b>2.13</b> Otras aplicaciones</a></li>
<li class="chapter" data-level="2.14" data-path="frecuentes.html"><a href="frecuentes.html#ejercicios"><i class="fa fa-check"></i><b>2.14</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="similitud.html"><a href="similitud.html"><i class="fa fa-check"></i><b>3</b> Similitud y vecinos cercanos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="similitud.html"><a href="similitud.html#similitud-de-conjuntos"><i class="fa fa-check"></i><b>3.1</b> Similitud de conjuntos</a></li>
<li class="chapter" data-level="3.2" data-path="similitud.html"><a href="similitud.html#representación-de-documentos-como-conjuntos"><i class="fa fa-check"></i><b>3.2</b> Representación de documentos como conjuntos</a></li>
<li class="chapter" data-level="3.3" data-path="similitud.html"><a href="similitud.html#representación-matricial"><i class="fa fa-check"></i><b>3.3</b> Representación matricial</a></li>
<li class="chapter" data-level="3.4" data-path="similitud.html"><a href="similitud.html#minhash-y-reducción-probabilística-de-dimensionalidad"><i class="fa fa-check"></i><b>3.4</b> Minhash y reducción probabilística de dimensionalidad</a></li>
<li class="chapter" data-level="3.5" data-path="similitud.html"><a href="similitud.html#agrupando-textos-de-similitud-alta"><i class="fa fa-check"></i><b>3.5</b> Agrupando textos de similitud alta</a></li>
<li class="chapter" data-level="3.6" data-path="similitud.html"><a href="similitud.html#ejemplo-tweets"><i class="fa fa-check"></i><b>3.6</b> Ejemplo: tweets</a></li>
<li class="chapter" data-level="3.7" data-path="similitud.html"><a href="similitud.html#verificar-si-un-nuevo-elemento-es-duplicado"><i class="fa fa-check"></i><b>3.7</b> Verificar si un nuevo elemento es duplicado</a></li>
<li class="chapter" data-level="3.8" data-path="similitud.html"><a href="similitud.html#controlando-la-sensibilidad-y-umbral-de-similitud"><i class="fa fa-check"></i><b>3.8</b> Controlando la sensibilidad y umbral de similitud</a></li>
<li class="chapter" data-level="3.9" data-path="similitud.html"><a href="similitud.html#distancia-euclideana-y-lsh"><i class="fa fa-check"></i><b>3.9</b> Distancia euclideana y LSH</a></li>
<li class="chapter" data-level="3.10" data-path="similitud.html"><a href="similitud.html#locality-sensitive-hashing-lsh"><i class="fa fa-check"></i><b>3.10</b> Locality Sensitive Hashing (LSH)</a></li>
<li class="chapter" data-level="3.11" data-path="similitud.html"><a href="similitud.html#lsh-para-imágenes"><i class="fa fa-check"></i><b>3.11</b> LSH para imágenes</a></li>
<li class="chapter" data-level="3.12" data-path="similitud.html"><a href="similitud.html#joins-por-similitud"><i class="fa fa-check"></i><b>3.12</b> Joins por similitud</a></li>
<li class="chapter" data-level="3.13" data-path="similitud.html"><a href="similitud.html#ejemplo-entity-matching"><i class="fa fa-check"></i><b>3.13</b> Ejemplo: entity matching</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html"><i class="fa fa-check"></i><b>4</b> DVS y reducción de dimensionalidad</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#descomposición-aditiva-en-matrices-de-rango-1"><i class="fa fa-check"></i><b>4.1</b> Descomposición aditiva en matrices de rango 1</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#matrices-de-rango-1"><i class="fa fa-check"></i><b>4.1.1</b> Matrices de rango 1</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-una-matriz-de-rango-1-de-preferencias"><i class="fa fa-check"></i>Ejemplo: una matriz de rango 1 de preferencias</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#aproximación-con-matrices-de-rango-1."><i class="fa fa-check"></i><b>4.2</b> Aproximación con matrices de rango 1.</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-12"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="4.2.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#suma-de-matrices-de-rango-1."><i class="fa fa-check"></i><b>4.2.1</b> Suma de matrices de rango 1.</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-películas"><i class="fa fa-check"></i>Ejemplo: películas</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#aproximación-con-matrices-de-rango-bajo"><i class="fa fa-check"></i><b>4.3</b> Aproximación con matrices de rango bajo</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#discusión-aproximación-de-rango-1."><i class="fa fa-check"></i><b>4.3.1</b> Discusión: aproximación de rango 1.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#interpetación-de-vectores-singulares"><i class="fa fa-check"></i><b>4.4</b> Interpetación de vectores singulares</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-14"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="4.4.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#discusión-aproximaciones-de-rango-más-alto"><i class="fa fa-check"></i><b>4.4.1</b> Discusión: aproximaciones de rango más alto</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-15"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#descomposición-en-valores-singulares-svd-o-dvs"><i class="fa fa-check"></i><b>4.5</b> Descomposición en valores singulares (SVD o DVS)</a></li>
<li class="chapter" data-level="4.6" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#más-de-interpretación-geométrica"><i class="fa fa-check"></i><b>4.6</b> Más de interpretación geométrica</a></li>
<li class="chapter" data-level="4.7" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#svd-para-películas-de-netflix"><i class="fa fa-check"></i><b>4.7</b> SVD para películas de netflix</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#calidad-de-representación-de-svd."><i class="fa fa-check"></i><b>4.7.1</b> Calidad de representación de SVD.</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-16"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#componentes-principales"><i class="fa fa-check"></i><b>4.8</b> Componentes principales</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#varianza-en-componentes-principales"><i class="fa fa-check"></i>Varianza en componentes principales</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#centrar-o-no-centrar-por-columna"><i class="fa fa-check"></i>¿Centrar o no centrar por columna?</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-resultados-similares"><i class="fa fa-check"></i>Ejemplo: resultados similares</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplos-donde-es-buena-idea-centrar"><i class="fa fa-check"></i>Ejemplos: donde es buena idea centrar</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-donde-no-centrar-funciona-bien"><i class="fa fa-check"></i>Ejemplo: donde no centrar funciona bien</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#otros-tipos-de-centrado"><i class="fa fa-check"></i>Otros tipos de centrado</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#reescalando-variables"><i class="fa fa-check"></i>Reescalando variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html"><i class="fa fa-check"></i><b>5</b> Sistemas de recomendación y filtrado colaborativo</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#enfoques-de-recomendación"><i class="fa fa-check"></i><b>5.1</b> Enfoques de recomendación</a></li>
<li class="chapter" data-level="5.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#datos"><i class="fa fa-check"></i><b>5.2</b> Datos</a>
<ul>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-18"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#modelos-de-referencia-y-evaluación"><i class="fa fa-check"></i><b>5.3</b> Modelos de referencia y evaluación</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#evaluación-de-predicciones"><i class="fa fa-check"></i><b>5.3.1</b> Evaluación de predicciones</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-datos-de-netflix"><i class="fa fa-check"></i>Ejemplo: datos de Netflix</a></li>
<li class="chapter" data-level="5.3.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#opcional-efectos-en-análisis-de-heterogeneidad-en-uso-de-escala"><i class="fa fa-check"></i><b>5.3.2</b> (Opcional) Efectos en análisis de heterogeneidad en uso de escala</a></li>
<li class="chapter" data-level="5.3.3" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>5.3.3</b> Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#modelo-de-referencia"><i class="fa fa-check"></i><b>5.4</b> Modelo de referencia</a>
<ul>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejercicio-modelo-de-referencia-para-netflix"><i class="fa fa-check"></i>Ejercicio: modelo de referencia para Netflix</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#filtrado-colaborativo-similitud"><i class="fa fa-check"></i><b>5.5</b> Filtrado colaborativo: similitud</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#simitems"><i class="fa fa-check"></i><b>5.5.1</b> Cálculo de similitud entre usuarios/películas</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-19"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-cómo-se-ven-las-calificaciones-de-películas-similaresno-similares"><i class="fa fa-check"></i>Ejemplo: ¿cómo se ven las calificaciones de películas similares/no similares?</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejercicio-4"><i class="fa fa-check"></i>Ejercicio</a></li>
<li class="chapter" data-level="5.5.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#implementación"><i class="fa fa-check"></i><b>5.5.2</b> Implementación</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html"><i class="fa fa-check"></i><b>6</b> Dimensiones latentes para recomendación</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>6.0.1</b> Ejemplo: una dimensión latente</a></li>
<li class="chapter" data-level="6.0.2" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>6.0.2</b> Ejemplo: dos dimensiones latentes</a></li>
<li class="chapter" data-level="6.0.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#combinación-con-modelo-base"><i class="fa fa-check"></i><b>6.0.3</b> Combinación con modelo base</a></li>
<li class="chapter" data-level="6.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#factorización-de-matrices"><i class="fa fa-check"></i><b>6.1</b> Factorización de matrices</a></li>
<li class="chapter" data-level="6.2" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#mínimos-cuadrados-alternados"><i class="fa fa-check"></i><b>6.2</b> Mínimos cuadrados alternados</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#mínimos-cuadrados-alternados-con-regularización"><i class="fa fa-check"></i><b>6.2.1</b> Mínimos cuadrados alternados con regularización</a></li>
<li class="chapter" data-level="" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejercicio-5"><i class="fa fa-check"></i>Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#retroalimentación-implícita"><i class="fa fa-check"></i><b>6.3</b> Retroalimentación implícita</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejemplo-20"><i class="fa fa-check"></i><b>6.3.1</b> Ejemplo</a></li>
<li class="chapter" data-level="6.3.2" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejemplo-21"><i class="fa fa-check"></i><b>6.3.2</b> Ejemplo</a></li>
<li class="chapter" data-level="6.3.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#evaluación-para-modelos-implícitos"><i class="fa fa-check"></i><b>6.3.3</b> Evaluación para modelos implícitos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html"><i class="fa fa-check"></i><b>7</b> Pagerank y análisis de redes</a>
<ul>
<li class="chapter" data-level="7.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#introducción"><i class="fa fa-check"></i><b>7.1</b> Introducción</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#centralidad-en-redes"><i class="fa fa-check"></i><b>7.1.1</b> Centralidad en redes</a></li>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejemplo-de-moviegalaxies.com-pulp-fiction"><i class="fa fa-check"></i>Ejemplo de Moviegalaxies.com: Pulp Fiction</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#tipos-de-redes-y-su-representación"><i class="fa fa-check"></i><b>7.2</b> Tipos de redes y su representación</a></li>
<li class="chapter" data-level="7.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#visualización-de-redes"><i class="fa fa-check"></i><b>7.3</b> Visualización de redes</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejercicio-6"><i class="fa fa-check"></i><b>7.3.1</b> Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medidas-de-centralidad-para-redes"><i class="fa fa-check"></i><b>7.4</b> Medidas de centralidad para redes</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#grado"><i class="fa fa-check"></i><b>7.4.1</b> Grado</a></li>
<li class="chapter" data-level="7.4.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medida-de-centralidad-betweeness-o-intermediación"><i class="fa fa-check"></i><b>7.4.2</b> Medida de centralidad: <em>Betweeness</em> o <em>Intermediación</em></a></li>
<li class="chapter" data-level="7.4.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medida-de-centralidad-cercanía"><i class="fa fa-check"></i><b>7.4.3</b> Medida de centralidad: Cercanía</a></li>
<li class="chapter" data-level="7.4.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#centralidad-de-eigenvector"><i class="fa fa-check"></i><b>7.4.4</b> Centralidad de eigenvector</a></li>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matrices-irreducibles-y-gráficas-fuertemente-conexas"><i class="fa fa-check"></i>Matrices irreducibles y gráficas fuertemente conexas</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#gráficas-dirigidas"><i class="fa fa-check"></i><b>7.5</b> Gráficas dirigidas</a>
<ul>
<li><a href="pagerank-y-análisis-de-redes.html#ejemplos-qué-pasa-si-a-es-no-reducible">Ejemplos: ¿qué pasa si <span class="math inline">\(A\)</span> es no reducible?</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank"><i class="fa fa-check"></i><b>7.6</b> Pagerank</a>
<ul>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejemplo-24"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="7.6.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#la-matriz-m-es-estocástica"><i class="fa fa-check"></i><b>7.6.1</b> La matriz <span class="math inline">\(M\)</span> es estocástica</a></li>
<li class="chapter" data-level="7.6.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#primeras-dificultades"><i class="fa fa-check"></i><b>7.6.2</b> Primeras dificultades</a></li>
<li class="chapter" data-level="7.6.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#el-proceso-estocástico-cadena-de-markov-asociado-al-pagerank-versión-simple"><i class="fa fa-check"></i><b>7.6.3</b> El proceso estocástico (cadena de Markov) asociado al Pagerank, versión simple</a></li>
<li class="chapter" data-level="7.6.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matriz-de-transición"><i class="fa fa-check"></i><b>7.6.4</b> Matriz de transición</a></li>
<li class="chapter" data-level="7.6.5" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#distribución-de-equilibrio-versión-simple"><i class="fa fa-check"></i><b>7.6.5</b> Distribución de equilibrio (versión simple)</a></li>
<li class="chapter" data-level="7.6.6" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#distribución-de-equilibrio-y-probabilidades-a-largo-plazo"><i class="fa fa-check"></i><b>7.6.6</b> Distribución de equilibrio y probabilidades a largo plazo</a></li>
<li class="chapter" data-level="7.6.7" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matriz-de-transición-a-k-pasos"><i class="fa fa-check"></i><b>7.6.7</b> Matriz de transición a <span class="math inline">\(k\)</span> pasos</a></li>
<li class="chapter" data-level="7.6.8" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank-teletransportaciónperturbación-de-la-matriz-m"><i class="fa fa-check"></i><b>7.6.8</b> Pagerank: teletransportación/perturbación de la matriz <span class="math inline">\(M\)</span></a></li>
<li class="chapter" data-level="7.6.9" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank-para-buscador"><i class="fa fa-check"></i><b>7.6.9</b> Pagerank para buscador</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html"><i class="fa fa-check"></i><b>8</b> Detección de comunidades</a>
<ul>
<li class="chapter" data-level="8.1" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html#modularidad"><i class="fa fa-check"></i><b>8.1</b> Modularidad</a></li>
<li class="chapter" data-level="8.2" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html#algoritmo-miope-fast-greedy"><i class="fa fa-check"></i><b>8.2</b> Algoritmo miope (fast greedy)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html"><i class="fa fa-check"></i><b>9</b> Modelos de lenguaje y n-gramas</a>
<ul>
<li class="chapter" data-level="9.1" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#ejemplo-modelo-de-canal-ruidoso"><i class="fa fa-check"></i><b>9.1</b> Ejemplo: Modelo de canal ruidoso</a></li>
<li class="chapter" data-level="9.2" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#corpus-y-vocabulario"><i class="fa fa-check"></i><b>9.2</b> Corpus y vocabulario</a></li>
<li class="chapter" data-level="9.3" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#modelos-de-lenguaje-n-gramas"><i class="fa fa-check"></i><b>9.3</b> Modelos de lenguaje: n-gramas</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#modelo-generativo-de-n-gramas"><i class="fa fa-check"></i><b>9.3.1</b> Modelo generativo de n-gramas</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#modelo-de-n-gramas-usando-conteos"><i class="fa fa-check"></i><b>9.4</b> Modelo de n-gramas usando conteos</a></li>
<li class="chapter" data-level="9.5" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#notas-de-periódico-modelo-de-n-gramas-simples."><i class="fa fa-check"></i><b>9.5</b> Notas de periódico: modelo de n-gramas simples.</a>
<ul>
<li class="chapter" data-level="" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#problema-de-los-ceros"><i class="fa fa-check"></i>Problema de los ceros</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#evaluación-de-modelos"><i class="fa fa-check"></i><b>9.6</b> Evaluación de modelos</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#generación-de-texto"><i class="fa fa-check"></i><b>9.6.1</b> Generación de texto</a></li>
<li class="chapter" data-level="9.6.2" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#evaluación-de-modelos-perplejidad"><i class="fa fa-check"></i><b>9.6.2</b> Evaluación de modelos: perplejidad</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#suavizamiento-de-conteos-otros-métodos"><i class="fa fa-check"></i><b>9.7</b> Suavizamiento de conteos: otros métodos</a>
<ul>
<li class="chapter" data-level="" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#desempeño"><i class="fa fa-check"></i>Desempeño</a></li>
</ul></li>
<li class="chapter" data-level="9.8" data-path="modelos-de-lenguaje-y-n-gramas.html"><a href="modelos-de-lenguaje-y-n-gramas.html#ejemplo-corrector-de-ortografía"><i class="fa fa-check"></i><b>9.8</b> Ejemplo: Corrector de ortografía</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html"><i class="fa fa-check"></i><b>10</b> Representación de palabras y word2vec</a>
<ul>
<li class="chapter" data-level="10.1" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#modelo-de-red-neuronal"><i class="fa fa-check"></i><b>10.1</b> Modelo de red neuronal</a>
<ul>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#ejemplo-32"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#representación-de-palabras"><i class="fa fa-check"></i><b>10.2</b> Representación de palabras</a></li>
<li class="chapter" data-level="10.3" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#modelos-de-word2vec"><i class="fa fa-check"></i><b>10.3</b> Modelos de word2vec</a>
<ul>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#arquitectura-continuous-bag-of-words"><i class="fa fa-check"></i>Arquitectura continuous bag-of-words</a></li>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#arquitectura-skip-grams"><i class="fa fa-check"></i>Arquitectura skip-grams</a></li>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#muestreo-negativo"><i class="fa fa-check"></i>Muestreo negativo</a></li>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#ejemplo-33"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#esprep"><i class="fa fa-check"></i><b>10.4</b> Espacio de representación de palabras</a>
<ul>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#geometría-en-el-espacio-de-representaciones"><i class="fa fa-check"></i>Geometría en el espacio de representaciones</a></li>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#geometría-en-el-espacio-de-representaciones-1"><i class="fa fa-check"></i>Geometría en el espacio de representaciones</a></li>
<li class="chapter" data-level="" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#evaluación-de-calidad-de-modelos"><i class="fa fa-check"></i>Evaluación de calidad de modelos</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="representación-de-palabras-y-word2vec.html"><a href="representación-de-palabras-y-word2vec.html#usos-de-representaciones-distribuidas"><i class="fa fa-check"></i><b>10.5</b> Usos de representaciones distribuidas</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="t-sne-y-reducción-de-dimensionalidad.html"><a href="t-sne-y-reducción-de-dimensionalidad.html"><i class="fa fa-check"></i><b>11</b> t-SNE y reducción de dimensionalidad</a>
<ul>
<li class="chapter" data-level="" data-path="t-sne-y-reducción-de-dimensionalidad.html"><a href="t-sne-y-reducción-de-dimensionalidad.html#ejemplo-34"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="11.0.1" data-path="t-sne-y-reducción-de-dimensionalidad.html"><a href="t-sne-y-reducción-de-dimensionalidad.html#sne"><i class="fa fa-check"></i><b>11.0.1</b> SNE</a></li>
<li class="chapter" data-level="11.0.2" data-path="t-sne-y-reducción-de-dimensionalidad.html"><a href="t-sne-y-reducción-de-dimensionalidad.html#minimización-para-sne"><i class="fa fa-check"></i><b>11.0.2</b> Minimización para SNE</a></li>
<li class="chapter" data-level="" data-path="t-sne-y-reducción-de-dimensionalidad.html"><a href="t-sne-y-reducción-de-dimensionalidad.html#ejemplo-35"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><i class="fa fa-check"></i><b>12</b> Experimentación y algoritmos de tragamonedas (bandits)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#causalidad-y-contrafactuales"><i class="fa fa-check"></i><b>12.1</b> Causalidad y contrafactuales</a></li>
<li class="chapter" data-level="12.2" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#experimentos-ab"><i class="fa fa-check"></i><b>12.2</b> Experimentos A/B</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#aleatorización-en-experimentos."><i class="fa fa-check"></i><b>12.2.1</b> Aleatorización en experimentos.</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#costos-de-experimentación"><i class="fa fa-check"></i><b>12.3</b> Costos de experimentación</a></li>
<li class="chapter" data-level="12.4" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#algoritmos-de-tragamonedas"><i class="fa fa-check"></i><b>12.4</b> Algoritmos de tragamonedas</a></li>
<li class="chapter" data-level="12.5" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#algoritmo-epsilon-miope"><i class="fa fa-check"></i><b>12.5</b> Algoritmo epsilon-miope</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#comparación-con-experimentación-clásica"><i class="fa fa-check"></i><b>12.5.1</b> Comparación con experimentación clásica</a></li>
<li class="chapter" data-level="" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#desventajas-del-algoritmo-miope"><i class="fa fa-check"></i>Desventajas del algoritmo miope</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#algoritmo-softmax"><i class="fa fa-check"></i><b>12.6</b> Algoritmo softmax</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#desventajas-del-algoritmo-softmax"><i class="fa fa-check"></i><b>12.6.1</b> Desventajas del algoritmo softmax</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#el-algoritmo-de-cota-superior-de-confianza-ucb"><i class="fa fa-check"></i><b>12.7</b> El algoritmo de cota superior de confianza (UCB)</a></li>
<li class="chapter" data-level="12.8" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#tragamonedas-bayesianos"><i class="fa fa-check"></i><b>12.8</b> Tragamonedas bayesianos</a>
<ul>
<li class="chapter" data-level="12.8.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#ejemplo-bernoulli"><i class="fa fa-check"></i><b>12.8.1</b> Ejemplo bernoulli</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#otros-aspectos-de-la-experimentación-y-máquinas-tragamonedas"><i class="fa fa-check"></i><b>12.9</b> Otros aspectos de la experimentación y máquinas tragamonedas</a>
<ul>
<li class="chapter" data-level="" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#pruebas-aa"><i class="fa fa-check"></i>Pruebas A/A</a></li>
<li class="chapter" data-level="" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#métricas-de-éxito-defectuosas"><i class="fa fa-check"></i>Métricas de éxito defectuosas</a></li>
<li class="chapter" data-level="12.9.1" data-path="experimentación-y-algoritmos-de-tragamonedas-bandits.html"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#tragamonedas-contextuales"><i class="fa fa-check"></i><b>12.9.1</b> Tragamonedas contextuales</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/felipegonzalez/metodos-analiticos-mcd-2022" target="blank">Repositorio de Github</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Métodos analíticos, ITAM 2022</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="experimentación-y-algoritmos-de-tragamonedas-bandits" class="section level1" number="12">
<h1><span class="header-section-number">12</span> Experimentación y algoritmos de tragamonedas (bandits)</h1>
<p>En esta sección consideramos el problema de hacer cambios
en un sitio web, por ejemplo, con el fin de mejorar métricas
como conversiones, ventas, tráfico, tasas de click-through, etc.</p>
<div id="causalidad-y-contrafactuales" class="section level2" number="12.1">
<h2><span class="header-section-number">12.1</span> Causalidad y contrafactuales</h2>
<p>Para entender por qué este problema no es trivial, consideremos aquí un caso en
que alguien hace una modificación del algoritmo de búsquedas de una tienda online. Por ejemplo: quizá estamos pensando
en usar un nuevo algoritmo para ordenar los resultados de una búsqueda
en la tienda.</p>
<p>En algunos casos es claro que nuestro cambio representa una mejora (por ejemplo, cuando arreglamos un <em>bug</em>), pero muchas veces no estamos muy
seguros de que el cambio vaya a ser beneficioso. En este ejemplo,
podriamos tomar como métrica de interés el número de conversiones: cuántas de las búsquedas terminan en acciones positivas (compras, añadir a canasta, etc.)</p>
<p>Una primera aproximación es hacer el cambio, y observar las métricas de interés.
Sin embargo, los números resultantes <strong>pueden ser difíciles de interpretar</strong>: por ejemplo,
si hicimos el cambio justo antes de navidad, es
normal esperar más compras resultantes de las búsquedas, pues en promedio
la gente que llega está más decidida a comprar que en otros periodos.
Esto no quiere decir que nuestro cambio fue positivo, pues quizá las
ventas hubieran sido aún mayores si no hubiéramos hecho el cambio.</p>
<p>Otra aproximación simplista en los negocios es comparar <em>year over year</em>, por ejemplo, comparamos esta navidad con las anteriores. Esto también da un
resultado difícil de interpretar, pues estamos comparando dos periodos
alejados en el tiempo.</p>

<div class="resumen">
Desde el punto de vista conceptual, lo que quisiéramos saber es <em>cómo
nos hubiera ido</em> si no hubiéramos hecho el cambio. Si supiéramos este
resultado, podríamos comparar directamente y evaluar el efecto de nuestro
cambio. A este escenario típicamente no observado le llamamos <strong>contrafactual</strong>, y es útil para razonar en este tipo de problemas.
</div>
<div id="ejemplo-36" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>En este ejemplo consideramos un escenario posible (simulado)</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb981-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(CausalImpact)){</span>
<span id="cb981-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">&quot;CausalImpact&quot;</span>)</span>
<span id="cb981-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb981-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(CausalImpact)</span>
<span id="cb981-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb981-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-6" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">+</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fl">0.999</span>), <span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb981-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fl">1.2</span> <span class="sc">*</span> x1 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>) <span class="co"># ventas simuladas</span></span>
<span id="cb981-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-8" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">71</span><span class="sc">:</span><span class="dv">100</span>] <span class="ot">&lt;-</span> y[<span class="dv">71</span><span class="sc">:</span><span class="dv">100</span>] <span class="sc">+</span> <span class="dv">7</span> <span class="co"># efecto de la intervención en el periodo 70.</span></span>
<span id="cb981-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-9" aria-hidden="true" tabindex="-1"></a>time.points <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2014-01-01&quot;</span>), <span class="at">by =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb981-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-10" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">zoo</span>(<span class="fu">cbind</span>(y, x1), time.points)</span>
<span id="cb981-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-11" aria-hidden="true" tabindex="-1"></a>pre.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2014-01-01&quot;</span>, <span class="st">&quot;2014-03-11&quot;</span>))</span>
<span id="cb981-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-12" aria-hidden="true" tabindex="-1"></a>post.period <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">&quot;2014-03-12&quot;</span>, <span class="st">&quot;2014-04-10&quot;</span>))</span>
<span id="cb981-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-13" aria-hidden="true" tabindex="-1"></a>impact <span class="ot">&lt;-</span> <span class="fu">CausalImpact</span>(data, pre.period, post.period)</span>
<span id="cb981-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb981-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(impact, <span class="at">metrics=</span><span class="st">&quot;original&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="images/causal-impact.png" alt="" />
<p class="caption">Ejemplo: causalImpact</p>
</div>
<p>La línea sólida son las ventas observadas (diarias). La línea vertical señala
cuando se hizo la intervención. La línea punteada es el contrafactual estimado: cuáles hubieran sido las
ventas si no hubiéramos hecho la intervención. Nótese que un análisis superficial que sólo considera las ventas observadas podría concluir que la intervención no tuvo efecto, pero en realidad la situación es muy diferente: la intervención sostuvo las ventas durante el mes analizado.</p>
<ul>
<li><p>Este análisis se basa en la construcción de <strong>contrafactuales</strong> con modelos dinámicos bayesianos (la idea general
a veces se llama “control sintético.” La idea es: supongamos que nuestra métrica
de interés es <span class="math inline">\(y\)</span>. Encontramos una covariable <span class="math inline">\(x_1\)</span>, y construimos y validamos un modelo
(con los datos anteriores a la intervención) para <span class="math inline">\(y\)</span> con <span class="math inline">\(x_1\)</span> como covariable.
La covariable <span class="math inline">\(x_1\)</span> debe ser escogida de forma que <strong>tengamos evidencia fuerte</strong> de que esta variable <strong>no será afectada por la intervención</strong>. De este forma, el contrafactual después de la intervención se construye haciendo la predicción de <span class="math inline">\(y\)</span> basada en <span class="math inline">\(x_1\)</span>, y nos da una idea de lo que hubiera pasado sin la intervención.</p></li>
<li><p>Por ejemplo, en algunos casos podemos escoger <span class="math inline">\(x_1\)</span> como las ventas de la región <span class="math inline">\(A\)</span>, <span class="math inline">\(y\)</span> son la ventas de la región <span class="math inline">\(B\)</span>. Nuestra intervención (por ejemplo, una promoción) la aplicamos solamente en la región <span class="math inline">\(B\)</span>. Entonces el modelo basado de <span class="math inline">\(y\)</span> en <span class="math inline">\(x_1\)</span> (ventas región <span class="math inline">\(A\)</span>, que no es intervenida) nos da el contrafactual para comparar.</p></li>
</ul>
<p>Estas ideas son del
método propuesto en <a href="https://github.com/google/CausalImpact">CausalImpact</a>,
<span class="citation">(<a href="#ref-causalimpact" role="doc-biblioref">Brodersen et al. 2015</a>)</span>. Se puede ver como una versión más sofisticada y poderosa
del método de diferencia de diferencias. También puedes leer <span class="citation">(<a href="#ref-varian" role="doc-biblioref">Varian 2016</a>)</span>, una muy buena
introducción a la estimación de efectos causales en marketing.</p>
</div>
</div>
<div id="experimentos-ab" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Experimentos A/B</h2>
<p>Cuando consideramos cambios a un servicio web, y queremos entender el
efecto en los usuarios, podemos considerar otra estrategia para
estimar el efecto de nuestras intervenciones.</p>
<p>Considerando que tenemos un número relativamente grande de visitas,
podemos hacer un <strong>experimento A/B</strong>:
seleccionamos al azar un subconjunto de usuarios para mostrarles</p>
<ul>
<li>el sitio <strong>con</strong> la intervención (grupo B), y al resto les mostramos</li>
<li>el sitio <strong>sin</strong> la intervención (grupo A).</li>
</ul>
<p>Como seleccionamos al azar
los usuarios, las poblaciones son comparables en cuanto a demográficos y
tipos de usuarios, y no tenemos problemas de hacer comparaciones fuera de temporalidad.
Comparamos los resultados de los dos grupos
para evaluar el efecto de la intervención.</p>
<p>Nótese que esta estrategia puede no funcionar bien si usamos una asignación
a grupos que no es aleatoria. Un ejemplo típico es considerar el efecto
de un anuncio de <em>paid search</em>. Podemos comparar usuarios que recibieron
el anuncio con otros que no lo recibieron, y ver las ventas en cada grupo. Esta comparación típicamente <em>no</em> resulta en una buena estimación
de la cantidad que nos interesa, pues los que recibieron el anuncio
de <em>paid search</em> han mostrado más interés en hacer una compra que los que
no lo recibieron (por eso recibieron el anuncio!)</p>
<div id="ejemplo-37" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Veamos un ejercicio de simulación. Consideremos dos grupos de usuarios:
interesados y no interesados, que es una variable que no observamos.
Suponemos que las ventas en cada grupo, independientemente de nuestras
acciones, son más altas para usuarios interesados que no interesados:</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb982-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb982-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb982-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb982-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb982-3" aria-hidden="true" tabindex="-1"></a>compras_int_alto <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1000</span>, <span class="dv">5</span>)</span>
<span id="cb982-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb982-4" aria-hidden="true" tabindex="-1"></a>compras_int_bajo <span class="ot">&lt;-</span> <span class="fu">rpois</span>(<span class="dv">1000</span>, <span class="dv">1</span>)</span>
<span id="cb982-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb982-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(compras_int_alto)</span></code></pre></div>
<pre><code>## [1] 4.935</code></pre>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb984-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(compras_int_bajo)</span></code></pre></div>
<pre><code>## [1] 0.976</code></pre>
<p>Nótese que nosotros en principio no podemos hacer esta comparación,
pues <em>interés</em> no es una medida que tengamos disponible fácilmente.</p>
<p>Ahora supongamos ahora que las probabilidades de recibir el anuncio de <em>paid search</em> es más alto para los interesados que los no interesados (pues usuarios interesados hacen más búsquedas relevantes):</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb986-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb986-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb986-2" aria-hidden="true" tabindex="-1"></a>ps_int_alto <span class="ot">&lt;-</span> <span class="fl">0.04</span></span>
<span id="cb986-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb986-3" aria-hidden="true" tabindex="-1"></a>ps_int_bajo <span class="ot">&lt;-</span> <span class="fl">0.01</span></span></code></pre></div>
<p>Y simulemos los datos que observaríamos. En primer lugar,
simulamos qué usuarios reciben o no anuncios:</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb987-1" aria-hidden="true" tabindex="-1"></a>anuncio_int_alto <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, ps_int_alto) </span>
<span id="cb987-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb987-2" aria-hidden="true" tabindex="-1"></a>anuncio_int_bajo <span class="ot">&lt;-</span>  <span class="fu">rbinom</span>(<span class="dv">1000</span>, <span class="dv">1</span>, ps_int_bajo)</span>
<span id="cb987-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb987-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anuncio_int_alto)</span></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 0</code></pre>
<p>Y juntamos los datos que observaríamos:</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb989-1" aria-hidden="true" tabindex="-1"></a>datos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">anuncio_ps =</span> <span class="fu">c</span>(anuncio_int_alto, anuncio_int_bajo),</span>
<span id="cb989-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb989-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">compras =</span> <span class="fu">c</span>(compras_int_alto, compras_int_bajo))</span>
<span id="cb989-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb989-3" aria-hidden="true" tabindex="-1"></a>datos</span></code></pre></div>
<pre><code>## # A tibble: 2,000 × 2
##    anuncio_ps compras
##         &lt;int&gt;   &lt;int&gt;
##  1          0       1
##  2          0       7
##  3          0       3
##  4          0       7
##  5          0       6
##  6          0       3
##  7          0      10
##  8          0       2
##  9          0       5
## 10          0       5
## # … with 1,990 more rows</code></pre>
<p>Si hacemos una comparación entre grupos, obtenemos:</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb991-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span> <span class="fu">group_by</span>(anuncio_ps) <span class="sc">|&gt;</span> </span>
<span id="cb991-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb991-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_compras =</span> <span class="fu">round</span>(<span class="fu">mean</span>(compras), <span class="dv">2</span>), </span>
<span id="cb991-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb991-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb991-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb991-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">ee =</span> (<span class="fu">sd</span>(compras)<span class="sc">/</span><span class="fu">sqrt</span>(n)) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   anuncio_ps media_compras     n    ee
##        &lt;int&gt;         &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
## 1          0          2.94  1962  0.06
## 2          1          3.95    38  0.41</code></pre>
<p>Y vemos que el grupo que recibió anuncio tiene más compras promedio
que el que no recibió anuncio. Sin embargo, en esta simulación
el anuncio no tiene ningún efecto.</p>
<p>Si distribuyéramos al azar la asignación del anuncio,</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb993-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb993-1" aria-hidden="true" tabindex="-1"></a>datos <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">asigna =</span> <span class="fu">rbinom</span>(<span class="dv">2000</span>, <span class="dv">1</span>, <span class="fl">0.05</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb993-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb993-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(asigna) <span class="sc">|&gt;</span> </span>
<span id="cb993-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb993-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_compras =</span> <span class="fu">round</span>(<span class="fu">mean</span>(compras), <span class="dv">2</span>), </span>
<span id="cb993-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb993-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="fu">n</span>(), </span>
<span id="cb993-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb993-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ee =</span> (<span class="fu">sd</span>(compras)<span class="sc">/</span><span class="fu">sqrt</span>(n)) <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   asigna media_compras     n    ee
##    &lt;int&gt;         &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
## 1      0          2.95  1910  0.06
## 2      1          3       90  0.29</code></pre>
<p>Entonces obtenemos una comparación de “peras con peras.”</p>
</div>
<div id="aleatorización-en-experimentos." class="section level3" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Aleatorización en experimentos.</h3>
<p>Aunque intuitivamente está claro por qué en el ejemplo anterior podemos
obtener el análisis correcto cuando aleatorizamos el tratamiento (en este caso un anuncio), podemos ver algunos detalles matemáticos que explican por qué sucede.</p>
<p>Una manera fácil de entender esto es pensando en contrafactuales. Consideramos
las siguientes variables aleatorias:</p>
<ul>
<li><span class="math inline">\(Y(1)\)</span> = compras de usario si recibe anuncio.</li>
<li><span class="math inline">\(Y(0)\)</span> = compras de usuario si no recibe anuncio.</li>
</ul>
<p>Nos interesa estimar
<span class="math display" id="eq:difcausal">\[\begin{equation}
E\left[ Y(1)-  Y(0)\right ] = E[Y(1)]  - E[Y(0)]
\tag{12.1}
\end{equation}\]</span></p>
<p>que podemos considerar como el efecto promedio del tratamiento (un anuncio, un cambio en el sitio, etc) sobre la población de usuarios (a veces queremos conocer este valor esperado condicionando al tratamiento: efecto sobre los tratados).</p>
<p>En la práctica, consideramos una muestra de usuarios <span class="math inline">\(Y_1,Y_2,\ldots, Y_n\)</span>. Algunos de estos recibirán el tratamiento y otros no, y escribimos <span class="math inline">\(T_i=1\)</span> si <span class="math inline">\(i\)</span> recibió el tratamiento y <span class="math inline">\(T_i=0\)</span> si no lo recibió. Las variables <span class="math inline">\(Y_i\)</span> que observamos
son:</p>
<ul>
<li><span class="math inline">\(Y_i = Y_i(1)\)</span> si <span class="math inline">\(T_i=1\)</span></li>
<li><span class="math inline">\(Y_i = Y_i(0)\)</span> si <span class="math inline">\(T_i=0\)</span></li>
</ul>
<p>La estimación directa de el valor esperado <a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#eq:difcausal">(12.1)</a> la haríamos con
el promedio
<span class="math display">\[\frac{1}{n}\sum_i \left(Y_i(1) - Y_i(0)\right)\]</span>
y notamos inmediatamente una dificultad: no observamos esta diferencia
para ninguno de los usuarios! Para cada usuario, observamos solamente una
de <span class="math inline">\(Y_i(1)\)</span> o <span class="math inline">\(Y_i(0)\)</span>. Los datos, por ejemplo, se verían:</p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-1" aria-hidden="true" tabindex="-1"></a>datos_obs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">i =</span> <span class="fu">c</span>(1L,2L,3L,4L,5L), </span>
<span id="cb995-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Y_i(1)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="cn">NA</span>, 5L, 3L, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb995-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-3" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">Y_i(0)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(2L, <span class="cn">NA</span>, <span class="cn">NA</span>, 3L, 2L), </span>
<span id="cb995-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">T=</span><span class="fu">c</span>(0L,1L,1L,0L,0L),</span>
<span id="cb995-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Y_i=</span><span class="fu">c</span>(2L,5L,3L,3L,2L))</span>
<span id="cb995-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb995-6" aria-hidden="true" tabindex="-1"></a>datos_obs</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##       i `Y_i(1)` `Y_i(0)`     T   Y_i
##   &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1       NA        2     0     2
## 2     2        5       NA     1     5
## 3     3        3       NA     1     3
## 4     4       NA        3     0     3
## 5     5       NA        2     0     2</code></pre>
<p>En cada caso, necesitamos el <strong>contrafactual</strong> de cada observación para poder
estimar el efecto promedio de nuestra intervención.</p>
<p>Nótese que viendo el lado derecho de <a href="#eq:probacola">(<strong>??</strong>)</a> podríamos intentar
hacer la <em>estimación estándar</em>, que consiste en tomar los promedios
de las columnas de los datos anteriores y promediar:
<span class="math display" id="eq:estandar">\[\begin{equation}
 \frac{1}{n_1} \sum_{T_i = 1} Y_i - \frac{1}{n_0} \sum_{T_i=0} Y_i.
\tag{12.2}
\end{equation}\]</span></p>
<p>donde promediamos los resultados de los tratados y restamos el promedio
de los no tratados. En nuestro ejemplo, haríamos:</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb997-1" aria-hidden="true" tabindex="-1"></a>mean_na <span class="ot">&lt;-</span> <span class="cf">function</span>(x){ <span class="fu">mean</span>(x, <span class="at">na.rm =</span> T)}</span>
<span id="cb997-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb997-2" aria-hidden="true" tabindex="-1"></a>datos_obs <span class="sc">|&gt;</span>  </span>
<span id="cb997-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb997-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">media_tratados =</span> <span class="fu">mean_na</span>(<span class="st">`</span><span class="at">Y_i(1)</span><span class="st">`</span>),</span>
<span id="cb997-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb997-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">media_no_tratados =</span> <span class="fu">mean_na</span>(<span class="st">`</span><span class="at">Y_i(0)</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb997-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb997-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diferencia =</span> media_tratados <span class="sc">-</span> media_no_tratados)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   media_tratados media_no_tratados diferencia
##            &lt;dbl&gt;             &lt;dbl&gt;      &lt;dbl&gt;
## 1              4              2.33       1.67</code></pre>
<p>Ahora consideremos por qué esta estimación puede tener sesgo alto.
El promedio <span class="math inline">\(\frac{1}{n_1} \sum_{T_i = 1} Y_i\)</span> es realmente una estimación
de
<span class="math display">\[E[Y|T = 1] = E[Y(1)|T=1]\]</span>
Así que cuando la asignación del tratamiento está asociada a la variable
de respuesta <span class="math inline">\(Y\)</span>, esta última cantidad no es necesariamente igual
a <span class="math inline">\(E\left(Y(1)\right)\)</span>. Explica en tus palabras por qué pasa esto (puedes comenzar
con el ejemplo de <em>paid search</em> que vimos arriba).</p>
<p>Igualmente, el promedio <span class="math inline">\(\frac{1}{n_0} \sum_{T_i = 0} Y_i\)</span> estima
la cantidad
<span class="math display">\[E[Y|T = 0] = E[Y(0)|T=0]\]</span>
que no necesariamente es igual a <span class="math inline">\(E[Y(0)]\)</span>. En general, estamos comparando “peras con manzanas,”
pues los tratados y los no tratados pueden ser subpoblaciones muy distintas cuando el
tratamiento se asigna de manera “natural.”</p>

<div class="resumen">
El que a veces se llama el <strong>problema fundamental de la inferencia causal</strong> es
que nunca observamos los efectos causales directamente, pues nunca observamos
juntos el resultado más su contrafactual.
</div>
<p>Con un experimento, sin embargo, podemos superar este problema.
Si <strong>asignamos el tratamiento de manera aleatoria</strong>, entonces
por definición <span class="math inline">\(E(Y(0)) = E\left(Y(0)|T=0\right)\)</span> y <span class="math inline">\(E\left(Y(1)\right) = E\left(Y(1)|T=0\right)\)</span> (<span class="math inline">\(T\)</span>
es una variable aleatoria que no está correlacionada con ninguna otra variable),
y el estimador estándar <a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#eq:estandar">(12.2)</a> es un estimador insesgado
de la cantidad que nos interesa, que es <a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#eq:difcausal">(12.1)</a>.</p>
</div>
</div>
<div id="costos-de-experimentación" class="section level2" number="12.3">
<h2><span class="header-section-number">12.3</span> Costos de experimentación</h2>
<p>Ahora supongamos que para simplificar nuestra vida, y tener resultados
sólidos, decidimos hacer un experimento <span class="math inline">\(A/B\)</span> en nuestro sitio web. Decidimos
entonces, cada vez que un usuario pide una página <span class="math inline">\(x\)</span>, tiramos un volado y decidimos
si le enseñamos la versión <span class="math inline">\(A\)</span> y la versión <span class="math inline">\(B\)</span>. Lo que hace este usuario en el resto
de su sesión estará registrado en los logs del sitio (o en una base de datos si
nuestra aplicación registra los resultados de interés). Podemos entonces, después
de tener un número apriopiado de usuarios en cada rama <span class="math inline">\(A\)</span> y <span class="math inline">\(B\)</span>, comparar los
dos grupos y tomar una decisión final acerca de qué versión nos conviene.</p>
<p>Las primeras objeciones que podemos hacer a esta decisión (y que muchos interesados
en el negocio seguramente plantearán):</p>
<ul>
<li><p>El experimento representa un riesgo al ingreso del sitio o el éxito del negocio. Si la modificación es contraproducente, entonces la duración del experimento representa pérdidas para el negocio. Por ejemplo, si decidimos hacer un experimento para saber si un anuncio está funcionando, en lugar de mostrar el anuncio a todos los usuarios que califican, solo una fracción lo recibirá. Esto representa pérdidas potenciales grandes. <strong>Respuesta</strong>: esto es cierto, en términos de ganancias a corto plazo. Pero también es necesario ver el <em>trade-off</em>: que a mediano y largo plazo, hacer experimentación de manera más generalizada puede avanzar mejor el negocio y dar más seguridad en la toma de decisiones.</p></li>
<li><p>Hay también un costo técnico en establecer la infraestructura para hacer y analizar los experimentos adecuadamente. <strong>Respuesta</strong>: esto es cierto.</p></li>
<li><p>El camino de la experimentación muchas veces es contrario al pensamiento de los analistas de negocios/tomadores de decisiones, que a veces prefieren hacer análisis diseñados para entender el potencial de cambio <em>antes</em> de hacer ningún cambio. Por ejemplo encuestas, pruebas en focus groups, etc. <strong>Respuesta</strong>: el análisis ad-hoc es una herramienta poderosa, pero también muchas veces plagada de incertidumbre no siempre explícita (por ejemplo, muy dependiente del tipo de modelos que se consideran, o de los datos que se tienen a mano). Es posible combinar las dos aproximaciones.</p></li>
</ul>
<p>En particular, los experimentos <span class="math inline">\(A/B\)</span> (que pueden tener más de <span class="math inline">\(2\)</span> opciones) tienen la debilidad de que</p>
<ul>
<li><p>Cuando hacemos experimentación, generalmente decidimos cuánto tiempo va a durar el experimento para tener tamaños de muestra adecuados. En algunos casos, las opciones son tan malas o tan buenas en relación a otras que esto es un desperdicio de dinero (podemos descartar una opción rápidamente por ser muy mala).</p></li>
<li><p>Desde el punto de vista del negocio, preferiríamos una solución donde cuanto más mala parece ser una opción, la exploramos menos para incurrir en menos pérdidas grandes. Sin embargo, queremos mantener algún nivel de exploración para poder encontrar mejores opciones a la que tenemos actualmente, especialmente cuando tenemos incertidumbre alta acerca de una opción.</p></li>
<li><p>Muchas veces, se considera que lo más importante de controlar es el error tipo I (declarar
un cambio como mejoría cuando realmente es más o menos equivalente a lo que teníamos antes) mediante
algún nivel de significancia (<span class="math inline">\(5\%\)</span>). En la práctica,
nos preocupan más los errores de tipo II (no escoger un cambio que representa ganancias grandes), especialmente cuando el costo
de hacer cambios es relativamente bajo, como en el caso de páginas web
o algoritmo de machine learning usado, por ejemplo.</p></li>
</ul>
</div>
<div id="algoritmos-de-tragamonedas" class="section level2" number="12.4">
<h2><span class="header-section-number">12.4</span> Algoritmos de tragamonedas</h2>
<p>Los algoritmos de tragamonedas (multi-armed bandit algorithms) buscan
dar soluciones a las deficiencias que acabamos de señalar en el esquema
de experimentación A/B. La idea básica es que para optimizar nuestro
sitio web (por ejemplo), necesitamos balancear dos tipos de acciones:</p>
<ul>
<li><strong>Exploratorias</strong>: donde probamos nuevas opciones para ver cómo se desempeñan.</li>
<li><strong>Explotadoras</strong>: donde aplicamos las mejores opciones (hasta donde tenemos evidencia) para tener buenos resultados de negocio.</li>
</ul>
<p>Estas dos caras son indispensables para la optimización: ninguna
tiene mucho sentido sin la otra.</p>
<p>El proceso que nos interesa lo formulamos como una máquina tragamonedas,
donde jalamos palancas y obtenemos resultados aleatorios:</p>

<div class="resumen">
<p>Una tragamonedas de <span class="math inline">\(n\)</span> brazos es un proceso aleatorio, donde:</p>
<ul>
<li>Escogemos uno de <span class="math inline">\(n\)</span> palancas de la tragamonedas</li>
<li>Obtenemos una recompensa aleatoria, cuya distribución depende de la palanca que escogimos.</li>
</ul>
¿Cómo debemos operar la máquina para lograr maximizar en algún
sentido nuestra recompensa?
</div>
<p>El material de esta sección está parcialmente basado en <span class="citation">(<a href="#ref-whitebandits" role="doc-biblioref">White 2012</a>)</span>. También puedes
revisar el código de libro (python, julia, r) en <a href="https://github.com/johnmyleswhite/BanditsBook">este repositorio</a>.</p>
<div id="ejemplos-1" class="section level4 unnumbered">
<h4>Ejemplos</h4>
<p>Probemos como lucirían los datos obtenidos de una tragamonedas, y cómo podríamos
ir tomando decisiones acerca de qué brazos probar</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-1" aria-hidden="true" tabindex="-1"></a>crear_maquina_poisson <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda){</span>
<span id="cb999-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># utilizamos recompensas poisson con distintas medias lambda</span></span>
<span id="cb999-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-3" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">length</span>(lambda)</span>
<span id="cb999-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-4" aria-hidden="true" tabindex="-1"></a>  simular_maquina <span class="ot">&lt;-</span> <span class="cf">function</span>(brazo){</span>
<span id="cb999-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rpois</span>(<span class="dv">1</span>, <span class="at">lambda =</span> lambda[brazo])</span>
<span id="cb999-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb999-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-7" aria-hidden="true" tabindex="-1"></a>  simular_maquina</span>
<span id="cb999-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb999-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-9" aria-hidden="true" tabindex="-1"></a>crear_maquina_bernoulli <span class="ot">&lt;-</span> <span class="cf">function</span>(lambda){</span>
<span id="cb999-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># utilizamos recompensas poisson con distintas medias lambda</span></span>
<span id="cb999-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-11" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">length</span>(lambda)</span>
<span id="cb999-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-12" aria-hidden="true" tabindex="-1"></a>  simular_maquina <span class="ot">&lt;-</span> <span class="cf">function</span>(brazo){</span>
<span id="cb999-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rbinom</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="at">p =</span> lambda[brazo])</span>
<span id="cb999-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb999-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-15" aria-hidden="true" tabindex="-1"></a>  simular_maquina</span>
<span id="cb999-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb999-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb999-17" aria-hidden="true" tabindex="-1"></a>sim_1 <span class="ot">&lt;-</span> <span class="fu">crear_maquina_poisson</span>(<span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">8</span>))</span></code></pre></div>
<p>Ahora empezamos a explorar:</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2123</span>)</span>
<span id="cb1000-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1000-2" aria-hidden="true" tabindex="-1"></a><span class="co">#jalamos el brazo 2</span></span>
<span id="cb1000-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1000-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1002-1" aria-hidden="true" tabindex="-1"></a><span class="co"># probemos otro</span></span>
<span id="cb1002-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1002-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1004-1" aria-hidden="true" tabindex="-1"></a><span class="co"># el brazo 2 parece mejor, pero estamos seguros? Probemos más</span></span>
<span id="cb1004-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1004-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1006-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 13</code></pre>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="co"># quizá el brazo 3 es mejor</span></span>
<span id="cb1008-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1008-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1010-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1012-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] 7</code></pre>
<p>Pero ahora nos damos cuenta: quizá el brazo 1 es mucho mejor y hemos estado perdiendo
el tiempo en los brazos 2 y 3!</p>
<div class="sourceCode" id="cb1014"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1014-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1014-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1016-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1018-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_1</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Parecen mejor los brazos 2 y 3. Veamos un resumen del desempeño :</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1020-1" aria-hidden="true" tabindex="-1"></a>brazo_1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb1020-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1020-2" aria-hidden="true" tabindex="-1"></a>brazo_2 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb1020-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1020-3" aria-hidden="true" tabindex="-1"></a>brazo_3 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">13</span>, <span class="dv">11</span>, <span class="dv">3</span>)</span>
<span id="cb1020-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1020-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Brazo 1: Media %.3f, Error estándar %.3f&quot;</span>, <span class="fu">mean</span>(brazo_1), <span class="fu">sd</span>(brazo_1)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(brazo_1)))</span></code></pre></div>
<pre><code>## [1] &quot;Brazo 1: Media 1.333, Error estándar 0.882&quot;</code></pre>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1022-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Brazo 2: Media %.3f, Error estándar %.3f&quot;</span>, <span class="fu">mean</span>(brazo_2), <span class="fu">sd</span>(brazo_2)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(brazo_2)))</span></code></pre></div>
<pre><code>## [1] &quot;Brazo 2: Media 6.667, Error estándar 2.028&quot;</code></pre>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1024-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;Brazo 3: Media %.3f, Error estándar %.3f&quot;</span>, <span class="fu">mean</span>(brazo_3), <span class="fu">sd</span>(brazo_3)<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(brazo_3)))</span></code></pre></div>
<pre><code>## [1] &quot;Brazo 3: Media 8.250, Error estándar 2.287&quot;</code></pre>
<p>Y nos damos cuenta de que todavía tenemos que explorar más, aunque los brazos 2 y 3 se ven
mejores que el 1.</p>
<hr />
<p>Puntos importantes:</p>
<ul>
<li>Las datos que hemos visto de una palanca dada son evidencia del desempeño de la palanca,
pero no podemos decidir con 100% de seguridad cuál es su desempeño, pues
existe variación muestral.</li>
<li>En general, queremos <strong>explorar</strong> palancas que tengan poca evidencia (datos) para entender
mejor su nivel de recompensas y ver si son buenas.</li>
<li>Pero también tenemos que <strong>explotar</strong> palancas cuya evidencia es de recompensa alta para no
perder dinero en el proceso de experimentación. Queremos también evitar palancas que han dado evidencia de ser inferiores.</li>
<li>Un esquema de <strong>exploración-explotación</strong> es un punto medio entre la visión del experimentador
clásico y de los intereses del negocio.</li>
<li>En un experimento clásico (A/B), generalmente fijamos el tamaño de muestra que queremos para hacer
nuestro análisis estadístico. Pero en una tragamonedas,
la asignación es dinámica, y puede depender tanto
del tamaño de muestra como de los niveles de recompensa que hemos observado.</li>
</ul>

<div class="resumen">
También obsérvese que en cualquier caso, un algoritmo para resolver una tragamonedas
debe <strong>involucrar aleatorización</strong>: asignación aleatoria de los usuarios (o las pruebas)
a los distintos posibles brazos. Esto nos permite comparar directamente los resultados sin
preocuparnos por corregir o considerar sesgo debido a asignaciones no aleatorias de los
usuarios o las pruebas.
</div>
<p>En optimización de sitios web, las palancas son las distintas opciones
que podemos presentar a los usuarios, por ejemplo, 3 algoritmos de
ordenación de resultados. Cada usuario es una jugada en la máquina
tragamonedas, y la recompensa es la métrica de desempeño que hayamos escogido
(por ejemplo, conversiones).</p>
</div>
</div>
<div id="algoritmo-epsilon-miope" class="section level2" number="12.5">
<h2><span class="header-section-number">12.5</span> Algoritmo epsilon-miope</h2>
<p>Idea: casi siempre escoger la que parece ser la mejor opción (media más alta, por ejemplo),
con los datos que tenemos al momento. Pero de vez en cuando (con cierta
probabilidad) escogemos una opción al azar.</p>
<p>Sea <span class="math inline">\(\epsilon &gt; 0\)</span>, y supongamos que nuestra máquina tiene <span class="math inline">\(n\)</span>
brazos. Cuando llega un usuario,</p>
<ul>
<li>Con probabilidad <span class="math inline">\(1-\epsilon\)</span> le presentamos la mejor opción que tenemos ahora</li>
<li>Con probabilidad <span class="math inline">\(\epsilon\)</span> es escogemos al azar alguna de las <span class="math inline">\(n\)</span> opciones.</li>
</ul>
<p>Antes de seguir, probamos el simulador que construimos
arriba y gráficamos los resultados para cada brazo:</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1026-1" aria-hidden="true" tabindex="-1"></a>simular <span class="ot">&lt;-</span> <span class="fu">crear_maquina_poisson</span>(<span class="at">lambda =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">10</span>))</span>
<span id="cb1026-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1026-2" aria-hidden="true" tabindex="-1"></a>sim_recomp <span class="ot">&lt;-</span> </span>
<span id="cb1026-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1026-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_frame</span>(<span class="at">brazo =</span> <span class="fu">sample.int</span>(<span class="dv">3</span>, <span class="dv">3000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1026-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1026-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">recompensa =</span> <span class="fu">map_dbl</span>(brazo, simular)) <span class="sc">|&gt;</span></span>
<span id="cb1026-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1026-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(brazo) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(recompensa))</span></code></pre></div>
<pre><code>## Warning: `data_frame()` was deprecated in tibble 1.1.0.
## Please use `tibble()` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1028-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_recomp, <span class="fu">aes</span>(<span class="at">x=</span>recompensa)) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>brazo, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1028-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1028-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1028-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1028-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> media), <span class="at">colour =</span> <span class="st">&#39;gray&#39;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-19-1.png" width="288" /></p>
<p>Ahora construimos nuestra función para el algoritmo e-miope</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-1" aria-hidden="true" tabindex="-1"></a>crear_epsilon_miope <span class="ot">&lt;-</span> <span class="cf">function</span>(epsilon, <span class="at">inicial =</span> <span class="dv">1</span>, sim_fun){</span>
<span id="cb1029-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-2" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">environment</span>(sim_fun)<span class="sc">$</span>n_brazos</span>
<span id="cb1029-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-3" aria-hidden="true" tabindex="-1"></a>  conteos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1029-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-4" aria-hidden="true" tabindex="-1"></a>  iteracion <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1029-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#recompensas &lt;- vector(&quot;list&quot;, n_brazos)</span></span>
<span id="cb1029-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-6" aria-hidden="true" tabindex="-1"></a>  sumas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1029-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-7" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1029-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-8" aria-hidden="true" tabindex="-1"></a>  mejor <span class="ot">&lt;-</span> inicial</span>
<span id="cb1029-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-9" aria-hidden="true" tabindex="-1"></a>  epsilon <span class="ot">&lt;-</span> epsilon</span>
<span id="cb1029-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-10" aria-hidden="true" tabindex="-1"></a>  fun <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1029-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;=</span> epsilon){</span>
<span id="cb1029-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-12" aria-hidden="true" tabindex="-1"></a>      <span class="co">#explorar</span></span>
<span id="cb1029-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-13" aria-hidden="true" tabindex="-1"></a>      brazo <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(n_brazos, <span class="dv">1</span>)</span>
<span id="cb1029-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-14" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1029-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">#explotar</span></span>
<span id="cb1029-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-16" aria-hidden="true" tabindex="-1"></a>      brazo <span class="ot">&lt;-</span> mejor</span>
<span id="cb1029-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1029-18"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-18" aria-hidden="true" tabindex="-1"></a>    sim <span class="ot">&lt;-</span> <span class="fu">sim_fun</span>(brazo)</span>
<span id="cb1029-19"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#recompensas[[brazo]] &lt;&lt;- c(recompensas[[brazo]], sim)</span></span>
<span id="cb1029-20"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-20" aria-hidden="true" tabindex="-1"></a>    media_ant <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(conteos[brazo] <span class="sc">&gt;</span> <span class="dv">0</span>, sumas[brazo] <span class="sc">/</span> conteos[brazo], <span class="dv">0</span>)</span>
<span id="cb1029-21"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-21" aria-hidden="true" tabindex="-1"></a>    conteos[brazo] <span class="ot">&lt;&lt;-</span> conteos[brazo] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1029-22"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-22" aria-hidden="true" tabindex="-1"></a>    sumas[brazo] <span class="ot">&lt;&lt;-</span> sumas[brazo] <span class="sc">+</span> sim</span>
<span id="cb1029-23"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-23" aria-hidden="true" tabindex="-1"></a>    media <span class="ot">&lt;-</span> sumas[brazo] <span class="sc">/</span> conteos[brazo]</span>
<span id="cb1029-24"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-24" aria-hidden="true" tabindex="-1"></a>    S[brazo] <span class="ot">&lt;&lt;-</span> S[brazo] <span class="sc">+</span> (sim <span class="sc">-</span> media_ant)<span class="sc">*</span>(sim <span class="sc">-</span> media)</span>
<span id="cb1029-25"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-25" aria-hidden="true" tabindex="-1"></a>    mejor <span class="ot">&lt;&lt;-</span> <span class="fu">which.max</span>(sumas <span class="sc">/</span>conteos)</span>
<span id="cb1029-26"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-26" aria-hidden="true" tabindex="-1"></a>    iteracion <span class="ot">&lt;&lt;-</span> iteracion <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1029-27"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-27" aria-hidden="true" tabindex="-1"></a>    estado <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">n =</span> iteracion,</span>
<span id="cb1029-28"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-28" aria-hidden="true" tabindex="-1"></a>                         <span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos,</span>
<span id="cb1029-29"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-29" aria-hidden="true" tabindex="-1"></a>                         <span class="at">conteo =</span> conteos,</span>
<span id="cb1029-30"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suma =</span> sumas, </span>
<span id="cb1029-31"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">media =</span> sumas <span class="sc">/</span> conteos,</span>
<span id="cb1029-32"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ee =</span> <span class="fu">sqrt</span>(S <span class="sc">/</span> conteos)<span class="sc">/</span><span class="fu">sqrt</span>(conteos))</span>
<span id="cb1029-33"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(estado)</span>
<span id="cb1029-34"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1029-35"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-35" aria-hidden="true" tabindex="-1"></a>  fun</span>
<span id="cb1029-36"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1029-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Y veamos algunas corridas:</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1030-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9233</span>)</span>
<span id="cb1030-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1030-2" aria-hidden="true" tabindex="-1"></a>e_miope <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">0.5</span>, <span class="at">inicial =</span> <span class="dv">1</span>, </span>
<span id="cb1030-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1030-3" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sim_fun =</span> simular)</span>
<span id="cb1030-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1030-4" aria-hidden="true" tabindex="-1"></a><span class="fu">e_miope</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##       n brazo conteo  suma media    ee
##   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1      0     0   NaN   NaN
## 2     1     2      1     6     6     0
## 3     1     3      0     0   NaN   NaN</code></pre>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1032-1" aria-hidden="true" tabindex="-1"></a><span class="fu">e_miope</span>()</span></code></pre></div>
<pre><code>## # A tibble: 3 × 6
##       n brazo conteo  suma media    ee
##   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     2     1      1     2     2     0
## 2     2     2      1     6     6     0
## 3     2     3      0     0   NaN   NaN</code></pre>
<p>Y ahora generamos 100 datos adicionales y guardamos los resultados:</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1034-1" aria-hidden="true" tabindex="-1"></a>e_miope <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">0.3</span>, <span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1034-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1034-2" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">600</span>, <span class="sc">~</span> <span class="fu">e_miope</span>()) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb1034-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1034-3" aria-hidden="true" tabindex="-1"></a>df_iteraciones </span></code></pre></div>
<pre><code>## # A tibble: 1,800 × 6
##        n brazo conteo  suma media    ee
##    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1     1      1     2     2     0
##  2     1     2      0     0   NaN   NaN
##  3     1     3      0     0   NaN   NaN
##  4     2     1      1     2     2     0
##  5     2     2      1     4     4     0
##  6     2     3      0     0   NaN   NaN
##  7     3     1      1     2     2     0
##  8     3     2      2     8     4     0
##  9     3     3      0     0   NaN   NaN
## 10     4     1      1     2     2     0
## # … with 1,790 more rows</code></pre>
<p>Y consideramos la recompensa promedio acumulada a cada momento
del tiempo:</p>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1036-1" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n) <span class="sc">|&gt;</span></span>
<span id="cb1036-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1036-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_recompensa =</span> <span class="fu">sum</span>(suma) <span class="sc">/</span> <span class="fu">sum</span>(conteo))</span>
<span id="cb1036-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1036-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resumen, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> promedio_recompensa)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1036-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1036-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Nótese que esperamos que conforme pasa el tiempo, vamos explorando
las distintas opciones, y el algoritmo identifica
correctamente la mejor opción (la que tiene promedio más alto). Este balance
hace que típicamente la recompensa promedio vaya subiendo.
La exploración nos permite juntar datos incluso
de las opciones más malas para tomar mejores decisiones en el futuro.</p>
<p>La línea roja corresponde a la decisión de tomar la mejor decisión en cada
iteración. Nótese que este algoritmo alcanza una fracción de este nivel óptimo,
pues constantemente hace exploración (con probabilidad <span class="math inline">\(\epsilon\)</span>) de otras
opciones.</p>
<p>Podemos ver cómo van compitiendo los brazos en el tiempo:</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1037-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_iteraciones, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> suma <span class="sc">/</span> conteo, </span>
<span id="cb1037-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">group =</span> brazo, <span class="at">colour =</span> <span class="fu">factor</span>(brazo))) <span class="sc">+</span> <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Y podemos considerar intervalos (por ejemplo, de 2 errores estándar)
para la estimación de la recompensa promedio de cada brazo:</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-1" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(brazo) <span class="sc">|&gt;</span></span>
<span id="cb1038-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">promedio =</span> suma <span class="sc">/</span> conteo) </span>
<span id="cb1038-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_iteraciones, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span>promedio, </span>
<span id="cb1038-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymin =</span> promedio <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>ee,</span>
<span id="cb1038-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> promedio <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>ee, </span>
<span id="cb1038-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> <span class="fu">factor</span>(brazo), <span class="at">group =</span> brazo)) <span class="sc">+</span></span>
<span id="cb1038-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1038-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Obsérvese que nuestro método no utiliza en ninguna forma la incertidumbre que
tenemos en las estimaciones de la recompensa promedio. Veremos más adelante cómo
mejorar esta deficiencia.</p>
<div id="comparación-con-experimentación-clásica" class="section level3" number="12.5.1">
<h3><span class="header-section-number">12.5.1</span> Comparación con experimentación clásica</h3>
<p>En experimentación usual, siempre asignamos aleatoriamente el brazo (por una cantidad
de tiempo inicial fija), de forma que <span class="math inline">\(epsilon=1\)</span>,
y después siempre escogemos el mejor brazo <span class="math inline">\(epsilon = 0\)</span>. Es decir: al principio exploramos
intentando encontrar muestras balanceadas en tamaño para cada brazo, y al final
solo explotamos.</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9322</span>)</span>
<span id="cb1039-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-2" aria-hidden="true" tabindex="-1"></a>e_miope <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">0.1</span>, <span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1039-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-3" aria-hidden="true" tabindex="-1"></a>e_ab <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">1.0</span>, <span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1039-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-4" aria-hidden="true" tabindex="-1"></a>tiempo <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1039-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-6" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, <span class="cf">function</span>(i){</span>
<span id="cb1039-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(i<span class="sc">==</span><span class="dv">301</span>){</span>
<span id="cb1039-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># si llegamos al tiempo 300 dejamos de explorar, y solo explotamos</span></span>
<span id="cb1039-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assign</span>(<span class="st">&quot;epsilon&quot;</span>, <span class="fl">0.0</span>, <span class="fu">environment</span>(e_ab))</span>
<span id="cb1039-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1039-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-11" aria-hidden="true" tabindex="-1"></a>  dat_miope <span class="ot">&lt;-</span> <span class="fu">e_miope</span>()</span>
<span id="cb1039-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-12" aria-hidden="true" tabindex="-1"></a>  dat_ab <span class="ot">&lt;-</span>  <span class="fu">e_ab</span>()</span>
<span id="cb1039-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-13" aria-hidden="true" tabindex="-1"></a>  dat_miope<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="st">&quot;miope&quot;</span></span>
<span id="cb1039-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-14" aria-hidden="true" tabindex="-1"></a>  dat_ab<span class="sc">$</span>tipo <span class="ot">&lt;-</span> <span class="st">&quot;ab&quot;</span></span>
<span id="cb1039-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(dat_miope, dat_ab)</span>
<span id="cb1039-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1039-16" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Veamos</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1040-1" aria-hidden="true" tabindex="-1"></a>df_resumen <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n, tipo) <span class="sc">|&gt;</span> </span>
<span id="cb1040-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1040-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio =</span> <span class="fu">sum</span>(suma) <span class="sc">/</span> <span class="fu">sum</span>(conteo))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;n&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1042-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_resumen, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y =</span> promedio, <span class="at">group =</span> tipo, <span class="at">colour =</span> tipo)) <span class="sc">+</span></span>
<span id="cb1042-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1042-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Desempeño&quot;</span>) <span class="sc">+</span></span>
<span id="cb1042-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1042-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">300</span>, <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p><strong>Observaciones</strong>:</p>
<ol style="list-style-type: decimal">
<li>Nótese que en el periodo de experimentación, el algoritmo a/b tiene pérdidas comparado
con el algoritmo epsilon-miope. Esto es porque en toda esta etapa no tomamos las decisiones
usando las recompensas observadas.</li>
<li>Muy al principio, el algoritmo epsilon-miope pierde más que el a-b. Esto es porque al principio
está explotando un brazo muy malo. Una vez que explora los otros brazos, sin embargo, la explotación
mejora y supera en costo al método a/b.</li>
<li>Nótese que a largo plazo el algoritmo a/b superará en promedio al miope en recompensa promedio (una vez que dejamos de experimentar y ya identificamos correctamente la mejor opción). El algoritmo miope, por otro lado, sigue explorando opciones malas una fracción del tiempo, lo cual quizá ya no sería necesario.</li>
</ol>
<p>Podemos graficar también el acumulado, donde vemos de otra manera
la brecha entre los dos métodos en cuanto a recompensa acumulada en el tiempo:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1043-1" aria-hidden="true" tabindex="-1"></a>df_resumen <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n, tipo) <span class="sc">|&gt;</span> </span>
<span id="cb1043-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1043-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">acumulado =</span> <span class="fu">sum</span>(suma))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;n&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1045-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_resumen, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y =</span> acumulado, <span class="at">group =</span> tipo, <span class="at">colour =</span> tipo)) <span class="sc">+</span></span>
<span id="cb1045-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1045-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Desempeño&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p><strong>Preguntas</strong>:</p>
<ul>
<li>Estas gráficas muestran una corrida particular de recompensas observadas. Corre con
otra semilla para ver otras maneras en las que se pueden comportar estos algoritmos.</li>
<li>¿Cuál es el riesgo de correr por muy poco tiempo la fase de experimentación en el algoritmo
a/b?</li>
<li>¿Cuál es el riesgo de correr demasiado tiempo la fase de experimentación en el algoritmo a/b?</li>
<li>¿Cómo se vería en estas gráficas un algoritmo perfecto (ninguno tiene
mejor recompensa acumulada en ningún tiempo)? Añade estos límites teóricos (que en la práctica
no conocemos) a las gráficas de arriba.</li>
<li>Compara el desempeño del algoritmo miope con distintos valores de <span class="math inline">\(\epsilon\)</span>.</li>
</ul>
</div>
<div id="desventajas-del-algoritmo-miope" class="section level3 unnumbered">
<h3>Desventajas del algoritmo miope</h3>
<ul>
<li>Al principio, el algoritmo miope pierde tiempo explotando opciones que muchas veces son malas
(pues no hay información).</li>
<li>Al final, cuando tenemos más datos, el algoritmo miope pierde tiempo explorando opciones
que tienen mucha evidencia en su contra.</li>
<li>En parte, esto se debe a que el algoritmo no toma en cuenta el error de estimación (tamaño de muestra). Pero también se debe a que el algoritmo, cuando entra en exploración, escoge
con igual probabilidad todas las opciones.</li>
</ul>
</div>
</div>
<div id="algoritmo-softmax" class="section level2" number="12.6">
<h2><span class="header-section-number">12.6</span> Algoritmo softmax</h2>
<p>En esta parte consideramos una primer mejora al algoritmo miope incorporando parte del
esquema de experimentación a/b</p>
<ul>
<li>Escogeremos ramas para explorar dependiendo de qué tan bien se han desempeñado en el pasado.</li>
<li>Usamos una idea de recocido simulado: al principio, no tomamos en cuenta tanto las recompensas observadas (pues tenemos poca muestra), pero conforme pasa el tiempo nos concentramos más en explotar
las ramas que tienen desempeño promedio más alto.</li>
</ul>
<p>Para implementar la primera idea, supongamos que tenemos <span class="math inline">\(k\)</span> ramas, y al tiempo <span class="math inline">\(n\)</span> los promedios de recompensa para cada rama son
<span class="math display">\[\hat{r}_1, \hat{r}_2, \ldots, \hat{r}_k.\]</span>
La idea es escoger la rama <span class="math inline">\(j\)</span> con probabilidad</p>
<p><span class="math display">\[p_j = \frac{\exp({\hat{r}_j})}{\sum_i \exp({\hat{r}_i})}\]</span>
Nótese que las <span class="math inline">\(p_j\)</span>’s están entre 0 y 1 y suman 1. La probabilidad de un brazo es más
grande cuanto más grande sea su recompensa relativamente a las otras ramas.</p>
<p>Podemos hacer más flexible nuestra construcción de probabilidades agregando un parámetro <span class="math inline">\(T&gt;0\)</span>
de temperatura, y poniendo
<span class="math display">\[p_j (T) = \frac{\exp({\hat{r}_j/T})}{\sum_i \exp({\hat{r}_i}/T)}\]</span></p>
<div id="discusión" class="section level4 unnumbered">
<h4>Discusión</h4>
<p>El efecto de <span class="math inline">\(T\)</span> es dispersar las probabilidades o concentrarlas en la mejor opción. Supogamos
que tenemos cinco brazos con recompensa promedio en un momento dado de 1,4,5,2,1:</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb1046-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-2" aria-hidden="true" tabindex="-1"></a>softmax <span class="ot">&lt;-</span> <span class="cf">function</span>(r, tau){</span>
<span id="cb1046-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(r<span class="sc">/</span>tau) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(r<span class="sc">/</span>tau))</span>
<span id="cb1046-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1046-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-5" aria-hidden="true" tabindex="-1"></a>softmax_tau <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">tau =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.7</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">20</span>)) <span class="sc">|&gt;</span></span>
<span id="cb1046-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">df =</span> <span class="fu">map</span>(tau, <span class="cf">function</span>(t){</span>
<span id="cb1046-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data_frame</span>(<span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r), <span class="at">p =</span> <span class="fu">softmax</span>(r, t))</span>
<span id="cb1046-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-8" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">|&gt;</span> <span class="fu">unnest</span>(<span class="fu">c</span>(df))</span>
<span id="cb1046-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1046-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(softmax_tau, <span class="fu">aes</span>(<span class="at">x=</span>brazo, <span class="at">y=</span>p, <span class="at">fill=</span><span class="fu">factor</span>(tau), <span class="at">group=</span>tau)) <span class="sc">+</span> </span>
<span id="cb1046-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1046-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="st">&quot;dodge&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>tau)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<hr />
<p>El parámetro <span class="math inline">\(T\)</span> debe ser fijado, y depende de la escala de las recompensas. Si las
recompensas tienen una escala más grande (por ejemplo miles en lugar de decenas),
es necesario hacer <span class="math inline">\(T\)</span> más grande para dispersar más las probabilidades.</p>
<p>Ahora definimos el proceso para hacer más exploración al principio y más explotación al final.
La idea viene del <em>recocido simulado</em>, donde al inicio hacemos la temperatura más alta (más exploración), y luego reducimos gradualmente la temperatura para ir explotando más
las mejores opciones. La idea es poner
<span class="math display">\[\tau_{n+1} = \frac{\tau_0}{\log(n)}\]</span></p>
<p>De forma que cuando <span class="math inline">\(n\)</span> crece, la temperatura baja y hacemos más explotación (al principio
la temperatura es infinita, lo que implica que escogemos al azar entre los brazos).</p>
<p>Ahora implementamos el algoritmo:</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-1" aria-hidden="true" tabindex="-1"></a>crear_softmax <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">temp_0 =</span> <span class="dv">1</span>, <span class="at">inicial =</span> <span class="dv">1</span>, sim_fun, <span class="at">recocido =</span> F){</span>
<span id="cb1047-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-2" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">environment</span>(sim_fun)<span class="sc">$</span>n_brazos</span>
<span id="cb1047-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-3" aria-hidden="true" tabindex="-1"></a>  conteos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1047-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-4" aria-hidden="true" tabindex="-1"></a>  sumas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1047-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-5" aria-hidden="true" tabindex="-1"></a>  iteracion <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1047-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-6" aria-hidden="true" tabindex="-1"></a>  fun <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1047-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-7" aria-hidden="true" tabindex="-1"></a>    iteracion <span class="ot">&lt;&lt;-</span> iteracion <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1047-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(recocido){</span>
<span id="cb1047-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-9" aria-hidden="true" tabindex="-1"></a>      temperatura <span class="ot">&lt;-</span> temp_0 <span class="sc">/</span> <span class="fu">log</span>(iteracion <span class="sc">+</span> <span class="fl">0.0001</span>)</span>
<span id="cb1047-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1047-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-11" aria-hidden="true" tabindex="-1"></a>    promedio <span class="ot">&lt;-</span> sumas <span class="sc">/</span> (conteos <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb1047-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-12" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">max</span>(promedio <span class="sc">/</span> temperatura)</span>
<span id="cb1047-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-13" aria-hidden="true" tabindex="-1"></a>    exp_sumas <span class="ot">&lt;-</span> <span class="fu">exp</span>(promedio <span class="sc">/</span> temperatura <span class="sc">-</span> m)</span>
<span id="cb1047-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-14" aria-hidden="true" tabindex="-1"></a>    probs <span class="ot">&lt;-</span> exp_sumas <span class="sc">/</span> <span class="fu">sum</span>(exp_sumas)</span>
<span id="cb1047-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-15" aria-hidden="true" tabindex="-1"></a>    brazo <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_brazos, <span class="dv">1</span>, <span class="at">prob =</span> probs)</span>
<span id="cb1047-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-16" aria-hidden="true" tabindex="-1"></a>    sim <span class="ot">&lt;-</span> <span class="fu">sim_fun</span>(brazo)</span>
<span id="cb1047-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-17" aria-hidden="true" tabindex="-1"></a>    conteos[brazo] <span class="ot">&lt;&lt;-</span> conteos[brazo] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1047-18"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-18" aria-hidden="true" tabindex="-1"></a>    sumas[brazo] <span class="ot">&lt;&lt;-</span> sumas[brazo] <span class="sc">+</span> sim</span>
<span id="cb1047-19"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-19" aria-hidden="true" tabindex="-1"></a>    estado <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">n =</span> iteracion,</span>
<span id="cb1047-20"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos,</span>
<span id="cb1047-21"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">conteo =</span> conteos,</span>
<span id="cb1047-22"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suma =</span> sumas)</span>
<span id="cb1047-23"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1047-24"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-24" aria-hidden="true" tabindex="-1"></a>  fun</span>
<span id="cb1047-25"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1047-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1332</span>)</span>
<span id="cb1048-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-2" aria-hidden="true" tabindex="-1"></a>smax_1 <span class="ot">&lt;-</span> <span class="fu">crear_softmax</span>(<span class="at">temp_0 =</span> <span class="fl">1.0</span>, <span class="at">inicial =</span> <span class="dv">3</span>, <span class="at">recocido =</span> <span class="cn">TRUE</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1048-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-3" aria-hidden="true" tabindex="-1"></a>smax_2 <span class="ot">&lt;-</span> <span class="fu">crear_softmax</span>(<span class="at">temp_0 =</span> <span class="fl">0.1</span>, <span class="at">inicial =</span> <span class="dv">3</span>, <span class="at">recocido =</span> <span class="cn">TRUE</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1048-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-4" aria-hidden="true" tabindex="-1"></a>smax_3 <span class="ot">&lt;-</span> <span class="fu">crear_softmax</span>(<span class="at">temp_0 =</span> <span class="fl">25.0</span>, <span class="at">inicial =</span> <span class="dv">3</span>, <span class="at">recocido =</span> <span class="cn">TRUE</span>, <span class="at">sim_fun =</span> simular)</span>
<span id="cb1048-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-5" aria-hidden="true" tabindex="-1"></a>metodos <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">softmax_t_10 =</span> smax_1, </span>
<span id="cb1048-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">softmax_t_01 =</span> smax_2, </span>
<span id="cb1048-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">softmax_t_100 =</span> smax_3)</span>
<span id="cb1048-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1048-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-9" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, <span class="cf">function</span>(i){</span>
<span id="cb1048-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-10" aria-hidden="true" tabindex="-1"></a>  resultados <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(metodos), <span class="cf">function</span>(i){ </span>
<span id="cb1048-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-11" aria-hidden="true" tabindex="-1"></a>    metodos[[i]]() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">tipo =</span> <span class="fu">names</span>(metodos)[i]) })</span>
<span id="cb1048-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(resultados)</span>
<span id="cb1048-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-13" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb1048-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1048-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df_iteraciones, <span class="dv">200</span>)</span></code></pre></div>
<pre><code>## # A tibble: 200 × 5
##        n brazo conteo  suma tipo         
##    &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        
##  1   478     2    137   970 softmax_t_100
##  2   478     3    297  3037 softmax_t_100
##  3   479     1      7     6 softmax_t_10 
##  4   479     2      0     0 softmax_t_10 
##  5   479     3    472  4708 softmax_t_10 
##  6   479     1    479   490 softmax_t_01 
##  7   479     2      0     0 softmax_t_01 
##  8   479     3      0     0 softmax_t_01 
##  9   479     1     44    33 softmax_t_100
## 10   479     2    137   970 softmax_t_100
## # … with 190 more rows</code></pre>
<p>Y consideramos la recompensa promedio acumulada a cada momento
del tiempo:</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1050-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1050-1" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n, tipo) <span class="sc">|&gt;</span></span>
<span id="cb1050-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1050-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_recompensa =</span> <span class="fu">sum</span>(suma) <span class="sc">/</span> <span class="fu">sum</span>(conteo))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;n&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resumen, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span> promedio_recompensa, <span class="at">colour =</span> tipo, <span class="at">group =</span> tipo)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1052-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1052-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">10</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p><strong>Observaciones</strong>:</p>
<ol style="list-style-type: decimal">
<li>Nótese que el algoritmo con temperatura inicial muy baja no explora suficientemente, y rápidamente pasa a explotar un brazo subóptimo.</li>
<li>El algoritmo con temperatura inicial muy alta sigue explorando, y empieza a utilizar la evidencia de los mejores brazos más tarde.</li>
<li>El algoritmo como temperatura inicial 10 parece tener un buen balance: explora los suficiente
para encontrar el mejor brazo y luego se concentra en explotarlo.</li>
</ol>
</div>
<div id="desventajas-del-algoritmo-softmax" class="section level3" number="12.6.1">
<h3><span class="header-section-number">12.6.1</span> Desventajas del algoritmo softmax</h3>
<p>Este algoritmo es una mejora sobre los dos anteriores, pero es necesario escoger una
temperatura inicial correcta. Esta temperatura inicial correcta depende de las distribuciones
de recompensas de cada brazo (por ejemplo, si hay más varianza, necesitamos temperaturas más
altas para que el algoritmo explore más tiempo). Pero inicialmente no necesariamente sabemos
mucho acerca de estas recompensas.</p>
<p>El problema sigue siendo que esta heurística no examina estadísticamente los datos
que ha observado para decidir cuándo es tiempo de explorar, y qué explorar, y cuándo es
tiempo de explotar. Es decir, necesitamos evaluar estadísticamente la evidencia que tenemos
de cada brazo para tomar en cada paso la mejor decisión. Los siguientes dos algoritmos
consideran este aspecto.</p>
</div>
</div>
<div id="el-algoritmo-de-cota-superior-de-confianza-ucb" class="section level2" number="12.7">
<h2><span class="header-section-number">12.7</span> El algoritmo de cota superior de confianza (UCB)</h2>
<p>Los algoritmos mostrados arriba tienen el defecto de que no toman en cuenta
la incertidumbre que tenemos acerca de nuestra estimación de la recompensa
promedio de cada brazo. Una buena ventaja de considerar esta incertidumbre es que
la afinación de las probabilidades de exploración durante el algoritmo no deben
ser ajustadas a mano (por ejemplo con la temperatura inicial, o la selección de <span class="math inline">\(\epsilon\)</span>).</p>
<p>Supogamos que todas las recompensas están entre 0 y 1 (quizá es necesario escalar). Ahora
supongamos que al momento <span class="math inline">\(t\)</span> tenemos:</p>
<ul>
<li>Hemos probado la palanca <span class="math inline">\(k\)</span> <span class="math inline">\(n_{k,t}\)</span> veces</li>
<li>El promedio de recompensa de cada palanca es <span class="math inline">\(\bar{r}_{k,t}\)</span></li>
</ul>
<p>Es más o menos claro que medidas de dispersión de las recompensas de cada palanca nos
ayudaría a resolver este problema, pero también es necesario guardar más datos y procesarlos
cuando hacemos el experimento. Sin embargo, podemos dar una cota burda para el verdadero
valor medio <span class="math inline">\(r_k\)</span> de recompensa para la palanca <span class="math inline">\(k\)</span>.</p>
<p>Para el siguiente teorema, consideramos un brazo particular con media observada <span class="math inline">\(\bar{r}\)</span>,
media real <span class="math inline">\(r\)</span>, y número de observaciones <span class="math inline">\(n\)</span>. Suponemos como dijimos antes que cada recompensa están entre 0 y 1.</p>

<div class="resumen">
<p><strong>Cotas de Hoeffding</strong></p>
<p>Sea <span class="math inline">\(r_1,\ldots, r_n \in [0,1]\)</span> variables aleatorios iid con <span class="math inline">\(E(r_i) = r\)</span>. Entonces</p>
<p><span class="math display">\[P(\bar{r} \geq r + a) \leq \exp( -2na^2)\]</span>, y</p>
<span class="math display">\[P(\bar{r} \leq r - a) \leq \exp( -2na^2)\]</span>
</div>
<p>De este resultado podemos hacer un análisis optimista de las cotas superiores de ganancia. Si ponemos <span class="math inline">\(\delta = \exp( -2na^2)\)</span>, despejando obtenemos</p>
<p><span class="math display">\[P \left (r &gt; \bar{r} + \sqrt{\frac{log(1/\delta)}{2n}}\right )\leq \delta\]</span>
Si fijamos una <span class="math inline">\(\delta &gt;0\)</span>, entonces para cada uno de los brazos, obtenemos una
cota inferior para la recompensa promedio real de
<span class="math display">\[ c_{i,t} = \bar{r}_{i,t} + \sqrt{\frac{ log(1/\delta)}{2n_{i,t}}}\]</span>
La idea es entonces escoger el brazo cuya cota es más grande. Este es un punto
de vista <strong>optimista</strong>: si la cota es grande entonces decidimos explorar el brazo porque es
prometedor - aunque no hay garantía de que podamos superar la cota.</p>
<p>En principio podríamos correr el algoritmo con una <span class="math inline">\(\delta\)</span> fija, por ejemplo <span class="math inline">\(\delta=0.10\)</span>.
Veamos por qué esto no necesariamente es buena idea, pues puede ser que dejemos
de explorar prematuramente, y eso nos haría perder muchas recompensas. Como esto puede pasar
es como sigue:</p>
<ul>
<li>Imaginemos que en un momento dado <span class="math inline">\(T\)</span>, el mejor brazo es <span class="math inline">\(j\)</span>, con constante correpondiente <span class="math inline">\(c_{j,T}\)</span>.</li>
<li>A partir de ese momento, empezamos a explotar <span class="math inline">\(j\)</span>. La cota <span class="math inline">\(c_{j,t}\)</span> correspondiente a <span class="math inline">\(j\)</span> ser irá encogiendo hacia la media <span class="math inline">\(\bar{r}_{j,t}\)</span>.</li>
<li>Ahora supongamos que la segunda mejor <span class="math inline">\(k\)</span> opción al tiempo <span class="math inline">\(T\)</span> tiene <span class="math inline">\(c_{k,T} &lt; {\bar{r}_{j,t}}\)</span>. Como la opción <span class="math inline">\(j\)</span> sigue ganando, nunca exploraremos <span class="math inline">\(k\)</span> otra vez.</li>
<li>Sin embargo, hay una probabilidad baja (menor a 10%) de que de hecho la media verdadera
<span class="math inline">\(r_{k}\)</span> de <span class="math inline">\(k\)</span> esté
<strong>por encima</strong> de su cota <span class="math inline">\(c_{k,T}\)</span>. De forma que debería seguir siendo un candidato a
explorar!</li>
</ul>
<p>Podemos resolver este problema reduciendo el valor de <span class="math inline">\(\delta\)</span> conforme el tiempo avanza.
En el algoritmo UCB1 (Ver <span class="citation">(<a href="#ref-auerbandits" role="doc-biblioref">Auer, Cesa-Bianchi, and Fischer 2002</a>)</span>) ponemos</p>
<p><span class="math display">\[ c_{i,t} = \bar{r}_{i,t} + \sqrt{\frac{ 2log(t)}{n_{i,t}}},\]</span></p>
<p>de forma que la cota tiene probabilidad <span class="math inline">\(\delta = t^{-4}\)</span>. Adiconalmente, esta selección
particular permite tener cotas teóricas acerca de la máxima pérdida (también llamada <em>regret</em>)
que incurrimos al usar este algoritmo.</p>
<p>Implementamos el algoritmo UCB1 como sigue</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-1" aria-hidden="true" tabindex="-1"></a>crear_ucb <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">inicial =</span> <span class="dv">1</span>, sim_fun, <span class="at">max =</span> <span class="dv">1</span>){</span>
<span id="cb1053-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-2" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">environment</span>(sim_fun)<span class="sc">$</span>n_brazos</span>
<span id="cb1053-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-3" aria-hidden="true" tabindex="-1"></a>  conteos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1053-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-4" aria-hidden="true" tabindex="-1"></a>  sumas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1053-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-5" aria-hidden="true" tabindex="-1"></a>  iteracion <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1053-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-6" aria-hidden="true" tabindex="-1"></a>  fun <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1053-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-7" aria-hidden="true" tabindex="-1"></a>    iteracion <span class="ot">&lt;&lt;-</span> iteracion <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1053-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-8" aria-hidden="true" tabindex="-1"></a>    cotas <span class="ot">&lt;-</span> (sumas <span class="sc">/</span> max) <span class="sc">/</span> conteos  <span class="sc">+</span>  <span class="fu">sqrt</span>(<span class="dv">2</span><span class="sc">*</span> <span class="fu">log</span>(iteracion) <span class="sc">/</span> conteos)</span>
<span id="cb1053-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-9" aria-hidden="true" tabindex="-1"></a>    cotas[<span class="fu">is.nan</span>(cotas)] <span class="ot">&lt;-</span> <span class="cn">Inf</span></span>
<span id="cb1053-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-10" aria-hidden="true" tabindex="-1"></a>    brazo <span class="ot">&lt;-</span> <span class="fu">which.max</span>(cotas)</span>
<span id="cb1053-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-11" aria-hidden="true" tabindex="-1"></a>    sim <span class="ot">&lt;-</span> <span class="fu">sim_fun</span>(brazo)</span>
<span id="cb1053-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-12" aria-hidden="true" tabindex="-1"></a>    conteos[brazo] <span class="ot">&lt;&lt;-</span> conteos[brazo] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1053-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-13" aria-hidden="true" tabindex="-1"></a>    sumas[brazo] <span class="ot">&lt;&lt;-</span> sumas[brazo] <span class="sc">+</span> sim</span>
<span id="cb1053-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-14" aria-hidden="true" tabindex="-1"></a>    estado <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">n =</span> iteracion,</span>
<span id="cb1053-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos,</span>
<span id="cb1053-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">conteo =</span> conteos,</span>
<span id="cb1053-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-17" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suma =</span> sumas)</span>
<span id="cb1053-18"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1053-19"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-19" aria-hidden="true" tabindex="-1"></a>  fun</span>
<span id="cb1053-20"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1053-20" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">92329</span>)</span>
<span id="cb1054-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>sim_2 <span class="ot">&lt;-</span> <span class="fu">crear_maquina_bernoulli</span>(<span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,  <span class="fl">0.99</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>,<span class="fl">0.1</span>))</span>
<span id="cb1054-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>ucb <span class="ot">&lt;-</span> <span class="fu">crear_ucb</span>(<span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1054-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-4" aria-hidden="true" tabindex="-1"></a>smax <span class="ot">&lt;-</span> <span class="fu">crear_softmax</span>(<span class="at">temp_0 =</span> <span class="fl">1.5</span>, <span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">recocido =</span> <span class="cn">TRUE</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1054-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-5" aria-hidden="true" tabindex="-1"></a>miope <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">0.1</span>, <span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1054-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-7" aria-hidden="true" tabindex="-1"></a>metodos <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ucb =</span> ucb, </span>
<span id="cb1054-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">softmax =</span> smax, </span>
<span id="cb1054-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">miope =</span> miope)</span>
<span id="cb1054-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-11" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">500</span>, <span class="cf">function</span>(i){</span>
<span id="cb1054-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-12" aria-hidden="true" tabindex="-1"></a>  resultados <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(metodos), <span class="cf">function</span>(i){ </span>
<span id="cb1054-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-13" aria-hidden="true" tabindex="-1"></a>    metodos[[i]]() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">tipo =</span> <span class="fu">names</span>(metodos)[i]) })</span>
<span id="cb1054-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(resultados)</span>
<span id="cb1054-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1054-15" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<p>Y consideramos la recompensa promedio acumulada a cada momento
del tiempo:</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1055-1" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> df_iteraciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n, tipo) <span class="sc">|&gt;</span></span>
<span id="cb1055-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1055-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_recompensa =</span> <span class="fu">sum</span>(suma) <span class="sc">/</span> <span class="fu">sum</span>(conteo))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;n&#39;. You can override using the `.groups`
## argument.</code></pre>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1057-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resumen, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span> promedio_recompensa, <span class="at">colour =</span> <span class="fu">factor</span>(tipo), <span class="at">group=</span>tipo)) <span class="sc">+</span> <span class="fu">geom_line</span>()  <span class="sc">+</span></span>
<span id="cb1057-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1057-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.99</span>, <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Podemos correr varias simulaciones para ver cómo se comportan bajo distintos
patrones de recompensas</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-1" aria-hidden="true" tabindex="-1"></a>correr_algos <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">metodos =</span> metodos, <span class="at">t =</span> <span class="dv">300</span>){</span>
<span id="cb1058-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>  ucb <span class="ot">&lt;-</span> <span class="fu">crear_ucb</span>(<span class="at">inicial =</span> <span class="dv">1</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1058-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-3" aria-hidden="true" tabindex="-1"></a>  smax <span class="ot">&lt;-</span> <span class="fu">crear_softmax</span>(<span class="at">temp_0 =</span> <span class="dv">1</span>, <span class="at">inicial =</span> <span class="dv">3</span>, <span class="at">recocido =</span> <span class="cn">TRUE</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1058-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>  miope <span class="ot">&lt;-</span> <span class="fu">crear_epsilon_miope</span>(<span class="at">epsilon =</span> <span class="fl">0.1</span>, <span class="at">sim_fun =</span> sim_2)</span>
<span id="cb1058-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1058-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-6" aria-hidden="true" tabindex="-1"></a>  metodos <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ucb =</span> ucb, </span>
<span id="cb1058-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">softmax =</span> smax, </span>
<span id="cb1058-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">miope =</span> miope)</span>
<span id="cb1058-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-9" aria-hidden="true" tabindex="-1"></a>  df_out <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>t, <span class="cf">function</span>(i){</span>
<span id="cb1058-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-10" aria-hidden="true" tabindex="-1"></a>    resultados <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(metodos), <span class="cf">function</span>(i){ </span>
<span id="cb1058-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-11" aria-hidden="true" tabindex="-1"></a>        metodos[[i]]() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">tipo =</span> <span class="fu">names</span>(metodos)[i]) </span>
<span id="cb1058-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb1058-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(resultados) }) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb1058-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-14" aria-hidden="true" tabindex="-1"></a>  df_out</span>
<span id="cb1058-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1058-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-16" aria-hidden="true" tabindex="-1"></a>replicaciones <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">rep =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span></span>
<span id="cb1058-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map</span>(rep, <span class="cf">function</span>(rep) { <span class="fu">correr_algos</span>(metodos) })) <span class="sc">|&gt;</span> </span>
<span id="cb1058-18"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1058-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(data))</span></code></pre></div>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1059-1" aria-hidden="true" tabindex="-1"></a>resumen <span class="ot">&lt;-</span> replicaciones <span class="sc">|&gt;</span> <span class="fu">group_by</span>(n, tipo, rep) <span class="sc">|&gt;</span></span>
<span id="cb1059-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1059-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">promedio_recompensa =</span> <span class="fu">sum</span>(suma) <span class="sc">/</span> <span class="fu">sum</span>(conteo))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;n&#39;, &#39;tipo&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1061-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(resumen, <span class="fu">aes</span>(<span class="at">x=</span>n, <span class="at">y=</span> promedio_recompensa, <span class="at">colour =</span> <span class="fu">factor</span>(tipo), <span class="at">group=</span>tipo)) <span class="sc">+</span> <span class="fu">geom_line</span>()  <span class="sc">+</span></span>
<span id="cb1061-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1061-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.99</span>, <span class="at">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>rep)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<p><strong>Observación</strong>:</p>
<ul>
<li>Podemos afinar el algoritmo miope y el softmax para tener mejor desempeño con estos datos.
La ventaja de UCB1 es que no tenemos que afinar ningún parámetro, y
su desempeño es razonable sobre distintas corridas.</li>
</ul>
</div>
<div id="tragamonedas-bayesianos" class="section level2" number="12.8">
<h2><span class="header-section-number">12.8</span> Tragamonedas bayesianos</h2>
<p>Los
<em>tragamonedas bayesianos</em> presentan una manera más unificada para construir algoritmos
(basados en la distribución posterior de recompensa dada cada brazo). Ver por ejemplo
<a href="http://web.mi.imati.cnr.it/conferences/BAYSM2016/scott-baysm-bandits.pdf">Experiments in the Internet age: A modern Bayesian look at the multi-armed bandit</a>.
Ver también el curso de modelación bayesiana de la MCD.</p>
<p>La idea general es como sigue: cada brazo <span class="math inline">\(a\)</span> tiene una distribución
<span class="math display">\[p_a (y | \theta)\]</span>
de recompensas, que depende de parámetros <span class="math inline">\(\theta\)</span>. Tenemos una distribución
previa o inicial</p>
<p><span class="math display">\[p(\theta).\]</span></p>
<p>En cada paso <span class="math inline">\(t\)</span>, escogeremos al azar entre los brazos con probabilidades
<span class="math display">\[w_{1,t},w_{2,t}, \ldots w_{k, t}.\]</span>
Estos pesos queremos seleccionarlos de manera que sea más probable usar
brazos que tengan más evidencia de ser mejores. Así que podemos establecer
qe <span class="math inline">\(w_{a,t}\)</span> como la probabilidad posterior
de que el brazo <span class="math inline">\(a\)</span> sea el mejor, dada la información <span class="math inline">\(y_1,\ldots, y_{t-1}\)</span>.</p>
<p>Explícitamente, si i <span class="math inline">\(I_a(\theta)\)</span> es la función indicadora de “el brazo <span class="math inline">\(a\)</span> es el mejor en valor
esperado,” entonces ponemos <span class="math inline">\(w_{a,t}\)</span> como la probabilidad de que
<span class="math inline">\(a\)</span></p>
<p><span class="math display">\[w_{a,t} = E(I_a(\theta) | y_1,\ldots, y_{t-1}).\]</span></p>
<p>Para calcular este valor esperado, sólo necesitamos la posterior de <span class="math inline">\(\theta\)</span>
dados los datos <span class="math inline">\(y_1\ldots, y_{t-1}\)</span>, que cumple</p>
<p><span class="math display">\[p(\theta|y_1,\ldots, y_t) \propto p(\theta) \prod_{i=1}^t p_{a_i}(y_i|\theta),\]</span></p>
<p>Y ahora tenemos todos los ingredientes para nuestra estrategia de exploración
y explotación del tragamonedas</p>
<div id="ejemplo-bernoulli" class="section level3" number="12.8.1">
<h3><span class="header-section-number">12.8.1</span> Ejemplo bernoulli</h3>
<p>Podemos hacer el caso Bernoulli, donde las recompensas son 0 o 1 (por ejemplo, el usuario convierte o no). En este caso, cada brazo tiene una probabilidad <span class="math inline">\(\theta_i\)</span>
de conversión, que no conocemos al principio. Buscamos el brazo con <span class="math inline">\(\theta_i\)</span> más
grande.</p>
<p>Si la iniciales son <span class="math inline">\(\theta_a\sim U(0,1)\)</span> independientes, entonces es posible demostrar
que las <span class="math inline">\(p_a(\theta|y_1,\ldots, y_{t})\)</span> son distribuciones beta independientes
con parámetros
<span class="math display">\[\theta\vert y_1\ldots, y_{t}\sim Beta(Y_{a,t} + 1, N_{a,t} - Y_{a,t} + 1),\]</span>
donde <span class="math inline">\(N_{a,t}\)</span> es el número de veces que se ha usado la palanca <span class="math inline">\(a\)</span> al tiempo <span class="math inline">\(t\)</span>,
y <span class="math inline">\(Y_{a,t}\)</span> es el número de 1’s observado. Podemos simular de las betas para calcular los pesos <span class="math inline">\(w_{a,t+1}\)</span> de la siguiente forma:</p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-1" aria-hidden="true" tabindex="-1"></a>crear_bayesiano <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_fun, <span class="at">num_sims =</span> <span class="dv">1000</span>, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">1</span>){</span>
<span id="cb1062-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>  n_brazos <span class="ot">&lt;-</span> <span class="fu">environment</span>(sim_fun)<span class="sc">$</span>n_brazos</span>
<span id="cb1062-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>  conteos <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1062-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>  sumas <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, n_brazos)</span>
<span id="cb1062-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>  iteracion <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1062-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-6" aria-hidden="true" tabindex="-1"></a>  fun <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb1062-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-7" aria-hidden="true" tabindex="-1"></a>    sims_post <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">brazos =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos,</span>
<span id="cb1062-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">conteos =</span> conteos,</span>
<span id="cb1062-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">sumas =</span> sumas) <span class="sc">|&gt;</span> </span>
<span id="cb1062-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sims =</span> <span class="fu">map2</span>(conteos, sumas,</span>
<span id="cb1062-11"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-11" aria-hidden="true" tabindex="-1"></a>          <span class="cf">function</span>(n, y){</span>
<span id="cb1062-12"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">tibble</span>(<span class="at">sim_no =</span> <span class="dv">1</span><span class="sc">:</span>num_sims, </span>
<span id="cb1062-13"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">valor =</span> <span class="fu">rbeta</span>(num_sims, y <span class="sc">+</span> a, n <span class="sc">-</span> y <span class="sc">+</span> b))</span>
<span id="cb1062-14"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-14" aria-hidden="true" tabindex="-1"></a>          })) <span class="sc">|&gt;</span> </span>
<span id="cb1062-15"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(brazos, sims) <span class="sc">|&gt;</span> <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="st">&quot;sims&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1062-16"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(sim_no) <span class="sc">|&gt;</span> </span>
<span id="cb1062-17"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(valor <span class="sc">==</span> <span class="fu">max</span>(valor))</span>
<span id="cb1062-18"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-18" aria-hidden="true" tabindex="-1"></a>    pesos <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">brazos =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos)  </span>
<span id="cb1062-19"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-19" aria-hidden="true" tabindex="-1"></a>    resumen <span class="ot">&lt;-</span> sims_post <span class="sc">|&gt;</span> <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> <span class="fu">select</span>(brazos) <span class="sc">|&gt;</span></span>
<span id="cb1062-20"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(brazos) <span class="sc">|&gt;</span> </span>
<span id="cb1062-21"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">n</span>() <span class="sc">/</span> num_sims) </span>
<span id="cb1062-22"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-22" aria-hidden="true" tabindex="-1"></a>    pesos <span class="ot">&lt;-</span> pesos <span class="sc">|&gt;</span> <span class="fu">left_join</span>(resumen, <span class="at">by =</span> <span class="st">&quot;brazos&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1062-23"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(prop), <span class="dv">0</span>, prop))</span>
<span id="cb1062-24"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-24" aria-hidden="true" tabindex="-1"></a>    brazo <span class="ot">&lt;-</span> <span class="fu">sample</span>(pesos<span class="sc">$</span>brazos, <span class="dv">1</span>, <span class="at">prob =</span> pesos<span class="sc">$</span>prop)  </span>
<span id="cb1062-25"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-25" aria-hidden="true" tabindex="-1"></a>    sim <span class="ot">&lt;-</span> <span class="fu">sim_fun</span>(brazo)</span>
<span id="cb1062-26"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-26" aria-hidden="true" tabindex="-1"></a>    iteracion <span class="ot">&lt;&lt;-</span> iteracion <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1062-27"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-27" aria-hidden="true" tabindex="-1"></a>    conteos[brazo] <span class="ot">&lt;&lt;-</span> conteos[brazo] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1062-28"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-28" aria-hidden="true" tabindex="-1"></a>    sumas[brazo] <span class="ot">&lt;&lt;-</span> sumas[brazo] <span class="sc">+</span> sim</span>
<span id="cb1062-29"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-29" aria-hidden="true" tabindex="-1"></a>    estado <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(<span class="at">n =</span> iteracion,</span>
<span id="cb1062-30"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-30" aria-hidden="true" tabindex="-1"></a>                         <span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span>n_brazos,</span>
<span id="cb1062-31"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-31" aria-hidden="true" tabindex="-1"></a>                         <span class="at">conteo =</span> conteos,</span>
<span id="cb1062-32"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-32" aria-hidden="true" tabindex="-1"></a>                         <span class="at">suma =</span> sumas) <span class="sc">|&gt;</span> </span>
<span id="cb1062-33"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">inf =</span> <span class="fu">map2_dbl</span>(conteo, suma, <span class="cf">function</span>(n, y){</span>
<span id="cb1062-34"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-34" aria-hidden="true" tabindex="-1"></a>        <span class="fu">qbeta</span>(<span class="fl">0.05</span>, y <span class="sc">+</span> a, n <span class="sc">-</span> y <span class="sc">+</span> b)</span>
<span id="cb1062-35"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-35" aria-hidden="true" tabindex="-1"></a>      })) <span class="sc">|&gt;</span> </span>
<span id="cb1062-36"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">sup =</span> <span class="fu">map2_dbl</span>(conteo, suma, <span class="cf">function</span>(n, y){</span>
<span id="cb1062-37"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-37" aria-hidden="true" tabindex="-1"></a>        <span class="fu">qbeta</span>(<span class="fl">0.95</span>, y <span class="sc">+</span> a, n <span class="sc">-</span> y <span class="sc">+</span> b)</span>
<span id="cb1062-38"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-38" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb1062-39"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-39" aria-hidden="true" tabindex="-1"></a>    estado</span>
<span id="cb1062-40"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1062-41"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-41" aria-hidden="true" tabindex="-1"></a>  fun</span>
<span id="cb1062-42"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1062-42" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Y simulamos un ejemplo:</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99770</span>)</span>
<span id="cb1063-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.30</span>, <span class="fl">0.15</span>, <span class="fl">0.28</span>)</span>
<span id="cb1063-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-3" aria-hidden="true" tabindex="-1"></a>sim_3 <span class="ot">&lt;-</span> <span class="fu">crear_maquina_bernoulli</span>(<span class="at">lambda =</span> lambda)</span>
<span id="cb1063-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-4" aria-hidden="true" tabindex="-1"></a>bayesiano <span class="ot">&lt;-</span> <span class="fu">crear_bayesiano</span>(<span class="at">sim_fun =</span> sim_3)</span>
<span id="cb1063-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-5" aria-hidden="true" tabindex="-1"></a>df_iteraciones <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">600</span>, <span class="cf">function</span>(i){</span>
<span id="cb1063-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bayesiano</span>()</span>
<span id="cb1063-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-7" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb1063-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1063-8" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(df_iteraciones)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##       n brazo conteo  suma     inf   sup
##   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1   599     3     62     9 0.0887  0.236
## 2   599     4    160    39 0.193   0.304
## 3   600     1     14     0 0.00341 0.181
## 4   600     2    363    95 0.226   0.302
## 5   600     3     62     9 0.0887  0.236
## 6   600     4    161    39 0.192   0.302</code></pre>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_iteraciones, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">ymin =</span> inf, <span class="at">ymax =</span> sup)) <span class="sc">+</span></span>
<span id="cb1065-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>brazo, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1065-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lambda), <span class="at">prob =</span> lambda),</span>
<span id="cb1065-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> prob), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb1065-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">max</span>(lambda)), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb1065-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1065-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Podemos usar nuestra información antes del experimento. Por ejemplo,
en el caso de conversiones, las proporciones son muchas veces chicas,
por ejemplo</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1066-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">99771</span>)</span>
<span id="cb1066-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1066-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span>  <span class="fu">c</span>(<span class="fl">0.03</span>, <span class="fl">0.035</span>, <span class="fl">0.01</span>, <span class="fl">0.004</span>)</span>
<span id="cb1066-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1066-3" aria-hidden="true" tabindex="-1"></a>sim_3 <span class="ot">&lt;-</span> <span class="fu">crear_maquina_bernoulli</span>(<span class="at">lambda =</span> lambda)</span>
<span id="cb1066-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1066-4" aria-hidden="true" tabindex="-1"></a><span class="co"># iniciales beta(1, 6)</span></span>
<span id="cb1066-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1066-5" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(<span class="fu">rbeta</span>(<span class="dv">1500</span>, <span class="dv">1</span>, <span class="dv">20</span>))</span></code></pre></div>
<pre><code>##           0%          25%          50%          75%         100% 
## 1.330201e-05 1.366322e-02 3.040549e-02 6.223616e-02 3.270955e-01</code></pre>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-1" aria-hidden="true" tabindex="-1"></a>bayesiano <span class="ot">&lt;-</span> <span class="fu">crear_bayesiano</span>(<span class="at">sim_fun =</span> sim_3, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">20</span>)</span>
<span id="cb1068-2"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-2" aria-hidden="true" tabindex="-1"></a>df_iteraciones_2 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">1500</span>, <span class="cf">function</span>(i){</span>
<span id="cb1068-3"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bayesiano</span>()</span>
<span id="cb1068-4"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-4" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb1068-5"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_iteraciones_2, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">ymin =</span> inf, <span class="at">ymax =</span> sup)) <span class="sc">+</span></span>
<span id="cb1068-6"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>brazo, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1068-7"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">brazo =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(lambda), <span class="at">prob =</span> lambda),</span>
<span id="cb1068-8"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> prob), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb1068-9"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fu">max</span>(lambda)), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb1068-10"><a href="experimentación-y-algoritmos-de-tragamonedas-bandits.html#cb1068-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>)</span></code></pre></div>
<p><img src="11-bandits_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Observaciones:</p>
<ul>
<li>Con este esquema, cuando la probabilidad posterior de que <span class="math inline">\(\theta_a &gt; \theta_b\)</span>
es muy alta, entonces preferimos casi siempre al brazo <span class="math inline">\(a\)</span> sobre el brazo <span class="math inline">\(b\)</span>.</li>
<li>Es necesario poner iniciales apropiadas para el problema. Por ejemplo,
las conversiones (para muchas definiciones) rara vez superan 5%, y en muchos casos
son considerablemente menores a 1%. Nótese que una especificación incorrecta
de la inicial puede requerir corridas más largas, e intervalos de probabilidad
mal calibrados.</li>
<li>Este esquema puede aplicarse con eficiencia a esquemas más
complejos, considerando modelos más refinados para <span class="math inline">\(p_a(y|\theta)\)</span>. Por ejemplo,
puede haber parámetros compartidos entre los modelos, podemos usar regresión,
etc. La simulación de la posterior en estos casos puede hacerse mediante MCMC,
por ejemplo.</li>
</ul>
</div>
</div>
<div id="otros-aspectos-de-la-experimentación-y-máquinas-tragamonedas" class="section level2" number="12.9">
<h2><span class="header-section-number">12.9</span> Otros aspectos de la experimentación y máquinas tragamonedas</h2>
<p>Hay varios aspectos que tenemos que cuidar cuando planeamos hacer experimentación online ([<span class="citation"><a href="#ref-whitebandits" role="doc-biblioref">White</a> (<a href="#ref-whitebandits" role="doc-biblioref">2012</a>)</span>):</p>
<ol style="list-style-type: decimal">
<li>¿Nuestro código de experimentación y de evaluación está funcionando como debe?</li>
<li>¿Hemos escogido correctamente las métricas que queremos optimizar?</li>
<li>¿Existe información adicional de contexto (por ejemplo, tipo de usuarios) de la queremos
aprender también? (por ejemplo, encontrar valor de los brazos según tipo de usuario).</li>
</ol>
<div id="pruebas-aa" class="section level3 unnumbered">
<h3>Pruebas A/A</h3>
<p>Una forma robusta de validar nuestro código y la infraestructura de experimentación es
correr experimentos A/A antes de nuestras tragamonedas o experimentos A/B. En un experimento
A/A, aplicamos el tragamonedas, pero todos los tratamientos son iguales. Si corremos suficiente
tiempo el experimento, debemos observar que los brazos convergen en desempeño promedio.</p>
<p>Cuando esto no sucede, quiere decir existe un error en nuestra infraestructura de
experimentación. Estos problemas suceden en la práctica pues esa infraestura es típicamente
no trivial, pues toca todos los puntos de nuestro sitio web. Ver por ejemplo el
paper <a href="http://notes.stephenholiday.com/Five-Puzzling-Outcomes.pdf">trustworthy online controlled experiments five puzzling outcomes explained</a>. Puedes leer más
acerca del diseño de la plataforma completa de experimentación en Google en <a href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/36500.pdf">Overlapping Experiment Infrastructure: More, Better, Faster Experimentation</a>.</p>
</div>
<div id="métricas-de-éxito-defectuosas" class="section level3 unnumbered">
<h3>Métricas de éxito defectuosas</h3>
<p>La experimentación automatizada, bajo las métricas incorrectas de éxito, puede ser
contraproducente. Por ejemplo, la degradación de resultados de búsqueda, en el corto plazo,
puede producir:</p>
<ul>
<li>Más clicks por usuario (una métrica posible de éxito), pues es más dificil encontrar los resultados que le interesa al usuario</li>
<li>Más clicks en anuncios (y más ganancias de publicidad), pues dada la pobreza de los resultados los usuarios recurren artificalmente a los anuncios de <em>paid search</em>.</li>
<li>Más clicks en artículos recomendados, por la misma razón.
Todas estas son ganancias a corto plazo, pero a largo plazo dañan el negocio.</li>
</ul>
</div>
<div id="tragamonedas-contextuales" class="section level3" number="12.9.1">
<h3><span class="header-section-number">12.9.1</span> Tragamonedas contextuales</h3>
<p>Podemos también utilizar modelos para obtener recompensas contextuales, en donde construimos
modelos para la recompensas de cada brazo según variables adicionales que tengamos (por ejemplo, tipo de usuario, hora del día, etc.). En los ejemplos que vimos arriba, nos interesaba simplemente
calcular <span class="math inline">\(E(R_i)\)</span> para cada uno de los brazos. Sin embargo, podemos modelar también
en función de covariables, y estimar <span class="math inline">\(E(R_i|X)\)</span> con algún modelo (por ejemplo, regresión lineal).
Ver por ejemplo <a href="http://rob.schapire.net/papers/www10.pdf">este paper</a>.</p>

</div>
</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-auerbandits" class="csl-entry">
Auer, Peter, Nicolò Cesa-Bianchi, and Paul Fischer. 2002. <span>“Finite-Time Analysis of the Multiarmed Bandit Problem.”</span> <em>Mach. Learn.</em> 47 (2-3): 235–56. <a href="https://doi.org/10.1023/A:1013689704352">https://doi.org/10.1023/A:1013689704352</a>.
</div>
<div id="ref-causalimpact" class="csl-entry">
Brodersen, Kay H., Fabian Gallusser, Jim Koehler, Nicolas Remy, and Steven L. Scott. 2015. <span>“Inferring Causal Impact Using Bayesian Structural Time-Series Models.”</span> <em>Annals of Applied Statistics</em> 9: 247–74.
</div>
<div id="ref-varian" class="csl-entry">
Varian, Hal R. 2016. <span>“Causal Inference in Economics and Marketing.”</span> <em>Proceedings of the National Academy of Sciences</em> 113 (27): 7310–15. <a href="https://doi.org/10.1073/pnas.1510479113">https://doi.org/10.1073/pnas.1510479113</a>.
</div>
<div id="ref-whitebandits" class="csl-entry">
White, J. M. 2012. <em>Bandit Algorithms for Website Optimization</em>. O’Reilly. <a href="https://books.google.com.mx/books?id=-JSLAQAACAAJ">https://books.google.com.mx/books?id=-JSLAQAACAAJ</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="t-sne-y-reducción-de-dimensionalidad.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referencias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/felipegonzalez/metodos-analiticos-mcd-2022/edit/master/notas/11-bandits.Rmd",
"text": "Editar"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
