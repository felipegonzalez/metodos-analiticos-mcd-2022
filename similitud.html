<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Similitud y vecinos cercanos | Métodos analíticos, ITAM 2022</title>
  <meta name="description" content="Notas para métodos analíticos 2022" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Similitud y vecinos cercanos | Métodos analíticos, ITAM 2022" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Notas para métodos analíticos 2022" />
  <meta name="github-repo" content="felipexgonzalez/metodos-analiticos-mcd-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Similitud y vecinos cercanos | Métodos analíticos, ITAM 2022" />
  
  <meta name="twitter:description" content="Notas para métodos analíticos 2022" />
  

<meta name="author" content="Felipe González" />


<meta name="date" content="2022-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="frecuentes.html"/>
<link rel="next" href="dvs-y-reducción-de-dimensionalidad.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.20/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/vis-9.1.0/vis-network.min.css" rel="stylesheet" />
<script src="libs/vis-9.1.0/vis-network.min.js"></script>
<script src="libs/visNetwork-binding-2.1.0/visNetwork.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Métodos Analíticos</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Temario</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#evaluación"><i class="fa fa-check"></i>Evaluación</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introducción</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#simlitud-en-dimensión-alta"><i class="fa fa-check"></i>Simlitud en dimensión alta</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#medidas-de-distancia-o-similitud"><i class="fa fa-check"></i>Medidas de distancia o similitud</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#tipos-de-soluciones"><i class="fa fa-check"></i>Tipos de soluciones</a>
<ul>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#proyección-y-búsqueda-de-marginales-interesantes"><i class="fa fa-check"></i>Proyección y búsqueda de marginales interesantes</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#proyecciones-globales"><i class="fa fa-check"></i>Proyecciones globales</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#descripción-de-estructura-local"><i class="fa fa-check"></i>Descripción de estructura local</a></li>
<li class="chapter" data-level="" data-path="intro.html"><a href="intro.html#inmersiones-embeddings"><i class="fa fa-check"></i>Inmersiones (embeddings)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="frecuentes.html"><a href="frecuentes.html"><i class="fa fa-check"></i><b>2</b> Análisis de conjuntos frecuentes</a>
<ul>
<li class="chapter" data-level="2.1" data-path="frecuentes.html"><a href="frecuentes.html#datos-de-canastas"><i class="fa fa-check"></i><b>2.1</b> Datos de canastas</a></li>
<li class="chapter" data-level="2.2" data-path="frecuentes.html"><a href="frecuentes.html#conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.2</b> Conjuntos frecuentes</a></li>
<li class="chapter" data-level="2.3" data-path="frecuentes.html"><a href="frecuentes.html#monotonicidad-de-conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.3</b> Monotonicidad de conjuntos frecuentes</a></li>
<li class="chapter" data-level="2.4" data-path="frecuentes.html"><a href="frecuentes.html#algoritmo-a-priori"><i class="fa fa-check"></i><b>2.4</b> Algoritmo a-priori</a></li>
<li class="chapter" data-level="2.5" data-path="frecuentes.html"><a href="frecuentes.html#modelos-simples-para-análisis-de-canastas"><i class="fa fa-check"></i><b>2.5</b> Modelos simples para análisis de canastas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-3"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#modelo-de-artículos-independientes"><i class="fa fa-check"></i>Modelo de artículos independientes</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="frecuentes.html"><a href="frecuentes.html#soporte-teórico-y-conjuntos-frecuentes"><i class="fa fa-check"></i><b>2.6</b> Soporte teórico y conjuntos frecuentes</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-4"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="frecuentes.html"><a href="frecuentes.html#reglas-de-asociación"><i class="fa fa-check"></i><b>2.7</b> Reglas de asociación</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-5"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-6"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="frecuentes.html"><a href="frecuentes.html#dificultades-en-el-análisis-de-canastas"><i class="fa fa-check"></i><b>2.8</b> Dificultades en el análisis de canastas</a></li>
<li class="chapter" data-level="2.9" data-path="frecuentes.html"><a href="frecuentes.html#otras-medidas-de-calidad-de-reglas"><i class="fa fa-check"></i><b>2.9</b> Otras medidas de calidad de reglas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#hyper-lift-bajo-hipótesis-de-independencia"><i class="fa fa-check"></i>Hyper-lift bajo hipótesis de independencia</a></li>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#hyper-lift-para-datos-de-canastas"><i class="fa fa-check"></i>Hyper-lift para datos de canastas</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="frecuentes.html"><a href="frecuentes.html#selección-de-reglas"><i class="fa fa-check"></i><b>2.10</b> Selección de reglas</a>
<ul>
<li class="chapter" data-level="" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-canastas-grandes"><i class="fa fa-check"></i>Ejemplo: canastas grandes</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="frecuentes.html"><a href="frecuentes.html#búsqueda-de-reglas-especializadas"><i class="fa fa-check"></i><b>2.11</b> Búsqueda de reglas especializadas</a></li>
<li class="chapter" data-level="2.12" data-path="frecuentes.html"><a href="frecuentes.html#visualización-de-asociaciones"><i class="fa fa-check"></i><b>2.12</b> Visualización de asociaciones</a>
<ul>
<li class="chapter" data-level="2.12.1" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo-canastas"><i class="fa fa-check"></i><b>2.12.1</b> Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="2.13" data-path="frecuentes.html"><a href="frecuentes.html#otras-aplicaciones"><i class="fa fa-check"></i><b>2.13</b> Otras aplicaciones</a></li>
<li class="chapter" data-level="2.14" data-path="frecuentes.html"><a href="frecuentes.html#ejercicios"><i class="fa fa-check"></i><b>2.14</b> Ejercicios</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="similitud.html"><a href="similitud.html"><i class="fa fa-check"></i><b>3</b> Similitud y vecinos cercanos</a>
<ul>
<li class="chapter" data-level="3.1" data-path="similitud.html"><a href="similitud.html#similitud-de-conjuntos"><i class="fa fa-check"></i><b>3.1</b> Similitud de conjuntos</a></li>
<li class="chapter" data-level="3.2" data-path="similitud.html"><a href="similitud.html#representación-de-documentos-como-conjuntos"><i class="fa fa-check"></i><b>3.2</b> Representación de documentos como conjuntos</a></li>
<li class="chapter" data-level="3.3" data-path="similitud.html"><a href="similitud.html#representación-matricial"><i class="fa fa-check"></i><b>3.3</b> Representación matricial</a></li>
<li class="chapter" data-level="3.4" data-path="similitud.html"><a href="similitud.html#minhash-y-reducción-probabilística-de-dimensionalidad"><i class="fa fa-check"></i><b>3.4</b> Minhash y reducción probabilística de dimensionalidad</a></li>
<li class="chapter" data-level="3.5" data-path="similitud.html"><a href="similitud.html#agrupando-textos-de-similitud-alta"><i class="fa fa-check"></i><b>3.5</b> Agrupando textos de similitud alta</a></li>
<li class="chapter" data-level="3.6" data-path="similitud.html"><a href="similitud.html#ejemplo-tweets"><i class="fa fa-check"></i><b>3.6</b> Ejemplo: tweets</a></li>
<li class="chapter" data-level="3.7" data-path="similitud.html"><a href="similitud.html#verificar-si-un-nuevo-elemento-es-duplicado"><i class="fa fa-check"></i><b>3.7</b> Verificar si un nuevo elemento es duplicado</a></li>
<li class="chapter" data-level="3.8" data-path="similitud.html"><a href="similitud.html#controlando-la-sensibilidad-y-umbral-de-similitud"><i class="fa fa-check"></i><b>3.8</b> Controlando la sensibilidad y umbral de similitud</a></li>
<li class="chapter" data-level="3.9" data-path="similitud.html"><a href="similitud.html#distancia-euclideana-y-lsh"><i class="fa fa-check"></i><b>3.9</b> Distancia euclideana y LSH</a></li>
<li class="chapter" data-level="3.10" data-path="similitud.html"><a href="similitud.html#locality-sensitive-hashing-lsh"><i class="fa fa-check"></i><b>3.10</b> Locality Sensitive Hashing (LSH)</a></li>
<li class="chapter" data-level="3.11" data-path="similitud.html"><a href="similitud.html#lsh-para-imágenes"><i class="fa fa-check"></i><b>3.11</b> LSH para imágenes</a></li>
<li class="chapter" data-level="3.12" data-path="similitud.html"><a href="similitud.html#joins-por-similitud"><i class="fa fa-check"></i><b>3.12</b> Joins por similitud</a></li>
<li class="chapter" data-level="3.13" data-path="similitud.html"><a href="similitud.html#ejemplo-entity-matching"><i class="fa fa-check"></i><b>3.13</b> Ejemplo: entity matching</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html"><i class="fa fa-check"></i><b>4</b> DVS y reducción de dimensionalidad</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#descomposición-aditiva-en-matrices-de-rango-1"><i class="fa fa-check"></i><b>4.1</b> Descomposición aditiva en matrices de rango 1</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#matrices-de-rango-1"><i class="fa fa-check"></i><b>4.1.1</b> Matrices de rango 1</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-una-matriz-de-rango-1-de-preferencias"><i class="fa fa-check"></i>Ejemplo: una matriz de rango 1 de preferencias</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#aproximación-con-matrices-de-rango-1."><i class="fa fa-check"></i><b>4.2</b> Aproximación con matrices de rango 1.</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-12"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="4.2.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#suma-de-matrices-de-rango-1."><i class="fa fa-check"></i><b>4.2.1</b> Suma de matrices de rango 1.</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-películas"><i class="fa fa-check"></i>Ejemplo: películas</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#aproximación-con-matrices-de-rango-bajo"><i class="fa fa-check"></i><b>4.3</b> Aproximación con matrices de rango bajo</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#discusión-aproximación-de-rango-1."><i class="fa fa-check"></i><b>4.3.1</b> Discusión: aproximación de rango 1.</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#interpetación-de-vectores-singulares"><i class="fa fa-check"></i><b>4.4</b> Interpetación de vectores singulares</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-14"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="4.4.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#discusión-aproximaciones-de-rango-más-alto"><i class="fa fa-check"></i><b>4.4.1</b> Discusión: aproximaciones de rango más alto</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-15"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#descomposición-en-valores-singulares-svd-o-dvs"><i class="fa fa-check"></i><b>4.5</b> Descomposición en valores singulares (SVD o DVS)</a></li>
<li class="chapter" data-level="4.6" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#más-de-interpretación-geométrica"><i class="fa fa-check"></i><b>4.6</b> Más de interpretación geométrica</a></li>
<li class="chapter" data-level="4.7" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#svd-para-películas-de-netflix"><i class="fa fa-check"></i><b>4.7</b> SVD para películas de netflix</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#calidad-de-representación-de-svd."><i class="fa fa-check"></i><b>4.7.1</b> Calidad de representación de SVD.</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-16"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#componentes-principales"><i class="fa fa-check"></i><b>4.8</b> Componentes principales</a>
<ul>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#varianza-en-componentes-principales"><i class="fa fa-check"></i>Varianza en componentes principales</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#centrar-o-no-centrar-por-columna"><i class="fa fa-check"></i>¿Centrar o no centrar por columna?</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-resultados-similares"><i class="fa fa-check"></i>Ejemplo: resultados similares</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplos-donde-es-buena-idea-centrar"><i class="fa fa-check"></i>Ejemplos: donde es buena idea centrar</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#ejemplo-donde-no-centrar-funciona-bien"><i class="fa fa-check"></i>Ejemplo: donde no centrar funciona bien</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#otros-tipos-de-centrado"><i class="fa fa-check"></i>Otros tipos de centrado</a></li>
<li class="chapter" data-level="" data-path="dvs-y-reducción-de-dimensionalidad.html"><a href="dvs-y-reducción-de-dimensionalidad.html#reescalando-variables"><i class="fa fa-check"></i>Reescalando variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html"><i class="fa fa-check"></i><b>5</b> Sistemas de recomendación y filtrado colaborativo</a>
<ul>
<li class="chapter" data-level="5.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#enfoques-de-recomendación"><i class="fa fa-check"></i><b>5.1</b> Enfoques de recomendación</a></li>
<li class="chapter" data-level="5.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#datos"><i class="fa fa-check"></i><b>5.2</b> Datos</a>
<ul>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-18"><i class="fa fa-check"></i>Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#modelos-de-referencia-y-evaluación"><i class="fa fa-check"></i><b>5.3</b> Modelos de referencia y evaluación</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#evaluación-de-predicciones"><i class="fa fa-check"></i><b>5.3.1</b> Evaluación de predicciones</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-datos-de-netflix"><i class="fa fa-check"></i>Ejemplo: datos de Netflix</a></li>
<li class="chapter" data-level="5.3.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#opcional-efectos-en-análisis-de-heterogeneidad-en-uso-de-escala"><i class="fa fa-check"></i><b>5.3.2</b> (Opcional) Efectos en análisis de heterogeneidad en uso de escala</a></li>
<li class="chapter" data-level="5.3.3" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>5.3.3</b> Ejemplo</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#modelo-de-referencia"><i class="fa fa-check"></i><b>5.4</b> Modelo de referencia</a>
<ul>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejercicio-modelo-de-referencia-para-netflix"><i class="fa fa-check"></i>Ejercicio: modelo de referencia para Netflix</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#filtrado-colaborativo-similitud"><i class="fa fa-check"></i><b>5.5</b> Filtrado colaborativo: similitud</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#simitems"><i class="fa fa-check"></i><b>5.5.1</b> Cálculo de similitud entre usuarios/películas</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-19"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejemplo-cómo-se-ven-las-calificaciones-de-películas-similaresno-similares"><i class="fa fa-check"></i>Ejemplo: ¿cómo se ven las calificaciones de películas similares/no similares?</a></li>
<li class="chapter" data-level="" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#ejercicio-4"><i class="fa fa-check"></i>Ejercicio</a></li>
<li class="chapter" data-level="5.5.2" data-path="sistemas-de-recomendación-y-filtrado-colaborativo.html"><a href="sistemas-de-recomendación-y-filtrado-colaborativo.html#implementación"><i class="fa fa-check"></i><b>5.5.2</b> Implementación</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html"><i class="fa fa-check"></i><b>6</b> Dimensiones latentes para recomendación</a>
<ul>
<li class="chapter" data-level="6.0.1" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>6.0.1</b> Ejemplo: una dimensión latente</a></li>
<li class="chapter" data-level="6.0.2" data-path="frecuentes.html"><a href="frecuentes.html#ejemplo"><i class="fa fa-check"></i><b>6.0.2</b> Ejemplo: dos dimensiones latentes</a></li>
<li class="chapter" data-level="6.0.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#combinación-con-modelo-base"><i class="fa fa-check"></i><b>6.0.3</b> Combinación con modelo base</a></li>
<li class="chapter" data-level="6.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#factorización-de-matrices"><i class="fa fa-check"></i><b>6.1</b> Factorización de matrices</a></li>
<li class="chapter" data-level="6.2" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#mínimos-cuadrados-alternados"><i class="fa fa-check"></i><b>6.2</b> Mínimos cuadrados alternados</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#mínimos-cuadrados-alternados-con-regularización"><i class="fa fa-check"></i><b>6.2.1</b> Mínimos cuadrados alternados con regularización</a></li>
<li class="chapter" data-level="" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejercicio-5"><i class="fa fa-check"></i>Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#retroalimentación-implícita"><i class="fa fa-check"></i><b>6.3</b> Retroalimentación implícita</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejemplo-20"><i class="fa fa-check"></i><b>6.3.1</b> Ejemplo</a></li>
<li class="chapter" data-level="6.3.2" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#ejemplo-21"><i class="fa fa-check"></i><b>6.3.2</b> Ejemplo</a></li>
<li class="chapter" data-level="6.3.3" data-path="dimensiones-latentes-para-recomendación.html"><a href="dimensiones-latentes-para-recomendación.html#evaluación-para-modelos-implícitos"><i class="fa fa-check"></i><b>6.3.3</b> Evaluación para modelos implícitos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html"><i class="fa fa-check"></i><b>7</b> Pagerank y análisis de redes</a>
<ul>
<li class="chapter" data-level="7.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#introducción"><i class="fa fa-check"></i><b>7.1</b> Introducción</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#centralidad-en-redes"><i class="fa fa-check"></i><b>7.1.1</b> Centralidad en redes</a></li>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejemplo-de-moviegalaxies.com-pulp-fiction"><i class="fa fa-check"></i>Ejemplo de Moviegalaxies.com: Pulp Fiction</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#tipos-de-redes-y-su-representación"><i class="fa fa-check"></i><b>7.2</b> Tipos de redes y su representación</a></li>
<li class="chapter" data-level="7.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#visualización-de-redes"><i class="fa fa-check"></i><b>7.3</b> Visualización de redes</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejercicio-6"><i class="fa fa-check"></i><b>7.3.1</b> Ejercicio</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medidas-de-centralidad-para-redes"><i class="fa fa-check"></i><b>7.4</b> Medidas de centralidad para redes</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#grado"><i class="fa fa-check"></i><b>7.4.1</b> Grado</a></li>
<li class="chapter" data-level="7.4.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medida-de-centralidad-betweeness-o-intermediación"><i class="fa fa-check"></i><b>7.4.2</b> Medida de centralidad: <em>Betweeness</em> o <em>Intermediación</em></a></li>
<li class="chapter" data-level="7.4.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#medida-de-centralidad-cercanía"><i class="fa fa-check"></i><b>7.4.3</b> Medida de centralidad: Cercanía</a></li>
<li class="chapter" data-level="7.4.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#centralidad-de-eigenvector"><i class="fa fa-check"></i><b>7.4.4</b> Centralidad de eigenvector</a></li>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matrices-irreducibles-y-gráficas-fuertemente-conexas"><i class="fa fa-check"></i>Matrices irreducibles y gráficas fuertemente conexas</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#gráficas-dirigidas"><i class="fa fa-check"></i><b>7.5</b> Gráficas dirigidas</a>
<ul>
<li><a href="pagerank-y-análisis-de-redes.html#ejemplos-qué-pasa-si-a-es-no-reducible">Ejemplos: ¿qué pasa si <span class="math inline">\(A\)</span> es no reducible?</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank"><i class="fa fa-check"></i><b>7.6</b> Pagerank</a>
<ul>
<li class="chapter" data-level="" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#ejemplo-24"><i class="fa fa-check"></i>Ejemplo</a></li>
<li class="chapter" data-level="7.6.1" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#la-matriz-m-es-estocástica"><i class="fa fa-check"></i><b>7.6.1</b> La matriz <span class="math inline">\(M\)</span> es estocástica</a></li>
<li class="chapter" data-level="7.6.2" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#primeras-dificultades"><i class="fa fa-check"></i><b>7.6.2</b> Primeras dificultades</a></li>
<li class="chapter" data-level="7.6.3" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#el-proceso-estocástico-cadena-de-markov-asociado-al-pagerank-versión-simple"><i class="fa fa-check"></i><b>7.6.3</b> El proceso estocástico (cadena de Markov) asociado al Pagerank, versión simple</a></li>
<li class="chapter" data-level="7.6.4" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matriz-de-transición"><i class="fa fa-check"></i><b>7.6.4</b> Matriz de transición</a></li>
<li class="chapter" data-level="7.6.5" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#distribución-de-equilibrio-versión-simple"><i class="fa fa-check"></i><b>7.6.5</b> Distribución de equilibrio (versión simple)</a></li>
<li class="chapter" data-level="7.6.6" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#distribución-de-equilibrio-y-probabilidades-a-largo-plazo"><i class="fa fa-check"></i><b>7.6.6</b> Distribución de equilibrio y probabilidades a largo plazo</a></li>
<li class="chapter" data-level="7.6.7" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#matriz-de-transición-a-k-pasos"><i class="fa fa-check"></i><b>7.6.7</b> Matriz de transición a <span class="math inline">\(k\)</span> pasos</a></li>
<li class="chapter" data-level="7.6.8" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank-teletransportaciónperturbación-de-la-matriz-m"><i class="fa fa-check"></i><b>7.6.8</b> Pagerank: teletransportación/perturbación de la matriz <span class="math inline">\(M\)</span></a></li>
<li class="chapter" data-level="7.6.9" data-path="pagerank-y-análisis-de-redes.html"><a href="pagerank-y-análisis-de-redes.html#pagerank-para-buscador"><i class="fa fa-check"></i><b>7.6.9</b> Pagerank para buscador</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html"><i class="fa fa-check"></i><b>8</b> Detección de comunidades</a>
<ul>
<li class="chapter" data-level="8.1" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html#modularidad"><i class="fa fa-check"></i><b>8.1</b> Modularidad</a></li>
<li class="chapter" data-level="8.2" data-path="detección-de-comunidades.html"><a href="detección-de-comunidades.html#algoritmo-miope-fast-greedy"><i class="fa fa-check"></i><b>8.2</b> Algoritmo miope (fast greedy)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="divider"></li>
<li><a href="https://github.com/felipegonzalez/metodos-analiticos-mcd-2022" target="blank">Repositorio de Github</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Métodos analíticos, ITAM 2022</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="similitud" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Similitud y vecinos cercanos</h1>
<p>En esta parte consideraremos la tarea de agrupar eficientemente elementos muy similares
en conjuntos datos masivos.</p>
<p>Algunos ejemplos de esta tarea son:</p>
<ul>
<li>Encontrar documentos similares en una colección de documentos. Esto puede
servir para detectar
plagio, deduplicar noticias o páginas web, hacer <em>matching</em> de datos
de dos fuentes (por ejemplo, nombres completos de personas),
etc. Ver por ejemplo <a href="(https://dl.acm.org/citation.cfm?id=1242610)">Google News</a>.</li>
<li>Encontrar usuarios similares (Netflix), en el sentido de que tienen gustos similares, o películas similares, en el sentido de qe le gustan a las mismas personas.</li>
<li>Encontrar imágenes similares en una colección grande, ver por ejemplo <a href="https://medium.com/@Pinterest_Engineering/detecting-image-similarity-using-spark-lsh-and-tensorflow-618636afc939">Pinterest</a>.</li>
<li>Uber: rutas similares que indican (fraude o abusos)[<a href="https://eng.uber.com/lsh/" class="uri">https://eng.uber.com/lsh/</a>].</li>
<li>Deduplicar registros de usuarios de algún servicio (por ejemplo, beneficiarios
de programas sociales).</li>
</ul>
<p>Estos problemas no son triviales por dos razones:</p>
<ul>
<li>Los elementos que queremos comparar muchas veces están naturalmente representados en espacios de dimensión alta, y es relativamente costoso comparar un par (documentos, imágenes, usuarios, rutas). Muchas veces es preferible construir una representación más compacta y hacer comparaciones con las versiones comprimidas.</li>
<li>Si la colección de elementos es grande (<span class="math inline">\(N\)</span>), entonces el número de pares
posibles es del orden de <span class="math inline">\(N^2\)</span>, y es muy costoso hacer todas las posibles comparaciones para encontrar los elementos similares (por ejemplo, comparar
<span class="math inline">\(100\)</span> mil documentos, con unas <span class="math inline">\(10\)</span> mil comparaciones por segundo, tardaría alrededor de <span class="math inline">\(5\)</span> días).</li>
</ul>
<p>Si tenemos que calcular <em>todas</em> las similitudes, no hay mucho qué hacer. Pero
muchas veces nos interesa encontrar pares de similitud alta, o completar tareas
más específicas como contar duplicados, etc. En estos casos, veremos que es
posible construir soluciones probabilísticas aproximadas para resolver estos
problemas de forma escalable.</p>
<p>Aunque veremos más adelante métricas de similitud comunes como
la dada por la distancia euclideana o distancia coseno, por ejemplo, en
esta primera parte nos concentramos en discutir similitud entre
pares de textos. Los textos los podemos ver como colecciones de palabras, o
de manera más general, como colecciones de cadenas.</p>
<div id="similitud-de-conjuntos" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Similitud de conjuntos</h2>
<p>Muchos de estos problemas de similitud se pueden pensar como
problemas de similitud entre conjuntos. Por ejemplo, los documentos son conjuntos de palabras, conjuntos
de pares de palabras, sucesiones de caracteres,
una película se puede ver como el conjunto de personas a las que les gustó, o una ruta
como un conjunto de tramos, etc.</p>
<p>Hay muchas medidas que son útiles para cuantificar la similitud entre conjuntos. Una que es popular, y que explotaremos por sus propiedades, es la similitud de Jaccard:</p>

<div class="resumen">
La <strong>similitud de Jaccard</strong> de los conjuntos <span class="math inline">\(A\)</span> y <span class="math inline">\(B\)</span> está dada por
<span class="math display">\[sim(A,B) = \frac{|A\cap B|}{|A\cup B|}\]</span>
</div>
<p>Esta medida cuantifica qué tan cerca está la unión de <span class="math inline">\(A\)</span> y <span class="math inline">\(B\)</span> de su intersección. Cuanto más parecidos sean <span class="math inline">\(A\cup B\)</span> y <span class="math inline">\(A\cap B\)</span>, más similares son los conjuntos. En términos geométricos, es el área de la intersección entre el área de la unión.</p>
<div id="ejercicio-3" class="section level4 unnumbered">
<h4>Ejercicio</h4>
<p>Calcula la similitud de Jaccard entre los conjuntos <span class="math inline">\(A=\{5,2,34,1,20,3,4\}\)</span>
y <span class="math inline">\(B=\{19,1,2,5\}\)</span></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="similitud.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb106-2"><a href="similitud.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb106-3"><a href="similitud.html#cb106-3" aria-hidden="true" tabindex="-1"></a>sim_jaccard <span class="ot">&lt;-</span> \(a, b)  <span class="fu">length</span>(<span class="fu">intersect</span>(a, b)) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">union</span>(a, b))</span>
<span id="cb106-4"><a href="similitud.html#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>))</span>
<span id="cb106-5"><a href="similitud.html#cb106-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.667</span></span>
<span id="cb106-6"><a href="similitud.html#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>))</span>
<span id="cb106-7"><a href="similitud.html#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.286</span></span>
<span id="cb106-8"><a href="similitud.html#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb106-9"><a href="similitud.html#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span></code></pre></div>
</div>
</div>
<div id="representación-de-documentos-como-conjuntos" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Representación de documentos como conjuntos</h2>
<p>Hay varias maneras de representar documentos como conjuntos. Las más simples son:</p>
<ol style="list-style-type: decimal">
<li>Los documentos son colecciones de palabras, o conjuntos de sucesiones de palabras de tamaño <span class="math inline">\(n\)</span>.</li>
<li>Los documentos son colecciones de caracteres, o conjuntos de sucesiones de caracteres (cadenas) de tamaño <span class="math inline">\(k\)</span>.</li>
</ol>
<p>La primera representación se llama <em>representación de n-gramas</em>, y la segunda <em>representación de k-tejas</em>,
o <span class="math inline">\(k\)</span>-<em>shingles</em>. Nótese que en ambos casos, representaciones de dos documentos con secciones parecidas acomodadas en distintos lugares tienden a ser similares.</p>
<p>Consideremos una colección de textos cortos:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="similitud.html#cb107-1" aria-hidden="true" tabindex="-1"></a>textos <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;el perro persigue al gato pero no lo alcanza&quot;</span>, </span>
<span id="cb107-2"><a href="similitud.html#cb107-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;el gato persigue al perro, pero no lo alcanza&quot;</span>, </span>
<span id="cb107-3"><a href="similitud.html#cb107-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;este es el documento de ejemplo&quot;</span>, </span>
<span id="cb107-4"><a href="similitud.html#cb107-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;este no es el documento de los ejemplos&quot;</span>,</span>
<span id="cb107-5"><a href="similitud.html#cb107-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;documento más corto&quot;</span>,</span>
<span id="cb107-6"><a href="similitud.html#cb107-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;otros animales pueden ser mascotas&quot;</span>)</span></code></pre></div>
<p>Abajo mostramos la representacion en bolsa de palabras (1-gramas) y la representación en bigramas (2-gramas) de los primeros dos documentos:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="similitud.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bolsa de palabras (1-gramas)</span></span>
<span id="cb108-2"><a href="similitud.html#cb108-2" aria-hidden="true" tabindex="-1"></a>tokenizers<span class="sc">::</span><span class="fu">tokenize_ngrams</span>(textos[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">map</span>(unique)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;el&quot;       &quot;perro&quot;    &quot;persigue&quot; &quot;al&quot;       &quot;gato&quot;     &quot;pero&quot;     &quot;no&quot;      
## [8] &quot;lo&quot;       &quot;alcanza&quot; 
## 
## [[2]]
## [1] &quot;el&quot;       &quot;gato&quot;     &quot;persigue&quot; &quot;al&quot;       &quot;perro&quot;    &quot;pero&quot;     &quot;no&quot;      
## [8] &quot;lo&quot;       &quot;alcanza&quot;</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="similitud.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bigramas</span></span>
<span id="cb110-2"><a href="similitud.html#cb110-2" aria-hidden="true" tabindex="-1"></a>tokenizers<span class="sc">::</span><span class="fu">tokenize_ngrams</span>(textos[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">map</span>(unique)</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;el perro&quot;       &quot;perro persigue&quot; &quot;persigue al&quot;    &quot;al gato&quot;       
## [5] &quot;gato pero&quot;      &quot;pero no&quot;        &quot;no lo&quot;          &quot;lo alcanza&quot;    
## 
## [[2]]
## [1] &quot;el gato&quot;       &quot;gato persigue&quot; &quot;persigue al&quot;   &quot;al perro&quot;     
## [5] &quot;perro pero&quot;    &quot;pero no&quot;       &quot;no lo&quot;         &quot;lo alcanza&quot;</code></pre>
<p>La representación en <em>k-tejas</em> es otra posibilidad:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="similitud.html#cb112-1" aria-hidden="true" tabindex="-1"></a>calcular_tejas <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">k =</span> <span class="dv">2</span>){</span>
<span id="cb112-2"><a href="similitud.html#cb112-2" aria-hidden="true" tabindex="-1"></a>  tokenizers<span class="sc">::</span><span class="fu">tokenize_character_shingles</span>(x, <span class="at">n =</span> k, <span class="at">lowercase =</span> <span class="cn">FALSE</span>,</span>
<span id="cb112-3"><a href="similitud.html#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">TRUE</span>, <span class="at">strip_non_alpha =</span> <span class="cn">FALSE</span>)</span>
<span id="cb112-4"><a href="similitud.html#cb112-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-5"><a href="similitud.html#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2-tejas</span></span>
<span id="cb112-6"><a href="similitud.html#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="fu">calcular_tejas</span>(textos[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">k =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">map</span>(unique)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;el&quot; &quot;l &quot; &quot; p&quot; &quot;pe&quot; &quot;er&quot; &quot;rr&quot; &quot;ro&quot; &quot;o &quot; &quot;rs&quot; &quot;si&quot; &quot;ig&quot; &quot;gu&quot; &quot;ue&quot; &quot;e &quot; &quot; a&quot;
## [16] &quot;al&quot; &quot; g&quot; &quot;ga&quot; &quot;at&quot; &quot;to&quot; &quot; n&quot; &quot;no&quot; &quot; l&quot; &quot;lo&quot; &quot;lc&quot; &quot;ca&quot; &quot;an&quot; &quot;nz&quot; &quot;za&quot;
## 
## [[2]]
##  [1] &quot;el&quot; &quot;l &quot; &quot; g&quot; &quot;ga&quot; &quot;at&quot; &quot;to&quot; &quot;o &quot; &quot; p&quot; &quot;pe&quot; &quot;er&quot; &quot;rs&quot; &quot;si&quot; &quot;ig&quot; &quot;gu&quot; &quot;ue&quot;
## [16] &quot;e &quot; &quot; a&quot; &quot;al&quot; &quot;rr&quot; &quot;ro&quot; &quot;o,&quot; &quot;, &quot; &quot; n&quot; &quot;no&quot; &quot; l&quot; &quot;lo&quot; &quot;lc&quot; &quot;ca&quot; &quot;an&quot; &quot;nz&quot;
## [31] &quot;za&quot;</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="similitud.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4-tejas:&quot;</span></span>
<span id="cb114-2"><a href="similitud.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">calcular_tejas</span>(textos[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">k =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">map</span>(unique)</span></code></pre></div>
<pre><code>## [[1]]
##  [1] &quot;el p&quot; &quot;l pe&quot; &quot; per&quot; &quot;perr&quot; &quot;erro&quot; &quot;rro &quot; &quot;ro p&quot; &quot;o pe&quot; &quot;pers&quot; &quot;ersi&quot;
## [11] &quot;rsig&quot; &quot;sigu&quot; &quot;igue&quot; &quot;gue &quot; &quot;ue a&quot; &quot;e al&quot; &quot; al &quot; &quot;al g&quot; &quot;l ga&quot; &quot; gat&quot;
## [21] &quot;gato&quot; &quot;ato &quot; &quot;to p&quot; &quot;pero&quot; &quot;ero &quot; &quot;ro n&quot; &quot;o no&quot; &quot; no &quot; &quot;no l&quot; &quot;o lo&quot;
## [31] &quot; lo &quot; &quot;lo a&quot; &quot;o al&quot; &quot; alc&quot; &quot;alca&quot; &quot;lcan&quot; &quot;canz&quot; &quot;anza&quot;
## 
## [[2]]
##  [1] &quot;el g&quot; &quot;l ga&quot; &quot; gat&quot; &quot;gato&quot; &quot;ato &quot; &quot;to p&quot; &quot;o pe&quot; &quot; per&quot; &quot;pers&quot; &quot;ersi&quot;
## [11] &quot;rsig&quot; &quot;sigu&quot; &quot;igue&quot; &quot;gue &quot; &quot;ue a&quot; &quot;e al&quot; &quot; al &quot; &quot;al p&quot; &quot;l pe&quot; &quot;perr&quot;
## [21] &quot;erro&quot; &quot;rro,&quot; &quot;ro, &quot; &quot;o, p&quot; &quot;, pe&quot; &quot;pero&quot; &quot;ero &quot; &quot;ro n&quot; &quot;o no&quot; &quot; no &quot;
## [31] &quot;no l&quot; &quot;o lo&quot; &quot; lo &quot; &quot;lo a&quot; &quot;o al&quot; &quot; alc&quot; &quot;alca&quot; &quot;lcan&quot; &quot;canz&quot; &quot;anza&quot;</code></pre>
<p><strong>Observaciones</strong>:</p>
<ol style="list-style-type: decimal">
<li>Los <em>tokens</em> son las unidades básicas de análisis. Los <em>tokens</em> son palabras para los n-gramas (cuya definición no es del todo simple) y caracteres para las k-tejas. Podrían ser también oraciones, por ejemplo.</li>
<li>Nótese que en ambos casos es posible hacer algo de preprocesamiento para
obtener la representación. Transformaciones usuales son:</li>
</ol>
<ul>
<li>Eliminar puntuación y/o espacios.</li>
<li>Convertir los textos a minúsculas.</li>
<li>Esto incluye decisiones acerca de qué hacer con palabras compuestas (por ejemplo, con un guión), palabras que denotan un concepto (Reino Unido, por ejemplo) y otros detalles.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Si lo que nos interesa principalmente
similitud textual (no significado, o polaridad, etc.) entre documentos, entonces podemos usar <span class="math inline">\(k\)</span>-tejas, con un mínimo de preprocesamiento. Esta
representación es <strong>simple y flexible</strong> en el sentido de que se puede adaptar para documentos muy cortos (mensajes o tweets, por ejemplo), pero también para documentos más grandes.</li>
</ol>
<p>Por estas razones, no concentramos por el momento en <span class="math inline">\(k\)</span>-tejas</p>

<div class="resumen">
<p><strong>Tejas (shingles)</strong></p>
Sea <span class="math inline">\(k&gt;0\)</span> un entero. Las <span class="math inline">\(k\)</span>-tejas (<span class="math inline">\(k\)</span>-shingles) de un documento d
es el conjunto de todas las corridas (distintas) de <span class="math inline">\(k\)</span>
caracteres sucesivos.
Escogemos <span class="math inline">\(k\)</span> suficientemente grande, de forma que la probabilidad de que
una teja particular ocurra en un texto dado sea relativamente baja.
</div>
<div id="ejemplo-8" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>Documentos textualmente similares tienen tejas similares:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="similitud.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calcular tejas</span></span>
<span id="cb116-2"><a href="similitud.html#cb116-2" aria-hidden="true" tabindex="-1"></a>textos</span>
<span id="cb116-3"><a href="similitud.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] &quot;el perro persigue al gato pero no lo alcanza&quot; </span></span>
<span id="cb116-4"><a href="similitud.html#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="do">## [2] &quot;el gato persigue al perro, pero no lo alcanza&quot;</span></span>
<span id="cb116-5"><a href="similitud.html#cb116-5" aria-hidden="true" tabindex="-1"></a><span class="do">## [3] &quot;este es el documento de ejemplo&quot;              </span></span>
<span id="cb116-6"><a href="similitud.html#cb116-6" aria-hidden="true" tabindex="-1"></a><span class="do">## [4] &quot;este no es el documento de los ejemplos&quot;      </span></span>
<span id="cb116-7"><a href="similitud.html#cb116-7" aria-hidden="true" tabindex="-1"></a><span class="do">## [5] &quot;documento más corto&quot;                          </span></span>
<span id="cb116-8"><a href="similitud.html#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="do">## [6] &quot;otros animales pueden ser mascotas&quot;</span></span>
<span id="cb116-9"><a href="similitud.html#cb116-9" aria-hidden="true" tabindex="-1"></a>tejas_doc <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(textos, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb116-10"><a href="similitud.html#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="co"># calcular similitud de jaccard entre algunos pares</span></span>
<span id="cb116-11"><a href="similitud.html#cb116-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(tejas_doc[[<span class="dv">1</span>]], tejas_doc[[<span class="dv">2</span>]])</span>
<span id="cb116-12"><a href="similitud.html#cb116-12" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.773</span></span>
<span id="cb116-13"><a href="similitud.html#cb116-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(tejas_doc[[<span class="dv">1</span>]], tejas_doc[[<span class="dv">3</span>]])</span>
<span id="cb116-14"><a href="similitud.html#cb116-14" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0</span></span>
<span id="cb116-15"><a href="similitud.html#cb116-15" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(tejas_doc[[<span class="dv">4</span>]], tejas_doc[[<span class="dv">5</span>]])</span>
<span id="cb116-16"><a href="similitud.html#cb116-16" aria-hidden="true" tabindex="-1"></a><span class="do">## [1] 0.156</span></span></code></pre></div>
<p>Podemos calcular todas las similitudes:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="similitud.html#cb117-1" aria-hidden="true" tabindex="-1"></a>tejas_tbl <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">id_1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(textos), <span class="at">id_2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(textos)) <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="similitud.html#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id_1 <span class="sc">&lt;</span> id_2) <span class="sc">|&gt;</span> </span>
<span id="cb117-3"><a href="similitud.html#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tejas_1 =</span> tejas_doc[id_1], <span class="at">tejas_2 =</span> tejas_doc[id_2]) <span class="sc">|&gt;</span>   </span>
<span id="cb117-4"><a href="similitud.html#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">map2_dbl</span>(tejas_1, tejas_2, <span class="sc">~</span><span class="fu">sim_jaccard</span>(.x, .y))) <span class="sc">|&gt;</span> </span>
<span id="cb117-5"><a href="similitud.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, id_2, sim)</span>
<span id="cb117-6"><a href="similitud.html#cb117-6" aria-hidden="true" tabindex="-1"></a>tejas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 15 × 3
##     id_1  id_2    sim
##    &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
##  1     1     2 0.773 
##  2     1     3 0     
##  3     1     4 0.0137
##  4     1     5 0     
##  5     1     6 0     
##  6     2     3 0     
##  7     2     4 0.0133
##  8     2     5 0     
##  9     2     6 0     
## 10     3     4 0.6   
## 11     3     5 0.189 
## 12     3     6 0     
## 13     4     5 0.156 
## 14     4     6 0     
## 15     5     6 0</code></pre>
<p>pero nótese que, como señalamos arriba, esta operación será muy
costosa incluso si la colección de textos es de tamaño moderado.</p>
<ul>
<li><p>Si los textos
son cortos, entonces basta tomar valores como <span class="math inline">\(k=4,5\)</span>, pues hay un total de <span class="math inline">\(27^4\)</span> tejas
de tamaño <span class="math inline">\(4\)</span>, y el número de tejas de un documento corto (mensajes, tweets) es mucho más bajo que
<span class="math inline">\(27^4\)</span> (nota: ¿puedes explicar por qué este argumento no es exactamente correcto?)</p></li>
<li><p>Para documentos grandes, como noticias o artículos, es mejor escoger un tamaño más grande,
como <span class="math inline">\(k=9,10\)</span>, pues en documentos largos puede haber cientos de miles
de caracteres. Si <span class="math inline">\(k\)</span> fuera más chica entonces una gran parte de las tejas aparecerá en muchos de los documentos, y todos los documentos tendrían similitud alta.</p></li>
<li><p>Evitamos escoger <span class="math inline">\(k\)</span> demasiado grande, pues entonces los únicos documentos similares tendrían
que tener subcadenas largas exactamente iguales. Por ejemplo: “Batman y Robin” y “Robin y Batman” son algo
similares si usamos tejas de tamaño 3, pero son muy distintas si usamos tejas de tamaño 8:</p></li>
</ul>
</div>
<div id="ejemplo-9" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="similitud.html#cb119-1" aria-hidden="true" tabindex="-1"></a>tejas_1 <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(<span class="st">&quot;Batman y Robin&quot;</span>, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb119-2"><a href="similitud.html#cb119-2" aria-hidden="true" tabindex="-1"></a>tejas_2 <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(<span class="st">&quot;Robin y Batman&quot;</span>, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb119-3"><a href="similitud.html#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(tejas_1, tejas_2)</span></code></pre></div>
<pre><code>## [1] 0.6</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="similitud.html#cb121-1" aria-hidden="true" tabindex="-1"></a>tejas_1 <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(<span class="st">&quot;Batman y Robin&quot;</span>, <span class="at">k =</span> <span class="dv">8</span>)</span>
<span id="cb121-2"><a href="similitud.html#cb121-2" aria-hidden="true" tabindex="-1"></a>tejas_2 <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(<span class="st">&quot;Robin y Batman&quot;</span>, <span class="at">k =</span> <span class="dv">8</span>)</span>
<span id="cb121-3"><a href="similitud.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sim_jaccard</span>(tejas_1, tejas_2)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
</div>
<div id="representación-matricial" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Representación matricial</h2>
<p>Podemos usar una matriz binaria para guardar todas las
representaciones en k-tejas de nuestra colección de documentos. Puede usarse
una representación rala (<em>sparse</em>) si es necesario:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="similitud.html#cb123-1" aria-hidden="true" tabindex="-1"></a>dtejas_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id =</span> <span class="fu">paste0</span>(<span class="st">&quot;doc_&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(textos)), </span>
<span id="cb123-2"><a href="similitud.html#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">tejas =</span> tejas_doc) <span class="sc">|&gt;</span> </span>
<span id="cb123-3"><a href="similitud.html#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> tejas) <span class="sc">|&gt;</span> </span>
<span id="cb123-4"><a href="similitud.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">val =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb123-5"><a href="similitud.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> id, <span class="at">values_from =</span> val, <span class="at">values_fill =</span> <span class="fu">list</span>(<span class="at">val =</span> <span class="dv">0</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb123-6"><a href="similitud.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tejas) <span class="co"># opcionalmente ordenamos tejas</span></span>
<span id="cb123-7"><a href="similitud.html#cb123-7" aria-hidden="true" tabindex="-1"></a>dtejas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 123 × 7
##    tejas  doc_1 doc_2 doc_3 doc_4 doc_5 doc_6
##    &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 &quot; al &quot;     1     1     0     0     0     0
##  2 &quot; alc&quot;     1     1     0     0     0     0
##  3 &quot; ani&quot;     0     0     0     0     0     1
##  4 &quot; cor&quot;     0     0     0     0     1     0
##  5 &quot; de &quot;     0     0     1     1     0     0
##  6 &quot; doc&quot;     0     0     1     1     0     0
##  7 &quot; eje&quot;     0     0     1     1     0     0
##  8 &quot; el &quot;     0     0     1     1     0     0
##  9 &quot; es &quot;     0     0     1     1     0     0
## 10 &quot; gat&quot;     1     1     0     0     0     0
## # … with 113 more rows</code></pre>
<p>¿Cómo calculamos la similitud de Jaccard usando estos datos?</p>
<p>Calcular la unión e intersección se puede hacer haciendo OR y AND de las columnas, y
entonces podemos calcular la similitud</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="similitud.html#cb125-1" aria-hidden="true" tabindex="-1"></a>inter_12 <span class="ot">&lt;-</span> <span class="fu">sum</span>(dtejas_tbl<span class="sc">$</span>doc_1 <span class="sc">&amp;</span> dtejas_tbl<span class="sc">$</span>doc_2)</span>
<span id="cb125-2"><a href="similitud.html#cb125-2" aria-hidden="true" tabindex="-1"></a>union_12 <span class="ot">&lt;-</span> <span class="fu">sum</span>(dtejas_tbl<span class="sc">$</span>doc_1 <span class="sc">|</span> dtejas_tbl<span class="sc">$</span>doc_2)</span>
<span id="cb125-3"><a href="similitud.html#cb125-3" aria-hidden="true" tabindex="-1"></a>similitud <span class="ot">&lt;-</span> inter_12<span class="sc">/</span>union_12</span>
<span id="cb125-4"><a href="similitud.html#cb125-4" aria-hidden="true" tabindex="-1"></a>similitud <span class="co"># comparar con el número que obtuvimos arriba.</span></span></code></pre></div>
<pre><code>## [1] 0.773</code></pre>
<p>El cálculo para todos los documentos podríamos hacerlo (aunque veremos que normalmente
no haremos esto si no necesitamos calcular todas las similitudes) con:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="similitud.html#cb127-1" aria-hidden="true" tabindex="-1"></a>mat_td <span class="ot">&lt;-</span> dtejas_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>tejas) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">t</span>()</span>
<span id="cb127-2"><a href="similitud.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">dist</span>(mat_td, <span class="at">method =</span> <span class="st">&quot;binary&quot;</span>)</span></code></pre></div>
<pre><code>##        doc_1  doc_2  doc_3  doc_4  doc_5
## doc_2 0.7727                            
## doc_3 0.0000 0.0000                     
## doc_4 0.0137 0.0133 0.6000              
## doc_5 0.0000 0.0000 0.1892 0.1556       
## doc_6 0.0000 0.0000 0.0000 0.0000 0.0000</code></pre>
</div>
<div id="minhash-y-reducción-probabilística-de-dimensionalidad" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Minhash y reducción probabilística de dimensionalidad</h2>
<p>Para una colección grande de documentos
la representación binaria de la colección de documentos
puede tener un número muy grande de renglones. Puede ser posible
crear un número más chico de nuevos <em>features</em> (ojo: aquí los renglones
son las “variables,” y los casos son las columnas) con los que
sea posible obtener una buena aproximación de la similitud.</p>
<p>La idea básica es la siguiente:</p>
<ul>
<li>Escogemos una función al azar (una función <em>hash</em>) que mapea cadenas cortas a un número grande de enteros, de manera existe muy baja probabilidad de colisiones, y no hay correlación entre las cadenas y el valor al que son mapeados.</li>
<li>Si un documento tiene tejas <span class="math inline">\(T\)</span>, aplicamos la función hash a cada teja de <span class="math inline">\(T\)</span>, y calculamos el mínimo de estos valores hash.</li>
<li>Repetimos este proceso para varias funciones hash fijas, por ejemplo <span class="math inline">\(k= 5\)</span></li>
<li>Los valores mínimos obtenidos nos dan una representación en dimensión baja de cada
documento.</li>
</ul>
<div id="ejemplo-10" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="similitud.html#cb129-1" aria-hidden="true" tabindex="-1"></a>textos_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">doc_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(textos), <span class="at">texto =</span> textos)</span>
<span id="cb129-2"><a href="similitud.html#cb129-2" aria-hidden="true" tabindex="-1"></a>tejas_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">doc_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(textos), <span class="at">tejas =</span> tejas_doc)</span>
<span id="cb129-3"><a href="similitud.html#cb129-3" aria-hidden="true" tabindex="-1"></a>tejas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   doc_id tejas     
##    &lt;int&gt; &lt;list&gt;    
## 1      1 &lt;chr [41]&gt;
## 2      2 &lt;chr [42]&gt;
## 3      3 &lt;chr [28]&gt;
## 4      4 &lt;chr [36]&gt;
## 5      5 &lt;chr [16]&gt;
## 6      6 &lt;chr [31]&gt;</code></pre>
<p>Creamos una función hash:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="similitud.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">813</span>)</span>
<span id="cb131-2"><a href="similitud.html#cb131-2" aria-hidden="true" tabindex="-1"></a>generar_hash <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb131-3"><a href="similitud.html#cb131-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(stats<span class="sc">::</span><span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2147483647</span>))</span>
<span id="cb131-4"><a href="similitud.html#cb131-4" aria-hidden="true" tabindex="-1"></a>  funcion_hash <span class="ot">&lt;-</span> <span class="cf">function</span>(tejas){</span>
<span id="cb131-5"><a href="similitud.html#cb131-5" aria-hidden="true" tabindex="-1"></a>        digest<span class="sc">::</span><span class="fu">digest2int</span>(tejas, <span class="at">seed =</span> r) </span>
<span id="cb131-6"><a href="similitud.html#cb131-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb131-7"><a href="similitud.html#cb131-7" aria-hidden="true" tabindex="-1"></a>  funcion_hash</span>
<span id="cb131-8"><a href="similitud.html#cb131-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb131-9"><a href="similitud.html#cb131-9" aria-hidden="true" tabindex="-1"></a>h_1 <span class="ot">&lt;-</span> <span class="fu">generar_hash</span>()</span></code></pre></div>
<p>Y aplicamos la función a cada teja del documento 1, y tomamos el mínimo:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="similitud.html#cb132-1" aria-hidden="true" tabindex="-1"></a>hashes_1 <span class="ot">&lt;-</span> <span class="fu">h_1</span>(tejas_tbl<span class="sc">$</span>tejas[[<span class="dv">1</span>]])</span>
<span id="cb132-2"><a href="similitud.html#cb132-2" aria-hidden="true" tabindex="-1"></a>hashes_1</span></code></pre></div>
<pre><code>##  [1] -1318809190 -1534091290 -1401861150 -1601894665   781339434  -519860631
##  [7]  2116727945 -1824301917 -1401861150 -1371561364 -1385084918  -821046029
## [13]  1766711521  1952075680   569109680 -1412107908  1059544482 -1866546594
## [19]  2090868926  -455965089   784118133  1421354549 -1397404756  -481987742
## [25] -1824301917 -1401861150  1157451749   698137483  -623448608   544014704
## [31]  -587926856  1455454405   950121497  -165719415  2119479774  2115904977
## [37]  1519310299  1652203243  -667865842  1219377605 -1500087628</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="similitud.html#cb134-1" aria-hidden="true" tabindex="-1"></a>minhash_1 <span class="ot">&lt;-</span> <span class="fu">min</span>(hashes_1)</span>
<span id="cb134-2"><a href="similitud.html#cb134-2" aria-hidden="true" tabindex="-1"></a>minhash_1</span></code></pre></div>
<pre><code>## [1] -1866546594</code></pre>
<p>Consideramos este <em>minhash</em> como un descriptor del documento. Generalmente
usamos más de un descriptor. En el siguiente ejemplo usamos 4 funciones
hash creadas de manera independiente:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="similitud.html#cb136-1" aria-hidden="true" tabindex="-1"></a>hashes <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="fu">generar_hash</span>())</span>
<span id="cb136-2"><a href="similitud.html#cb136-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3"><a href="similitud.html#cb136-3" aria-hidden="true" tabindex="-1"></a>docs_firmas <span class="ot">&lt;-</span> tejas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb136-4"><a href="similitud.html#cb136-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firma =</span> <span class="fu">map</span>(tejas, \(lista) <span class="fu">map_int</span>(hashes, \(h) <span class="fu">min</span>(<span class="fu">h</span>(lista))))) <span class="sc">|&gt;</span> </span>
<span id="cb136-5"><a href="similitud.html#cb136-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, firma) <span class="sc">|&gt;</span> </span>
<span id="cb136-6"><a href="similitud.html#cb136-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(firma, <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb136-7"><a href="similitud.html#cb136-7" aria-hidden="true" tabindex="-1"></a>docs_firmas</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   doc_id     firma_1     firma_2     firma_3     firma_4
##    &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1      1 -2129712961 -2124594172 -2073157333 -1982715048
## 2      2 -2129712961 -2124594172 -2073157333 -1982715048
## 3      3 -2139075502 -2093452194 -1959662839 -2048484934
## 4      4 -2139075502 -2093452194 -1959662839 -2048484934
## 5      5 -2106131386 -2093452194 -2127642881 -1984764210
## 6      6 -2115397946 -2087727654 -2074217109 -1986993146</code></pre>
<p>Nótese ahora que en documentos muy similares, varios de los minhashes coinciden. Esto
es porque la teja donde ocurrió el mínimo está en los dos documentos. Entonces
cuando los las tejas de dos documentos son muy similares, es muy probable que sus
minhashes coincidan.</p>
<p>¿Cuál es la probabilidad de que la firma coincida para un documento?</p>

<div class="resumen">
Sea <span class="math inline">\(h\)</span> una función <em>hash</em> escogida escogida al azar, y <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span> dos documentos dados
dadas. Denotamos como <span class="math inline">\(f_h\)</span> la función minhash asociada a <span class="math inline">\(h\)</span>. Entonces
<span class="math display">\[P(f_h(a) = f_h(b)) = sim(a, b)\]</span>
donde <span class="math inline">\(sim\)</span> es la similitud de Jaccard basada en las tejas usadas.
Sean <span class="math inline">\(h_1, h_2, \ldots h_n\)</span> funciones <em>hash</em> escogidas al azar de
manera independiente. Si <span class="math inline">\(n\)</span> es grande, entonces por la ley de los grandes números
<span class="math display">\[sim(a,b) \approx \frac{|h_j : f_{h_j}{\pi_j}(a) = f_{h_j}(b)|}{n},\]</span>
es decir, la similitud de Jaccard es aproximadamente la proporción
de elementos de las firmas que coinciden.
</div>
<p>Ahora damos un argumento para demostrar este resultado:</p>
<p>Supongamos que el total de tejas de los dos documentos es <span class="math inline">\(|A\cup B|\)</span>, y el
número de tejas que tienen en común es <span class="math inline">\(|A\cap B|\)</span>. Sea <span class="math inline">\(h\)</span> la función <em>hash</em>
que escogimos al azar.</p>
<p>Para fijar ideas, puedes suponer que las tejas están numeradas <span class="math inline">\(1,\ldots, M\)</span>, y
la función <em>hash</em> es una permutación aleatoria de estos números.</p>
<p>Entonces:</p>
<ol style="list-style-type: decimal">
<li>El mínimo de <span class="math inline">\(h\)</span> puede ocurrir en cualquier elemento de <span class="math inline">\(|A\cup B|\)</span> con
la misma probabilidad.</li>
<li>Los minhashes de <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span> coinciden si y sólo si el mínimo de <span class="math inline">\(h\)</span> ocurre en un elemento
de <span class="math inline">\(|A\cap B|\)</span></li>
<li>Por 1 y 2, la probabilidad de que esto ocurra es
<span class="math display">\[\frac{|A\cap B|}{|A\cup B|},\]</span>
que es la similitud de Jaccard.</li>
</ol>
<p>Nótese que esto requiere que la familia de donde escogemos nuestra función
<em>hash</em> cumple, al menos aproximadamente, las propiedades 1 y 2. Para que 1 ocurra,
la familia debe ser suficientemente grande y variada: por ejemplo, esto fallaría si
todas las cadenas que comienzan con “a” se mapean a números chicos. Para que
ocurra 2, no debe haber colisiones (cadenas distintas que se mapean al mismo valor).</p>
<p><strong>Observaciónes</strong>:</p>
<ul>
<li><p>Una familia que cumple de manera exacta estas dos propiedades
es la familia de permutaciones que mencionamos arriba: numeramos las tejas, construimos
una permutación al azar, y luego aplicamos esta función de permutaciones a los índices
de las tejas. La razón por la que esta familia no es utiliza típicamente es porque
es costosa si el número de tejas es grande: primero hay que escoger un ordenamiento al azar, y luego es necesario almacenarlo.</p></li>
<li><p>Muchas veces, se utiliza una función hash con aritmética
modular como sigue: sea <span class="math inline">\(M\)</span> el número total
de tejas, y sea <span class="math inline">\(p\)</span> un número primo fijo grande (al menos <span class="math inline">\(p &gt; M\)</span>).
Numeramos las tejas. Ahora escogemos dos enteros <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span> al azar, y hacemos
<span class="math display">\[h(x) = (ax + b\mod p) \mod M\]</span>
Estas funciones se pueden seleccionar y aplicar rápidamente, y sólo tenemos que almacenar los coeficientes <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span>.</p></li>
<li><p>En el enfoque que vimos arriba, utilizamos directamente una función <em>hash</em> de cadenas
que está diseñada para cumplir 1 y 2 de manera aproximada.</p></li>
</ul>

<div class="resumen">
<strong>Resumen</strong>. Con el método de minhash, representamos a los documentos con un
número relativamente chico de atributos numéricos (reducción de dimensionalidad). Esta
respresentación tiene la propiedad de que textos muy similares con probabilidad
alta coinciden en uno o más de los descriptores.
</div>
</div>
</div>
<div id="agrupando-textos-de-similitud-alta" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Agrupando textos de similitud alta</h2>
<p>Nuestro siguiente paso es evitar hacer la comparación de todos los pares de descriptores.
Para esto hacemos un clustering no exhaustivo basado en los descriptores que
acabamos de construir.</p>
<p>Recordemos que tenemos</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="similitud.html#cb138-1" aria-hidden="true" tabindex="-1"></a>docs_firmas</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   doc_id     firma_1     firma_2     firma_3     firma_4
##    &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;       &lt;int&gt;
## 1      1 -2129712961 -2124594172 -2073157333 -1982715048
## 2      2 -2129712961 -2124594172 -2073157333 -1982715048
## 3      3 -2139075502 -2093452194 -1959662839 -2048484934
## 4      4 -2139075502 -2093452194 -1959662839 -2048484934
## 5      5 -2106131386 -2093452194 -2127642881 -1984764210
## 6      6 -2115397946 -2087727654 -2074217109 -1986993146</code></pre>
<p>Ahora agrupamos documentos que comparten alguna firma. A los grupos
que coinciden en cada firma les llamamos <em>cubetas</em>:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="similitud.html#cb140-1" aria-hidden="true" tabindex="-1"></a>cubetas_tbl <span class="ot">&lt;-</span> docs_firmas <span class="sc">|&gt;</span> <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;firma_&quot;</span>), <span class="st">&quot;n_firma&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb140-2"><a href="similitud.html#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cubeta =</span> <span class="fu">paste</span>(n_firma, value)) <span class="sc">|&gt;</span> </span>
<span id="cb140-3"><a href="similitud.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cubeta) <span class="sc">|&gt;</span> </span>
<span id="cb140-4"><a href="similitud.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">documentos =</span> <span class="fu">list</span>(doc_id)) <span class="sc">|&gt;</span> </span>
<span id="cb140-5"><a href="similitud.html#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_docs =</span> <span class="fu">map_int</span>(documentos, length))</span>
<span id="cb140-6"><a href="similitud.html#cb140-6" aria-hidden="true" tabindex="-1"></a>cubetas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 15 × 3
##    cubeta              documentos num_docs
##    &lt;chr&gt;               &lt;list&gt;        &lt;int&gt;
##  1 firma_1 -2106131386 &lt;int [1]&gt;         1
##  2 firma_1 -2115397946 &lt;int [1]&gt;         1
##  3 firma_1 -2129712961 &lt;int [2]&gt;         2
##  4 firma_1 -2139075502 &lt;int [2]&gt;         2
##  5 firma_2 -2087727654 &lt;int [1]&gt;         1
##  6 firma_2 -2093452194 &lt;int [3]&gt;         3
##  7 firma_2 -2124594172 &lt;int [2]&gt;         2
##  8 firma_3 -1959662839 &lt;int [2]&gt;         2
##  9 firma_3 -2073157333 &lt;int [2]&gt;         2
## 10 firma_3 -2074217109 &lt;int [1]&gt;         1
## 11 firma_3 -2127642881 &lt;int [1]&gt;         1
## 12 firma_4 -1982715048 &lt;int [2]&gt;         2
## 13 firma_4 -1984764210 &lt;int [1]&gt;         1
## 14 firma_4 -1986993146 &lt;int [1]&gt;         1
## 15 firma_4 -2048484934 &lt;int [2]&gt;         2</code></pre>
<p>Ahora filtramos las cubetas que tienen más de un elemento:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="similitud.html#cb142-1" aria-hidden="true" tabindex="-1"></a>cubetas_tbl <span class="ot">&lt;-</span> cubetas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb142-2"><a href="similitud.html#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_docs <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb142-3"><a href="similitud.html#cb142-3" aria-hidden="true" tabindex="-1"></a>cubetas_tbl </span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   cubeta              documentos num_docs
##   &lt;chr&gt;               &lt;list&gt;        &lt;int&gt;
## 1 firma_1 -2129712961 &lt;int [2]&gt;         2
## 2 firma_1 -2139075502 &lt;int [2]&gt;         2
## 3 firma_2 -2093452194 &lt;int [3]&gt;         3
## 4 firma_2 -2124594172 &lt;int [2]&gt;         2
## 5 firma_3 -1959662839 &lt;int [2]&gt;         2
## 6 firma_3 -2073157333 &lt;int [2]&gt;         2
## 7 firma_4 -1982715048 &lt;int [2]&gt;         2
## 8 firma_4 -2048484934 &lt;int [2]&gt;         2</code></pre>
<p>Y de aquí extraemos <strong>pares candidatos</strong> que tienen alta probabilidad de
ser muy similares:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="similitud.html#cb144-1" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="ot">&lt;-</span> cubetas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb144-2"><a href="similitud.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pares_cand =</span> <span class="fu">map</span>(documentos, <span class="sc">~</span> <span class="fu">combn</span>(.x, <span class="dv">2</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb144-3"><a href="similitud.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cubeta, pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb144-4"><a href="similitud.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb144-5"><a href="similitud.html#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(pares_cand, <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>) </span>
<span id="cb144-6"><a href="similitud.html#cb144-6" aria-hidden="true" tabindex="-1"></a>pares_tbl</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    cubeta              pares_cand_1 pares_cand_2
##    &lt;chr&gt;                      &lt;int&gt;        &lt;int&gt;
##  1 firma_1 -2129712961            1            2
##  2 firma_1 -2139075502            3            4
##  3 firma_2 -2093452194            3            4
##  4 firma_2 -2093452194            3            5
##  5 firma_2 -2093452194            4            5
##  6 firma_2 -2124594172            1            2
##  7 firma_3 -1959662839            3            4
##  8 firma_3 -2073157333            1            2
##  9 firma_4 -1982715048            1            2
## 10 firma_4 -2048484934            3            4</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="similitud.html#cb146-1" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="ot">&lt;-</span> pares_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>cubeta) <span class="sc">|&gt;</span> </span>
<span id="cb146-2"><a href="similitud.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb146-3"><a href="similitud.html#cb146-3" aria-hidden="true" tabindex="-1"></a>pares_tbl</span></code></pre></div>
<pre><code>## # A tibble: 4 × 2
##   pares_cand_1 pares_cand_2
##          &lt;int&gt;        &lt;int&gt;
## 1            1            2
## 2            3            4
## 3            3            5
## 4            4            5</code></pre>
<p>Nótese que con este proceso evitamos hacer todas las comparaciones, y el método
tiene complejidad lineal en el tamaño de la colección de documentos. Una vez que tenemos
los pares, podemos calcular la similitud exacta de solamente esos documentos:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="similitud.html#cb148-1" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="sc">|&gt;</span> </span>
<span id="cb148-2"><a href="similitud.html#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tejas_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_1 =</span> doc_id, <span class="at">texto_1 =</span> tejas)) <span class="sc">|&gt;</span> </span>
<span id="cb148-3"><a href="similitud.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tejas_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_2 =</span> doc_id, <span class="at">texto_2 =</span> tejas)) <span class="sc">|&gt;</span> </span>
<span id="cb148-4"><a href="similitud.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fu">map2_dbl</span>(texto_1, texto_2, <span class="sc">~</span> <span class="fu">sim_jaccard</span>(.x, .y))) <span class="sc">|&gt;</span> </span>
<span id="cb148-5"><a href="similitud.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;texto&quot;</span>))</span></code></pre></div>
<pre><code>## Joining, by = &quot;pares_cand_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;pares_cand_2&quot;</code></pre>
<pre><code>## # A tibble: 4 × 3
##   pares_cand_1 pares_cand_2 score
##          &lt;int&gt;        &lt;int&gt; &lt;dbl&gt;
## 1            1            2 0.773
## 2            3            4 0.6  
## 3            3            5 0.189
## 4            4            5 0.156</code></pre>
<p>Si queremos capturar solamente aquellos pares de similitud muy alta,
podemos también combinar firmas para formar cubetas donde las dos firmas coinciden:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="similitud.html#cb152-1" aria-hidden="true" tabindex="-1"></a>cubetas_tbl <span class="ot">&lt;-</span> docs_firmas <span class="sc">|&gt;</span> </span>
<span id="cb152-2"><a href="similitud.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cubeta =</span> <span class="fu">paste</span>(firma_1, firma_2)) <span class="sc">|&gt;</span> </span>
<span id="cb152-3"><a href="similitud.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cubeta) <span class="sc">|&gt;</span> </span>
<span id="cb152-4"><a href="similitud.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">documentos =</span> <span class="fu">list</span>(doc_id)) <span class="sc">|&gt;</span> </span>
<span id="cb152-5"><a href="similitud.html#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_docs =</span> <span class="fu">map_int</span>(documentos, length))</span>
<span id="cb152-6"><a href="similitud.html#cb152-6" aria-hidden="true" tabindex="-1"></a>cubetas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   cubeta                  documentos num_docs
##   &lt;chr&gt;                   &lt;list&gt;        &lt;int&gt;
## 1 -2106131386 -2093452194 &lt;int [1]&gt;         1
## 2 -2115397946 -2087727654 &lt;int [1]&gt;         1
## 3 -2129712961 -2124594172 &lt;int [2]&gt;         2
## 4 -2139075502 -2093452194 &lt;int [2]&gt;         2</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="similitud.html#cb154-1" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="ot">&lt;-</span> cubetas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb154-2"><a href="similitud.html#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_docs <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb154-3"><a href="similitud.html#cb154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pares_cand =</span> <span class="fu">map</span>(documentos, <span class="sc">~</span> <span class="fu">combn</span>(.x, <span class="dv">2</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb154-4"><a href="similitud.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cubeta, pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb154-5"><a href="similitud.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb154-6"><a href="similitud.html#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(pares_cand, <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb154-7"><a href="similitud.html#cb154-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tejas_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_1 =</span> doc_id, <span class="at">texto_1 =</span> tejas)) <span class="sc">|&gt;</span> </span>
<span id="cb154-8"><a href="similitud.html#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tejas_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_2 =</span> doc_id, <span class="at">texto_2 =</span> tejas)) <span class="sc">|&gt;</span> </span>
<span id="cb154-9"><a href="similitud.html#cb154-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fu">map2_dbl</span>(texto_1, texto_2, <span class="sc">~</span> <span class="fu">sim_jaccard</span>(.x, .y))) <span class="sc">|&gt;</span> </span>
<span id="cb154-10"><a href="similitud.html#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">&quot;texto&quot;</span>))</span></code></pre></div>
<pre><code>## Joining, by = &quot;pares_cand_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;pares_cand_2&quot;</code></pre>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="similitud.html#cb157-1" aria-hidden="true" tabindex="-1"></a>pares_tbl</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   cubeta                  pares_cand_1 pares_cand_2 score
##   &lt;chr&gt;                          &lt;int&gt;        &lt;int&gt; &lt;dbl&gt;
## 1 -2129712961 -2124594172            1            2 0.773
## 2 -2139075502 -2093452194            3            4 0.6</code></pre>
</div>
<div id="ejemplo-tweets" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Ejemplo: tweets</h2>
<p>Ahora buscaremos tweets similares en una colección de un <a href="https://www.kaggle.com/rgupta09/world-cup-2018-tweets/home?utm_medium=email&amp;utm_source=mailchimp&amp;utm_campaign=datanotes-20180823">dataset de
kaggle</a>.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="similitud.html#cb159-1" aria-hidden="true" tabindex="-1"></a>ruta <span class="ot">&lt;-</span> <span class="st">&quot;../datos/FIFA.csv&quot;</span></span>
<span id="cb159-2"><a href="similitud.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(ruta)){</span>
<span id="cb159-3"><a href="similitud.html#cb159-3" aria-hidden="true" tabindex="-1"></a>    fifa <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;https://fifatweets.s3.amazonaws.com/FIFA.csv&quot;</span>)</span>
<span id="cb159-4"><a href="similitud.html#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write_csv</span>(fifa, <span class="st">&quot;../datos/FIFA.csv&quot;</span>)</span>
<span id="cb159-5"><a href="similitud.html#cb159-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb159-6"><a href="similitud.html#cb159-6" aria-hidden="true" tabindex="-1"></a>    fifa <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(ruta)</span>
<span id="cb159-7"><a href="similitud.html#cb159-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Rows: 530000 Columns: 16</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr  (9): lang, Source, Orig_Tweet, Tweet, Hashtags, UserMentionNames, UserM...
## dbl  (6): ID, len, Likes, RTs, Followers, Friends
## dttm (1): Date</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="similitud.html#cb163-1" aria-hidden="true" tabindex="-1"></a>tw <span class="ot">&lt;-</span> fifa<span class="sc">$</span>Tweet</span>
<span id="cb163-2"><a href="similitud.html#cb163-2" aria-hidden="true" tabindex="-1"></a>tw[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;Only two goalkeepers have saved three penalties in penalty shoot out Ricardo vs&quot;                         
##  [2] &quot;scores the winning penalty to send into the quarter finals where they will face Russia&quot;                  
##  [3] &quot;Tonight we have big game&quot;                                                                                
##  [4] &quot;We get stronger Turn the music up now We got that power power&quot;                                           
##  [5] &quot;Only two goalkeepers have saved three penalties in penalty shoot out Ricardo vs&quot;                         
##  [6] &quot;We re looking strong going into the knockout stage We caught up with ahead of&quot;                           
##  [7] &quot;am happy for winning Especially since you know we colluded and all Russia eliminates Spain after penalty&quot;
##  [8] &quot;When you see me When we feel the same feeling Power power&quot;                                               
##  [9] &quot;Kasper Schmeichel takes the final award of the day&quot;                                                      
## [10] &quot;After Years Global Puma Ambassador LG Mobile Ambassador CocaCola WorldCup Kookmin Bank UNICEF&quot;</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="similitud.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9192</span>)</span>
<span id="cb165-2"><a href="similitud.html#cb165-2" aria-hidden="true" tabindex="-1"></a>num_tweets <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb165-3"><a href="similitud.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(tejas_doc <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(tw[<span class="dv">1</span><span class="sc">:</span>num_tweets], <span class="at">k =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   2.916   0.035   2.951</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="similitud.html#cb167-1" aria-hidden="true" tabindex="-1"></a>tejas_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">doc_id =</span> <span class="dv">1</span><span class="sc">:</span>num_tweets, <span class="at">tejas =</span> tejas_doc)</span>
<span id="cb167-2"><a href="similitud.html#cb167-2" aria-hidden="true" tabindex="-1"></a>hash_f <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="sc">~</span> <span class="fu">generar_hash</span>())</span>
<span id="cb167-3"><a href="similitud.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb167-4"><a href="similitud.html#cb167-4" aria-hidden="true" tabindex="-1"></a>  docs_firmas <span class="ot">&lt;-</span> tejas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb167-5"><a href="similitud.html#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firma =</span> <span class="fu">map</span>(tejas, \(lista) <span class="fu">map_int</span>(hash_f, \(h) <span class="fu">min</span>(<span class="fu">h</span>(lista))))) <span class="sc">|&gt;</span> </span>
<span id="cb167-6"><a href="similitud.html#cb167-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, firma)) </span></code></pre></div>
<pre><code>##    user  system elapsed 
##  30.724   0.013  30.739</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="similitud.html#cb169-1" aria-hidden="true" tabindex="-1"></a>docs_firmas</span></code></pre></div>
<pre><code>## # A tibble: 100,000 × 2
##    doc_id firma     
##     &lt;int&gt; &lt;list&gt;    
##  1      1 &lt;int [50]&gt;
##  2      2 &lt;int [50]&gt;
##  3      3 &lt;int [50]&gt;
##  4      4 &lt;int [50]&gt;
##  5      5 &lt;int [50]&gt;
##  6      6 &lt;int [50]&gt;
##  7      7 &lt;int [50]&gt;
##  8      8 &lt;int [50]&gt;
##  9      9 &lt;int [50]&gt;
## 10     10 &lt;int [50]&gt;
## # … with 99,990 more rows</code></pre>
<p>La firma de minhashes del primer documento es por ejemplo:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="similitud.html#cb171-1" aria-hidden="true" tabindex="-1"></a>docs_firmas<span class="sc">$</span>firma[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [[1]]
##  [1] -1953455759 -2112001395 -2031432865 -2108080560 -2095602723 -2118858341
##  [7] -2099337985 -1978298401 -2092751862 -2097330616 -1897306653 -2139645671
## [13] -1981364640 -2081406116 -2127003388 -2138613184 -2146084782 -2082312909
## [19] -2083329993 -2001255852 -2091106849 -2091293600 -2120806067 -2095725804
## [25] -2143199361 -2091159512 -2124095195 -2038461037 -2109684884 -2073791594
## [31] -2129542593 -1904599938 -2118234795 -2056298394 -2105031889 -2113931139
## [37] -2134167293 -2140440957 -1717523835 -2144768923 -2138027225 -2084388635
## [43] -2110278901 -2135431955 -2139423769 -2130397390 -2097742891 -2105787557
## [49] -2101425996 -1941363605</code></pre>
<p>Y probaremos primero hacer cubetas con algunas las firmas (las cuatro primeras por ejemplo):</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="similitud.html#cb173-1" aria-hidden="true" tabindex="-1"></a>docs_firmas <span class="ot">&lt;-</span> docs_firmas <span class="sc">|&gt;</span> </span>
<span id="cb173-2"><a href="similitud.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cubeta_nombre =</span> <span class="fu">map_chr</span>(firma, \(x) <span class="fu">paste</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)))</span>
<span id="cb173-3"><a href="similitud.html#cb173-3" aria-hidden="true" tabindex="-1"></a>docs_cubetas_tbl <span class="ot">&lt;-</span> </span>
<span id="cb173-4"><a href="similitud.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  docs_firmas <span class="sc">|&gt;</span> </span>
<span id="cb173-5"><a href="similitud.html#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cubeta_nombre) <span class="sc">|&gt;</span> </span>
<span id="cb173-6"><a href="similitud.html#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">docs =</span> <span class="fu">list</span>(doc_id)) <span class="sc">|&gt;</span> </span>
<span id="cb173-7"><a href="similitud.html#cb173-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_docs =</span> <span class="fu">map_int</span>(docs, length)) </span>
<span id="cb173-8"><a href="similitud.html#cb173-8" aria-hidden="true" tabindex="-1"></a>docs_cubetas_filt_tbl <span class="ot">&lt;-</span> docs_cubetas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb173-9"><a href="similitud.html#cb173-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(num_docs <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<p>Y examinamos ahora algunas de las cubetas:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="similitud.html#cb174-1" aria-hidden="true" tabindex="-1"></a>docs_ejemplo <span class="ot">&lt;-</span> docs_cubetas_filt_tbl<span class="sc">$</span>docs[[<span class="dv">125</span>]]</span>
<span id="cb174-2"><a href="similitud.html#cb174-2" aria-hidden="true" tabindex="-1"></a>tw[docs_ejemplo]</span></code></pre></div>
<pre><code>## [1] &quot;We got That power power&quot; &quot;We got That power power&quot;
## [3] &quot;We got That power power&quot;</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="similitud.html#cb176-1" aria-hidden="true" tabindex="-1"></a>docs_ejemplo <span class="ot">&lt;-</span> docs_cubetas_filt_tbl<span class="sc">$</span>docs[[<span class="dv">1658</span>]]</span>
<span id="cb176-2"><a href="similitud.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(docs_ejemplo)</span></code></pre></div>
<pre><code>## [1] 406</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="similitud.html#cb178-1" aria-hidden="true" tabindex="-1"></a>tw[docs_ejemplo][<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] &quot;short story involving Nigeria Argentina and France&quot;
## [2] &quot;short story involving Nigeria Argentina and France&quot;</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="similitud.html#cb180-1" aria-hidden="true" tabindex="-1"></a>docs_ejemplo <span class="ot">&lt;-</span> docs_cubetas_filt_tbl<span class="sc">$</span>docs[[<span class="dv">4958</span>]]</span>
<span id="cb180-2"><a href="similitud.html#cb180-2" aria-hidden="true" tabindex="-1"></a>tw[docs_ejemplo]</span></code></pre></div>
<pre><code>## [1] &quot;The keeps on serving us more and more drama If you missed any of the great moments from todays fixtures yo&quot;                             
## [2] &quot;The keeps on serving us more and more drama If you missed any of the great moments from todays fixtures yo&quot;                             
## [3] &quot;The keeps on serving us more and more drama If you missed any of the great moments from todays fixtures yo&quot;                             
## [4] &quot;The keeps on serving us more and more drama If you missed any of the great moments from todays fixtures you can watch the highlights on&quot;
## [5] &quot;The keeps on serving us more and more drama If you missed any of the great moments from todays fixtures you can watch the highlights on&quot;</code></pre>
<p>Con este método, podemos extraer pares de muy alta similitud (cercano a duplicados) de forma eficiente en colecciones grandes de texto.</p>
</div>
<div id="verificar-si-un-nuevo-elemento-es-duplicado" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Verificar si un nuevo elemento es duplicado</h2>
<p>Si tenemos un nuevo entrada, podemos checar si es duplicado calculando su firma, formando
la cubetas,
y revisando si cae en alguna de las cubetas conocidas. Nótese que tenemos que guardar
las funciones hash que usamos para aplicar a los nuevos datos, y repetir
el proceso exactamente como procesamos los datos originales. Por ejemplo:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="similitud.html#cb182-1" aria-hidden="true" tabindex="-1"></a>nuevos_tweets <span class="ot">&lt;-</span> <span class="dv">150000</span><span class="sc">:</span><span class="dv">150005</span></span>
<span id="cb182-2"><a href="similitud.html#cb182-2" aria-hidden="true" tabindex="-1"></a>tw[nuevos_tweets]</span></code></pre></div>
<pre><code>## [1] &quot;It should sound the song that was on the Show of the great fountain of Dubai Please play of&quot;                              
## [2] &quot;PARK CHANYEOL Please play of&quot;                                                                                             
## [3] &quot;What Game Congratulations to on reaching the quarter finals with but commiserations to Marcos&quot;                            
## [4] &quot;For the fans of the vs rivalry Mbappe Cristiano Ronaldo fan has ended Messis dream of winning the&quot;                        
## [5] &quot;Messi How far Suarez could not make it to the quarterfinals you know what to do Suarez Roger&quot;                             
## [6] &quot;Got few daubes all right had to put him in when was painting low Thankfully painting finished another bit later after the&quot;</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="similitud.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(tejas_nuevas_doc <span class="ot">&lt;-</span> <span class="fu">calcular_tejas</span>(tw[nuevos_tweets], <span class="at">k =</span> <span class="dv">5</span>))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.000   0.000   0.001</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="similitud.html#cb186-1" aria-hidden="true" tabindex="-1"></a>tejas_nuevas_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">doc_id =</span> nuevos_tweets, <span class="at">tejas =</span> tejas_nuevas_doc)</span>
<span id="cb186-2"><a href="similitud.html#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb186-3"><a href="similitud.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  docs_nuevas_firmas <span class="ot">&lt;-</span> tejas_nuevas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb186-4"><a href="similitud.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firma =</span> <span class="fu">map</span>(tejas, \(lista) <span class="fu">map_int</span>(hash_f, \(h) <span class="fu">min</span>(<span class="fu">h</span>(lista))))) <span class="sc">|&gt;</span> </span>
<span id="cb186-5"><a href="similitud.html#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(doc_id, firma)) </span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.008   0.000   0.008</code></pre>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="similitud.html#cb188-1" aria-hidden="true" tabindex="-1"></a>docs_nuevas_firmas</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   doc_id firma     
##    &lt;int&gt; &lt;list&gt;    
## 1 150000 &lt;int [50]&gt;
## 2 150001 &lt;int [50]&gt;
## 3 150002 &lt;int [50]&gt;
## 4 150003 &lt;int [50]&gt;
## 5 150004 &lt;int [50]&gt;
## 6 150005 &lt;int [50]&gt;</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="similitud.html#cb190-1" aria-hidden="true" tabindex="-1"></a>docs_nuevas_firmas <span class="ot">&lt;-</span> docs_nuevas_firmas <span class="sc">|&gt;</span> </span>
<span id="cb190-2"><a href="similitud.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cubeta_nombre =</span> <span class="fu">map_chr</span>(firma, \(x) <span class="fu">paste</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">collapse =</span> <span class="st">&quot;-&quot;</span>)))</span>
<span id="cb190-3"><a href="similitud.html#cb190-3" aria-hidden="true" tabindex="-1"></a>docs_cubetas_nuevas_tbl <span class="ot">&lt;-</span> </span>
<span id="cb190-4"><a href="similitud.html#cb190-4" aria-hidden="true" tabindex="-1"></a>  docs_nuevas_firmas <span class="sc">|&gt;</span> </span>
<span id="cb190-5"><a href="similitud.html#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cubeta_nombre) <span class="sc">|&gt;</span> </span>
<span id="cb190-6"><a href="similitud.html#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">docs =</span> <span class="fu">list</span>(doc_id)) <span class="sc">|&gt;</span> </span>
<span id="cb190-7"><a href="similitud.html#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">num_docs =</span> <span class="fu">map_int</span>(docs, length)) </span>
<span id="cb190-8"><a href="similitud.html#cb190-8" aria-hidden="true" tabindex="-1"></a>docs_cubetas_nuevas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   cubeta_nombre                       docs      num_docs
##   &lt;chr&gt;                               &lt;list&gt;       &lt;int&gt;
## 1 -2041983150--2147447475--2129777399 &lt;int [1]&gt;        1
## 2 -2051683951--2053274679--2125528528 &lt;int [1]&gt;        1
## 3 -2108824716--2032083428--2137254712 &lt;int [1]&gt;        1
## 4 -2113147634--2140751096--2058622652 &lt;int [1]&gt;        1
## 5 -2139603446--2140751096--2090996001 &lt;int [1]&gt;        1
## 6 -2142045021--2054826468--2129777399 &lt;int [1]&gt;        1</code></pre>
<p>Y ahora podemos hacer un semi-join con las cubetas:</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="similitud.html#cb192-1" aria-hidden="true" tabindex="-1"></a>cand_duplicados_tbl <span class="ot">&lt;-</span> docs_cubetas_nuevas_tbl <span class="sc">|&gt;</span> <span class="fu">semi_join</span>(docs_cubetas_tbl <span class="sc">|&gt;</span> <span class="fu">select</span>(cubeta_nombre))</span></code></pre></div>
<pre><code>## Joining, by = &quot;cubeta_nombre&quot;</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="similitud.html#cb194-1" aria-hidden="true" tabindex="-1"></a>cand_duplicados_tbl</span></code></pre></div>
<pre><code>## # A tibble: 3 × 3
##   cubeta_nombre                       docs      num_docs
##   &lt;chr&gt;                               &lt;list&gt;       &lt;int&gt;
## 1 -2041983150--2147447475--2129777399 &lt;int [1]&gt;        1
## 2 -2113147634--2140751096--2058622652 &lt;int [1]&gt;        1
## 3 -2142045021--2054826468--2129777399 &lt;int [1]&gt;        1</code></pre>
<p>Y vemos que tenemos tres candidatos a duplicados. Checamos el primer tweet:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="similitud.html#cb196-1" aria-hidden="true" tabindex="-1"></a>cubeta_1 <span class="ot">&lt;-</span> cand_duplicados_tbl <span class="sc">|&gt;</span> <span class="fu">pull</span>(cubeta_nombre) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb196-2"><a href="similitud.html#cb196-2" aria-hidden="true" tabindex="-1"></a>doc_1 <span class="ot">&lt;-</span> cand_duplicados_tbl <span class="sc">|&gt;</span> <span class="fu">pull</span>(docs) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb196-3"><a href="similitud.html#cb196-3" aria-hidden="true" tabindex="-1"></a>cubeta_1</span></code></pre></div>
<pre><code>## [1] &quot;-2041983150--2147447475--2129777399&quot;</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="similitud.html#cb198-1" aria-hidden="true" tabindex="-1"></a>doc_1</span></code></pre></div>
<pre><code>## [1] 150004</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="similitud.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co"># en la tabla original de todos los tweets</span></span>
<span id="cb200-2"><a href="similitud.html#cb200-2" aria-hidden="true" tabindex="-1"></a>doc_2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(docs_cubetas_tbl, cubeta_nombre <span class="sc">==</span> cubeta_1) <span class="sc">|&gt;</span> </span>
<span id="cb200-3"><a href="similitud.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(docs) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="dv">1</span>)</span>
<span id="cb200-4"><a href="similitud.html#cb200-4" aria-hidden="true" tabindex="-1"></a>doc_2[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 36839</code></pre>
<p>Checamos los tweets:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="similitud.html#cb202-1" aria-hidden="true" tabindex="-1"></a>tw[doc_2[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;Messi How far Suarez could not make it to the quarterfinals you know what to do Suarez Roger&quot;</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="similitud.html#cb204-1" aria-hidden="true" tabindex="-1"></a>tw[doc_1]</span></code></pre></div>
<pre><code>## [1] &quot;Messi How far Suarez could not make it to the quarterfinals you know what to do Suarez Roger&quot;</code></pre>
<p>Y efectivamente detectamos que el nuevo tweet es duplicado. Otra vez, no fue necesario
hacer una comparación exhaustiva del nuevo tweet contra nuestra colección inicial grande.</p>
<p><strong>Ejercicio</strong>: checa los otros candidatos a duplicados que encontramos en este ejemplo.</p>
</div>
<div id="controlando-la-sensibilidad-y-umbral-de-similitud" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Controlando la sensibilidad y umbral de similitud</h2>
<p>En algunos casos nos pueden interesar encontrar duplicados muy cercanos, y en otros
problemas quisiéramos capturar pares con un umbral más bajo de similitud. Usando
distinto número de hashes podemos hacer esto. En primer lugar,
sabemos que un la probabilidad de que dos minhashes coincidan es
igual a la similitud de jaccard de los dos textos correspondientes.</p>
<ul>
<li>Si <span class="math inline">\(s\)</span> es la similitud de Jaccard entre <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span>, entonces:</li>
</ul>
<p><span class="math display">\[P(f_h(a) = f_h(b)) = s(a,b) = s\]</span>
Si escogemos <span class="math inline">\(k\)</span> hashes al azar, y definimos candidatos solamente cuando coincidan
<strong>todos los hashes</strong> (construcción AND), la probabilidad de hacer un par candidatos es:</p>
<p><span class="math display">\[P(f_1(a) = f_1(b), \ldots, f_k(a)=f_k(b)) = s^k\]</span>
Por otro lado, si consideramos un par candidato cuando al menos <strong>alguno</strong> de los
minhashes coinciden (construcción OR), la probabilidad que <span class="math inline">\(a\)</span> y <span class="math inline">\(b\)</span> sean candidatos
es:</p>
<p><span class="math display">\[P(f_j(a) = f_j(b) \, \textrm{ para alguna } j) = 1-(1-s)^k\]</span></p>
<p>Podemos graficar estas probabilidades con distintos valores de <span class="math inline">\(k\)</span></p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="similitud.html#cb206-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb206-2"><a href="similitud.html#cb206-2" aria-hidden="true" tabindex="-1"></a>prob_captura <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">s =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb206-3"><a href="similitud.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">tipo =</span> <span class="fu">c</span>(<span class="st">&quot;k_hashes_AND&quot;</span>, <span class="st">&quot;k_hashes_OR&quot;</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb206-4"><a href="similitud.html#cb206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crossing</span>(<span class="at">k =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb206-5"><a href="similitud.html#cb206-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_captura =</span> <span class="fu">ifelse</span>(tipo <span class="sc">==</span> <span class="st">&quot;k_hashes_AND&quot;</span>, s<span class="sc">^</span>k, <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> s)<span class="sc">^</span>k))</span>
<span id="cb206-6"><a href="similitud.html#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_captura, <span class="fu">aes</span>(<span class="at">x =</span> s, <span class="at">y =</span> prob_captura, <span class="at">colour =</span> <span class="fu">factor</span>(k))) <span class="sc">+</span></span>
<span id="cb206-7"><a href="similitud.html#cb206-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb206-8"><a href="similitud.html#cb206-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> tipo)</span></code></pre></div>
<p><img src="02-similitud-1_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Nótese que:</p>
<ul>
<li>Si queremos tener muy alta probabilidad de capturar todos los pares similares,
podemos usar la construcción OR con k = 3 para similitud mayor a 0.75 o k = 10 para similitud mayor a 0.3, por ejemplo</li>
<li>La desventaja de esto, es que es posible que obtengamos muchos candidatos que realmente no tienen la similitud deseada (falsos positivos). Esto implica más procesamiento.</li>
<li>Si solo queremos capturar pares de muy alta similitud (por ejemplo &gt; 0.98), y
no es grave que tengamos algunos falsos negativos, podemos
usar la construcción AND con 1 o 3 hashes por ejemplo, y obtendremos un número más manejable
de pares candidatos para procesar.</li>
<li>La desventaja de esto es que es posible obtener algunos falsos negativos. Depende de la aplicación esto puede ser aceptable o no.</li>
</ul>

<div class="resumen">
<p>A partir de un umbral <span class="math inline">\(s\)</span> de similitud para los pares que queremos capturar, podemos
usar varios minhashes para afinar el método:</p>
<ul>
<li>Usamos la construcción OR con varios hashes para capturar pares de alta o mediana similitud con mucha confianza. Generalmente es necesario filtrar falsos positivos.</li>
<li>Usamos la construcción AND con uno o varios hashes para pares de muy alta similitud
con confianza alta. Tendremos menos falsos positivos, pero también es posible tener más
falsos negativos (se nos escapan algunos pares muy similares).
</div></li>
</ul>
<p><strong>Nota</strong>: es posible combinar estas técnicas para refinar la captura de pares
a un nivel de similitud dado haciendo bandas de hashes: por ejemplo, si tenemos
20 hashes podemos hacer 4 bandas de 5 hashes, usamos AND para cada grupo de 5 hashes y
OR para las 4 bandas. Para más de esto, revisa nuestro texto <span class="citation">(<a href="#ref-mmd" role="doc-biblioref">Leskovec, Rajaraman, and Ullman 2014</a>)</span>.</p>
</div>
<div id="distancia-euclideana-y-lsh" class="section level2" number="3.9">
<h2><span class="header-section-number">3.9</span> Distancia euclideana y LSH</h2>
<p>Ahora aplicamos estas ideas para otro tipo de similitud. En este caso, consideramos
la distancia euclideana usual en dimensión <span class="math inline">\(p\)</span>:</p>
<p><span class="math display">\[d(x,y) = \sqrt{(x_1 - y_1)^2 + (x_2 - y_2)^2 +\cdots (x_p - y_p)^2}\]</span>
Y nuestra tarea es <strong>encontrar todos los pares tales que su distancia euclideana
es muy cercana a 0</strong>. Es decir, queremos hacer “clusters” pero sólo de datos
muy cercanos, igual que en los ejemplos de similitud de jaccard.</p>
<p>Para distancia euclideana nuestros hashes resultan de proyecciones
aleatorias rectas fijas en cubetas. La idea general es que tomamos una línea al azar en el espacio
de entradas, y la dividimos en cubetas de manera uniforme. El valor
hash de un punto <span class="math inline">\(x\)</span> es el número de cubeta donde cae la proyección de <span class="math inline">\(x\)</span>.</p>
<p>Más especificamente, si escogemos un ancho <span class="math inline">\(r\)</span> de cubeta:</p>
<ol style="list-style-type: decimal">
<li>Escogemos una dirección al azar <span class="math inline">\(v\)</span></li>
<li>El hash de un punto <span class="math inline">\(x\)</span> se calcula como sigue:</li>
</ol>
<ul>
<li>Calculamos el tamaño de la proyección <span class="math inline">\(x\)</span> sobre <span class="math inline">\(v\)</span></li>
<li>Dividimos este tamaño entre <span class="math inline">\(r\)</span></li>
<li>el hash la parte entera de este último número</li>
</ul>
<p>Es decir,
<span class="math display">\[h(x) = \left\lfloor{ \frac{x\cdot v}{r}}\right\rfloor\]</span></p>
<p><strong>Ejercicio</strong>: haz un dibujo de este proceso, y cómo se calcula el hash de un punto
<span class="math inline">\(x\)</span> una
vez que tienes <span class="math inline">\(r\)</span> y <span class="math inline">\(v\)</span>.</p>
<p>Por ejemplo, si <span class="math inline">\(v=(1,2)\)</span>, y <span class="math inline">\(r = 1\)</span>:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="similitud.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb207-2"><a href="similitud.html#cb207-2" aria-hidden="true" tabindex="-1"></a>norma <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb207-3"><a href="similitud.html#cb207-3" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>) <span class="sc">/</span> <span class="fu">norma</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb207-4"><a href="similitud.html#cb207-4" aria-hidden="true" tabindex="-1"></a>v</span></code></pre></div>
<pre><code>## [1] 0.447 0.894</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="similitud.html#cb209-1" aria-hidden="true" tabindex="-1"></a>hash_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">floor</span>(<span class="fu">sum</span>(x <span class="sc">*</span> v) <span class="sc">/</span> <span class="dv">1</span>)</span>
<span id="cb209-2"><a href="similitud.html#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hash_1</span>(<span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">0</span>))</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="similitud.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hash_1</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="sc">-</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## [1] -1</code></pre>
<p>Construimos ahora nuestra función generadora de hashes:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="similitud.html#cb213-1" aria-hidden="true" tabindex="-1"></a>gen_hash <span class="ot">&lt;-</span> <span class="cf">function</span>(p, r){</span>
<span id="cb213-2"><a href="similitud.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(p)</span>
<span id="cb213-3"><a href="similitud.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> v <span class="sc">/</span> <span class="fu">norma</span>(v)</span>
<span id="cb213-4"><a href="similitud.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># devolvemos una función que calcula la cubeta:</span></span>
<span id="cb213-5"><a href="similitud.html#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x){</span>
<span id="cb213-6"><a href="similitud.html#cb213-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">floor</span>(<span class="fu">sum</span>(x <span class="sc">*</span> v) <span class="sc">/</span> r) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>()</span>
<span id="cb213-7"><a href="similitud.html#cb213-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb213-8"><a href="similitud.html#cb213-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb213-9"><a href="similitud.html#cb213-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">823</span>)</span>
<span id="cb213-10"><a href="similitud.html#cb213-10" aria-hidden="true" tabindex="-1"></a>hash_1 <span class="ot">&lt;-</span> <span class="fu">gen_hash</span>(<span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb213-11"><a href="similitud.html#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="co"># los hashes de dos puntos:</span></span>
<span id="cb213-12"><a href="similitud.html#cb213-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hash_1</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">7</span>))</span></code></pre></div>
<pre><code>## [1] -7</code></pre>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="similitud.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hash_1</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">7</span>))</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="similitud.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># el vector que escogimos es</span></span>
<span id="cb217-2"><a href="similitud.html#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">environment</span>(hash_1)<span class="sc">$</span>v</span></code></pre></div>
<pre><code>## [1] -0.914 -0.405</code></pre>
<div id="ejemplo-11" class="section level4 unnumbered">
<h4>Ejemplo</h4>
<p>La siguiente función genera dos clusters de puntos mezclados con puntos distribuidos
normales con desviación estándar relativamente grande</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="similitud.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1021</span>)</span>
<span id="cb219-2"><a href="similitud.html#cb219-2" aria-hidden="true" tabindex="-1"></a>simular_puntos <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">d =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">200</span>){</span>
<span id="cb219-3"><a href="similitud.html#cb219-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#puntos muy cercanos a (3,3,..., 3):</span></span>
<span id="cb219-4"><a href="similitud.html#cb219-4" aria-hidden="true" tabindex="-1"></a>  mat_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">10</span> <span class="sc">*</span> d, <span class="at">sd =</span> <span class="fl">0.01</span>) <span class="sc">+</span> <span class="dv">3</span>, <span class="at">ncol =</span> d)</span>
<span id="cb219-5"><a href="similitud.html#cb219-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">#puntos muy cercanos a (-3,-3,..., -3):</span></span>
<span id="cb219-6"><a href="similitud.html#cb219-6" aria-hidden="true" tabindex="-1"></a>  mat_2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">10</span> <span class="sc">*</span> d, <span class="at">sd =</span> <span class="fl">0.01</span>) <span class="sc">-</span> <span class="dv">3</span>, <span class="at">ncol =</span> d)</span>
<span id="cb219-7"><a href="similitud.html#cb219-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># puntos distribuidos alrededor del origen:</span></span>
<span id="cb219-8"><a href="similitud.html#cb219-8" aria-hidden="true" tabindex="-1"></a>  mat_3 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> d, <span class="at">sd =</span> <span class="dv">10</span>), <span class="at">ncol =</span> d)</span>
<span id="cb219-9"><a href="similitud.html#cb219-9" aria-hidden="true" tabindex="-1"></a>  datos_tbl_vars <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mat_3, mat_1, mat_2)  <span class="sc">|&gt;</span> </span>
<span id="cb219-10"><a href="similitud.html#cb219-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb219-11"><a href="similitud.html#cb219-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">id_1 =</span> <span class="fu">row_number</span>())</span>
<span id="cb219-12"><a href="similitud.html#cb219-12" aria-hidden="true" tabindex="-1"></a>  datos_tbl_vars</span>
<span id="cb219-13"><a href="similitud.html#cb219-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb219-14"><a href="similitud.html#cb219-14" aria-hidden="true" tabindex="-1"></a><span class="co"># diez puntos en cluster 1, diez en cluster 2, y 100 sin cluster:</span></span>
<span id="cb219-15"><a href="similitud.html#cb219-15" aria-hidden="true" tabindex="-1"></a>datos_tbl_vars <span class="ot">&lt;-</span> <span class="fu">simular_puntos</span>(<span class="at">d =</span> <span class="dv">2</span>, <span class="at">n =</span> <span class="dv">100</span>)</span></code></pre></div>
<pre><code>## Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if `.name_repair` is omitted as of tibble 2.0.0.
## Using compatibility `.name_repair`.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="similitud.html#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datos_tbl_vars, <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y=</span> V2)) <span class="sc">+</span> </span>
<span id="cb221-2"><a href="similitud.html#cb221-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">height =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="02-similitud-1_files/figure-html/unnamed-chunk-45-1.png" width="384" /></p>
<p>Para este ejemplo calculamos las distancias reales:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="similitud.html#cb222-1" aria-hidden="true" tabindex="-1"></a>dist_e <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y){</span>
<span id="cb222-2"><a href="similitud.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">norma</span>(x <span class="sc">-</span> y)</span>
<span id="cb222-3"><a href="similitud.html#cb222-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb222-4"><a href="similitud.html#cb222-4" aria-hidden="true" tabindex="-1"></a>datos_tbl <span class="ot">&lt;-</span> datos_tbl_vars <span class="sc">|&gt;</span></span>
<span id="cb222-5"><a href="similitud.html#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>id_1, <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;valor&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb222-6"><a href="similitud.html#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_1) <span class="sc">|&gt;</span></span>
<span id="cb222-7"><a href="similitud.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(variable) <span class="sc">|&gt;</span></span>
<span id="cb222-8"><a href="similitud.html#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">vec_1 =</span> <span class="fu">list</span>(valor))</span>
<span id="cb222-9"><a href="similitud.html#cb222-9" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb222-10"><a href="similitud.html#cb222-10" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="ot">&lt;-</span> datos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb222-11"><a href="similitud.html#cb222-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">crossing</span>(datos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb222-12"><a href="similitud.html#cb222-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rename</span>(<span class="at">id_2 =</span> id_1, <span class="at">vec_2 =</span> vec_1)) <span class="sc">|&gt;</span></span>
<span id="cb222-13"><a href="similitud.html#cb222-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(id_1 <span class="sc">&lt;</span> id_2) <span class="sc">|&gt;</span></span>
<span id="cb222-14"><a href="similitud.html#cb222-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">map2_dbl</span>(vec_1, vec_2, dist_e))</span>
<span id="cb222-15"><a href="similitud.html#cb222-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.027   0.000   0.027</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="similitud.html#cb224-1" aria-hidden="true" tabindex="-1"></a>pares_tbl <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##    id_1 vec_1      id_2 vec_2      dist
##   &lt;int&gt; &lt;list&gt;    &lt;int&gt; &lt;list&gt;    &lt;dbl&gt;
## 1     1 &lt;dbl [2]&gt;     2 &lt;dbl [2]&gt;  7.07
## 2     1 &lt;dbl [2]&gt;     3 &lt;dbl [2]&gt; 24.2 
## 3     1 &lt;dbl [2]&gt;     4 &lt;dbl [2]&gt; 29.0 
## 4     1 &lt;dbl [2]&gt;     5 &lt;dbl [2]&gt; 24.9 
## 5     1 &lt;dbl [2]&gt;     6 &lt;dbl [2]&gt;  3.31
## 6     1 &lt;dbl [2]&gt;     7 &lt;dbl [2]&gt; 16.2</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="similitud.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(pares_tbl)</span></code></pre></div>
<pre><code>## [1] 7140</code></pre>
<p>Supongamos que queremos encontrar los puntos que están a distancia menor a 1:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="similitud.html#cb228-1" aria-hidden="true" tabindex="-1"></a>pares_sim <span class="ot">&lt;-</span> pares_tbl <span class="sc">|&gt;</span> <span class="fu">filter</span>(dist <span class="sc">&lt;</span> <span class="dv">1</span>)</span>
<span id="cb228-2"><a href="similitud.html#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(pares_sim)</span></code></pre></div>
<pre><code>## [1] 103</code></pre>
<p>Ahora veremos cómo encontrar estos 103 pares de puntos cercanos.</p>
</div>
<div id="cálculo-de-firmas" class="section level4 unnumbered">
<h4>Cálculo de firmas</h4>
<p>Usaremos 4 hashes con tamaño de cubeta = 0.2:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="similitud.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co">#generar hashes</span></span>
<span id="cb230-2"><a href="similitud.html#cb230-2" aria-hidden="true" tabindex="-1"></a>hash_f <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="sc">~</span> <span class="fu">gen_hash</span>(<span class="at">p =</span> <span class="dv">2</span>,  <span class="at">r =</span> <span class="fl">0.2</span>))</span>
<span id="cb230-3"><a href="similitud.html#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="co"># esta es una función de conveniencia:</span></span>
<span id="cb230-4"><a href="similitud.html#cb230-4" aria-hidden="true" tabindex="-1"></a>calculador_hashes <span class="ot">&lt;-</span> <span class="cf">function</span>(hash_f){</span>
<span id="cb230-5"><a href="similitud.html#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(z) {</span>
<span id="cb230-6"><a href="similitud.html#cb230-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">map_int</span>(hash_f, <span class="sc">~</span> <span class="fu">.x</span>(z))</span>
<span id="cb230-7"><a href="similitud.html#cb230-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb230-8"><a href="similitud.html#cb230-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-9"><a href="similitud.html#cb230-9" aria-hidden="true" tabindex="-1"></a>calc_hashes <span class="ot">&lt;-</span> <span class="fu">calculador_hashes</span>(hash_f)</span></code></pre></div>
<p>Calculamos las firmas:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="similitud.html#cb231-1" aria-hidden="true" tabindex="-1"></a>firmas_tbl <span class="ot">&lt;-</span> datos_tbl_vars <span class="sc">|&gt;</span> </span>
<span id="cb231-2"><a href="similitud.html#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>id_1, <span class="at">names_to =</span> <span class="st">&quot;variable&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;valor&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb231-3"><a href="similitud.html#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_1) <span class="sc">|&gt;</span> </span>
<span id="cb231-4"><a href="similitud.html#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">vec_1 =</span> <span class="fu">list</span>(valor)) <span class="sc">|&gt;</span> </span>
<span id="cb231-5"><a href="similitud.html#cb231-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">firma =</span> <span class="fu">map</span>(vec_1, <span class="sc">~</span> <span class="fu">calc_hashes</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb231-6"><a href="similitud.html#cb231-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id_1, firma)</span>
<span id="cb231-7"><a href="similitud.html#cb231-7" aria-hidden="true" tabindex="-1"></a>firmas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 120 × 2
##     id_1 firma    
##    &lt;int&gt; &lt;list&gt;   
##  1     1 &lt;int [4]&gt;
##  2     2 &lt;int [4]&gt;
##  3     3 &lt;int [4]&gt;
##  4     4 &lt;int [4]&gt;
##  5     5 &lt;int [4]&gt;
##  6     6 &lt;int [4]&gt;
##  7     7 &lt;int [4]&gt;
##  8     8 &lt;int [4]&gt;
##  9     9 &lt;int [4]&gt;
## 10    10 &lt;int [4]&gt;
## # … with 110 more rows</code></pre>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="similitud.html#cb233-1" aria-hidden="true" tabindex="-1"></a>firmas_tbl<span class="sc">$</span>firma[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] -88  14  14 -87</code></pre>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="similitud.html#cb235-1" aria-hidden="true" tabindex="-1"></a>firmas_tbl<span class="sc">$</span>firma[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] -91  48  48 -92</code></pre>
<p>Para este ejemplo, consideraremos todos los pares que coinciden en al menos una cubeta
(hacemos disyunción o construcción OR de los 4 hashes):</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="similitud.html#cb237-1" aria-hidden="true" tabindex="-1"></a>cubetas_tbl  <span class="ot">&lt;-</span> firmas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb237-2"><a href="similitud.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(firma) <span class="sc">|&gt;</span> </span>
<span id="cb237-3"><a href="similitud.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_1) <span class="sc">|&gt;</span> </span>
<span id="cb237-4"><a href="similitud.html#cb237-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hash_no =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">|&gt;</span> </span>
<span id="cb237-5"><a href="similitud.html#cb237-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cubeta =</span> <span class="fu">paste</span>(hash_no, firma, <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>))</span>
<span id="cb237-6"><a href="similitud.html#cb237-6" aria-hidden="true" tabindex="-1"></a>cubetas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 480 × 4
## # Groups:   id_1 [120]
##     id_1 firma hash_no cubeta
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt; 
##  1     1   -88       1 1/-88 
##  2     1    14       2 2/14  
##  3     1    14       3 3/14  
##  4     1   -87       4 4/-87 
##  5     2   -91       1 1/-91 
##  6     2    48       2 2/48  
##  7     2    48       3 3/48  
##  8     2   -92       4 4/-92 
##  9     3   -24       1 1/-24 
## 10     3    88       2 2/88  
## # … with 470 more rows</code></pre>
<p>Ahora agrupamos cubetas y filtramos las que tienen más de un elemento</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="similitud.html#cb239-1" aria-hidden="true" tabindex="-1"></a>cubetas_tbl <span class="ot">&lt;-</span> cubetas_tbl <span class="sc">|&gt;</span> <span class="fu">group_by</span>(cubeta) <span class="sc">|&gt;</span> </span>
<span id="cb239-2"><a href="similitud.html#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ids =</span> <span class="fu">list</span>(id_1), <span class="at">n =</span> <span class="fu">length</span>(id_1)) <span class="sc">|&gt;</span> </span>
<span id="cb239-3"><a href="similitud.html#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb239-4"><a href="similitud.html#cb239-4" aria-hidden="true" tabindex="-1"></a>cubetas_tbl</span></code></pre></div>
<pre><code>## # A tibble: 79 × 3
##    cubeta ids            n
##    &lt;chr&gt;  &lt;list&gt;     &lt;int&gt;
##  1 1/-1   &lt;int [2]&gt;      2
##  2 1/-13  &lt;int [2]&gt;      2
##  3 1/-16  &lt;int [4]&gt;      4
##  4 1/-21  &lt;int [11]&gt;    11
##  5 1/-28  &lt;int [2]&gt;      2
##  6 1/-32  &lt;int [2]&gt;      2
##  7 1/-41  &lt;int [2]&gt;      2
##  8 1/-44  &lt;int [2]&gt;      2
##  9 1/-54  &lt;int [2]&gt;      2
## 10 1/-55  &lt;int [2]&gt;      2
## # … with 69 more rows</code></pre>
<p>Y finalmente, extraemos los pares candidatos:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="similitud.html#cb241-1" aria-hidden="true" tabindex="-1"></a>candidatos_tbl <span class="ot">&lt;-</span> </span>
<span id="cb241-2"><a href="similitud.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  cubetas_tbl <span class="sc">|&gt;</span> </span>
<span id="cb241-3"><a href="similitud.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pares_cand =</span> <span class="fu">map</span>(ids, <span class="sc">~</span> <span class="fu">combn</span>(.x, <span class="dv">2</span>, <span class="at">simplify =</span> <span class="cn">FALSE</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb241-4"><a href="similitud.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cubeta, pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb241-5"><a href="similitud.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pares_cand) <span class="sc">|&gt;</span> </span>
<span id="cb241-6"><a href="similitud.html#cb241-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(pares_cand, <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb241-7"><a href="similitud.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cubeta) <span class="sc">|&gt;</span> </span>
<span id="cb241-8"><a href="similitud.html#cb241-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb241-9"><a href="similitud.html#cb241-9" aria-hidden="true" tabindex="-1"></a>candidatos_tbl</span></code></pre></div>
<pre><code>## # A tibble: 219 × 2
##    pares_cand_1 pares_cand_2
##           &lt;int&gt;        &lt;int&gt;
##  1           25           34
##  2           30           85
##  3            8           33
##  4            8           40
##  5            8           80
##  6           33           40
##  7           33           80
##  8           40           80
##  9          100          111
## 10          100          112
## # … with 209 more rows</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="similitud.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(candidatos_tbl)</span></code></pre></div>
<pre><code>## [1] 219</code></pre>
<p>En este caso, seguramente tenemos algunos falsos positivos que tenemos que
filtrar, y quizá algunos falsos negativos.</p>
<p>Calculamos distancias para todos los pares candidatos (es una lista
mucho más corta generalmente):</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="similitud.html#cb245-1" aria-hidden="true" tabindex="-1"></a>puntos_tbl <span class="ot">&lt;-</span> datos_tbl_vars <span class="sc">|&gt;</span> </span>
<span id="cb245-2"><a href="similitud.html#cb245-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(V1<span class="sc">:</span>V2) <span class="sc">|&gt;</span></span>
<span id="cb245-3"><a href="similitud.html#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id_1) <span class="sc">|&gt;</span> </span>
<span id="cb245-4"><a href="similitud.html#cb245-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">|&gt;</span> </span>
<span id="cb245-5"><a href="similitud.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">punto =</span> <span class="fu">list</span>(value))</span>
<span id="cb245-6"><a href="similitud.html#cb245-6" aria-hidden="true" tabindex="-1"></a>candidatos_tbl <span class="ot">&lt;-</span> </span>
<span id="cb245-7"><a href="similitud.html#cb245-7" aria-hidden="true" tabindex="-1"></a>  candidatos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb245-8"><a href="similitud.html#cb245-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(puntos_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_1 =</span> id_1, <span class="at">punto_1 =</span> punto)) <span class="sc">|&gt;</span> </span>
<span id="cb245-9"><a href="similitud.html#cb245-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(puntos_tbl <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pares_cand_2 =</span> id_1, <span class="at">punto_2 =</span> punto))</span></code></pre></div>
<pre><code>## Joining, by = &quot;pares_cand_1&quot;</code></pre>
<pre><code>## Joining, by = &quot;pares_cand_2&quot;</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="similitud.html#cb248-1" aria-hidden="true" tabindex="-1"></a>candidatos_tbl</span></code></pre></div>
<pre><code>## # A tibble: 219 × 4
##    pares_cand_1 pares_cand_2 punto_1   punto_2  
##           &lt;int&gt;        &lt;int&gt; &lt;list&gt;    &lt;list&gt;   
##  1           25           34 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  2           30           85 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  3            8           33 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  4            8           40 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  5            8           80 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  6           33           40 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  7           33           80 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  8           40           80 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
##  9          100          111 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
## 10          100          112 &lt;dbl [2]&gt; &lt;dbl [2]&gt;
## # … with 209 more rows</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="similitud.html#cb250-1" aria-hidden="true" tabindex="-1"></a>pares_similares_tbl <span class="ot">&lt;-</span> </span>
<span id="cb250-2"><a href="similitud.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  candidatos_tbl <span class="sc">|&gt;</span> </span>
<span id="cb250-3"><a href="similitud.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">map2_dbl</span>(punto_1, punto_2, dist_e)) <span class="sc">|&gt;</span> </span>
<span id="cb250-4"><a href="similitud.html#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(dist <span class="sc">&lt;</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="similitud.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(pares_similares_tbl)</span></code></pre></div>
<pre><code>## [1] 96</code></pre>
</div>
<div id="probando-con-datos-de-gold-standard" class="section level4 unnumbered">
<h4>Probando con datos de “gold standard”</h4>
<p>En este caso, sabemos cuáles son los pares que buscamos, así que podemos
evaluar nuestro método:</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="similitud.html#cb253-1" aria-hidden="true" tabindex="-1"></a>verdadero_pos <span class="ot">&lt;-</span> <span class="fu">nrow</span>(<span class="fu">inner_join</span>(pares_similares_tbl, pares_sim))</span></code></pre></div>
<pre><code>## Joining, by = &quot;dist&quot;</code></pre>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="similitud.html#cb255-1" aria-hidden="true" tabindex="-1"></a>verdadero_pos</span></code></pre></div>
<pre><code>## [1] 96</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="similitud.html#cb257-1" aria-hidden="true" tabindex="-1"></a>sensibilidad <span class="ot">&lt;-</span> verdadero_pos <span class="sc">/</span> <span class="fu">nrow</span>(pares_sim)</span>
<span id="cb257-2"><a href="similitud.html#cb257-2" aria-hidden="true" tabindex="-1"></a>sensibilidad</span></code></pre></div>
<pre><code>## [1] 0.932</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="similitud.html#cb259-1" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> verdadero_pos <span class="sc">/</span> <span class="fu">nrow</span>(pares_similares_tbl)</span>
<span id="cb259-2"><a href="similitud.html#cb259-2" aria-hidden="true" tabindex="-1"></a>precision</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Como vemos, la precisión es 1 y la sensibilidad es alta.
Nos faltó encontrar una pequeña parte de los pares similares (alrededor de 7 de 103).</p>
<ul>
<li>Si queremos ser mas exhaustivos (con el mayor cómputo que implica), podemos
hacer más anchas las cubetas (cambiar <span class="math inline">\(r\)</span> a 1 por ejemplo), y podemos incluir
más hashes. ¿Qué pasa si ponemos <span class="math inline">\(r = 0.8\)</span> por ejemplo?</li>
</ul>

<div class="resumen">
<p><strong>Proyección aleatoria en cubetas.</strong></p>
Podemos encontrar pares muy similares en datos numéricos usando como hashes
proyecciones aleatorias discretizadas en cubetas. Para afinar el umbral de captura
y el balance de falsos positivos y falsos negativos, usamos las mismas técnicas
mencionadas arriba para minhashing (construcciones OR o AND y combinaciones).
</div>
</div>
</div>
<div id="locality-sensitive-hashing-lsh" class="section level2" number="3.10">
<h2><span class="header-section-number">3.10</span> Locality Sensitive Hashing (LSH)</h2>
<p>Las dos técnicas que acabamos de ver arriba son tipos de <em>Locality Sensitive Hashing</em> (LSH),
donde usamos hashes que tienden a coincidir cuando dos elementos son similares. Esto requiere de dos partes:</p>
<ol style="list-style-type: decimal">
<li>Una definición de distancia en el espacio original</li>
<li>Una familia de hashes que se seleccionan al azar que son sensibles a la localidad en relación a la distancia seleccionada, que formalmente podemos escribir como:</li>
</ol>

<div class="resumen">
Sean <span class="math inline">\(d_1&lt;d_2\)</span> dos valores (que interpretamos como distancias).
Una familia <span class="math inline">\({\cal F}\)</span> es una familia <span class="math inline">\(d_1,d_2,p_1,p_2\)</span>, sensible a localidad
(con <span class="math inline">\(p_1&gt;p_2\)</span>) cuando para cualquier par de elementos <span class="math inline">\(x,y\)</span>,
1. Si <span class="math inline">\(d(x,y)\leq d_1\)</span>, entonces la probabilidad <span class="math inline">\(P(f(x)=f(y))\geq p_1\)</span>.
2. Si <span class="math inline">\(d(x,y)\geq d_2\)</span>, entonces <span class="math inline">\(P(f(x)=f(y))\leq p_2\)</span>
Nótese que las probabilidades están dadas sobre la selección de <span class="math inline">\(f\)</span>.
</div>
<p>Estas condiciones se interpretan como sigue: cuando <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> están
suficientemente cerca (<span class="math inline">\(d_1\)</span>), la probabilidad de que sean mapeados al mismo valor
por una función <span class="math inline">\(f\)</span> de la familia es alta. Cuando <span class="math inline">\(x\)</span> y <span class="math inline">\(y\)</span> están lejos
<span class="math inline">\(d_2\)</span>, entonces, la probabilidad de que sean mapeados al mismo valor es baja.
Podemos ver una gráfica:</p>
<p><img src="02-similitud-1_files/figure-html/unnamed-chunk-62-1.png" width="384" />
En nuestros ejemplos, vimos (puedes intentar demostrarlas):</p>
<ol style="list-style-type: decimal">
<li>Para documentos, utilizamos distancia de Jaccard de tejas. Las funciones minhash dan
una familia sensible a la localidad.</li>
<li>Para datos numéricos con distancia euclideana, la familia de proyecciones aleatorias en cubetas das una familia sensible a la localidad</li>
<li>(Adicional) La similitud coseno para datos numéricos (donde no nos importa la magnitud sino solo la dirección de lso puntos), que se utiliza a veces en procesamiento de texto, también puede tratarse utilizando proyecciones aleatorias con 2 cubetas (derecha e izquierda)</li>
</ol>
<p>De esta última puedes ver más en <span class="citation"><a href="#ref-mmd" role="doc-biblioref">Leskovec, Rajaraman, and Ullman</a> (<a href="#ref-mmd" role="doc-biblioref">2014</a>)</span>.</p>
</div>
<div id="lsh-para-imágenes" class="section level2" number="3.11">
<h2><span class="header-section-number">3.11</span> LSH para imágenes</h2>
<p>Consideramos tres imágenes para probar:</p>
<p><img src="images/elefante_1.jpg" width="40%" /><img src="images/elefante_3.jpg" width="40%" /><img src="images/leon_1.jpg" width="40%" /></p>
<p>En espacios de dimensión muy alta, como en imágenes, conviene hacer reducción de dimensionalidad
para definir la métrica de distancia y utilizar estos métodos para encontrar vecinos cercanos.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="similitud.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(keras)</span>
<span id="cb261-2"><a href="similitud.html#cb261-2" aria-hidden="true" tabindex="-1"></a>modelo <span class="ot">&lt;-</span> <span class="fu">application_vgg16</span>(<span class="at">weights =</span> <span class="st">&#39;imagenet&#39;</span>)</span></code></pre></div>
<pre><code>## Loaded Tensorflow version 2.4.0</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="similitud.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># obtener la penúltima</span></span>
<span id="cb263-2"><a href="similitud.html#cb263-2" aria-hidden="true" tabindex="-1"></a>embed_modelo <span class="ot">&lt;-</span>  <span class="fu">keras_model</span>(<span class="at">inputs =</span> modelo<span class="sc">$</span>input, </span>
<span id="cb263-3"><a href="similitud.html#cb263-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">outputs =</span> <span class="fu">get_layer</span>(modelo, <span class="st">&quot;fc2&quot;</span>)<span class="sc">$</span>output)</span></code></pre></div>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="similitud.html#cb264-1" aria-hidden="true" tabindex="-1"></a>obtener_pixeles <span class="ot">&lt;-</span> <span class="cf">function</span>(imagen_ruta){</span>
<span id="cb264-2"><a href="similitud.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  img <span class="ot">&lt;-</span> <span class="fu">image_load</span>(imagen_ruta, <span class="at">target_size =</span> <span class="fu">c</span>(<span class="dv">224</span>,<span class="dv">224</span>))</span>
<span id="cb264-3"><a href="similitud.html#cb264-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">image_to_array</span>(img)</span>
<span id="cb264-4"><a href="similitud.html#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">array_reshape</span>(x, <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">dim</span>(x))) </span>
<span id="cb264-5"><a href="similitud.html#cb264-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb264-6"><a href="similitud.html#cb264-6" aria-hidden="true" tabindex="-1"></a>calcular_capa <span class="ot">&lt;-</span> <span class="cf">function</span>(imagen_ruta){</span>
<span id="cb264-7"><a href="similitud.html#cb264-7" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">obtener_pixeles</span>(imagen_ruta) <span class="sc">|&gt;</span> <span class="fu">imagenet_preprocess_input</span>()</span>
<span id="cb264-8"><a href="similitud.html#cb264-8" aria-hidden="true" tabindex="-1"></a>  embed_modelo <span class="sc">|&gt;</span>  <span class="fu">predict</span>(x) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb264-9"><a href="similitud.html#cb264-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb264-10"><a href="similitud.html#cb264-10" aria-hidden="true" tabindex="-1"></a>pixeles_1 <span class="ot">&lt;-</span> <span class="fu">obtener_pixeles</span>(<span class="st">&quot;../datos/imagenes/elefante_1.jpg&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb264-11"><a href="similitud.html#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb264-12"><a href="similitud.html#cb264-12" aria-hidden="true" tabindex="-1"></a>pixeles_2 <span class="ot">&lt;-</span> <span class="fu">obtener_pixeles</span>(<span class="st">&quot;../datos/imagenes/elefante_3.jpg&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb264-13"><a href="similitud.html#cb264-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb264-14"><a href="similitud.html#cb264-14" aria-hidden="true" tabindex="-1"></a>pixeles_3 <span class="ot">&lt;-</span> <span class="fu">obtener_pixeles</span>(<span class="st">&quot;../datos/imagenes/leon_1.jpg&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb264-15"><a href="similitud.html#cb264-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span></code></pre></div>
<p>Calculamos la distancia pixel a pixel:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="similitud.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((pixeles_2 <span class="sc">-</span> pixeles_1)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 7040</code></pre>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="similitud.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((pixeles_1 <span class="sc">-</span> pixeles_3)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 7064</code></pre>
<p>Calculamos la penúltima capa de nuestro modelo para las imágenes de prueba:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="similitud.html#cb269-1" aria-hidden="true" tabindex="-1"></a>features_1 <span class="ot">&lt;-</span> <span class="fu">calcular_capa</span>(<span class="st">&quot;../datos/imagenes/elefante_1.jpg&quot;</span>)</span>
<span id="cb269-2"><a href="similitud.html#cb269-2" aria-hidden="true" tabindex="-1"></a>features_2 <span class="ot">&lt;-</span> <span class="fu">calcular_capa</span>(<span class="st">&quot;../datos/imagenes/elefante_3.jpg&quot;</span>)</span>
<span id="cb269-3"><a href="similitud.html#cb269-3" aria-hidden="true" tabindex="-1"></a>features_3 <span class="ot">&lt;-</span> <span class="fu">calcular_capa</span>(<span class="st">&quot;../datos/imagenes/leon_1.jpg&quot;</span>)</span>
<span id="cb269-4"><a href="similitud.html#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(features_1)</span></code></pre></div>
<pre><code>## [1] 4096</code></pre>
<p>Nótese ahora que la distancia en nuestro nuevo espacio de imágenes
es mucho más chica para los elefantes que entre el león y los elefantes:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="similitud.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((features_2 <span class="sc">-</span> features_1)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.889</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="similitud.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((features_1 <span class="sc">-</span> features_3)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 3.2</code></pre>
<p>Podemos usar entonces el siguiente proceso:</p>
<ol style="list-style-type: decimal">
<li>Calculamos para cada imagen la representación dada por la última capa
de una red nueronal de clasificación para imagen.</li>
<li>Definimos como nuestra medida de distancia entre imagenes la distancia euclideana
en la representación del inciso anterior</li>
<li>Definimos funciones hash con proyecciones en cubetas como vimos arriba</li>
<li>Con estos hashes, podemos encontrar imagenes duplicadas o muy similares.</li>
</ol>
</div>
<div id="joins-por-similitud" class="section level2" number="3.12">
<h2><span class="header-section-number">3.12</span> Joins por similitud</h2>
<p>Otro uso de las técnicas del LSH nos permita hacer
uniones (<em>joins</em>) por similitud. La idea es la siguiente:</p>
<ul>
<li>Tenemos una tabla A, con una columna A.x que es un texto, por ejemplo, o un vector de números, etc.</li>
<li>Tenemos una tabla B, con una columna B.x que es del mismo tipo que A.x</li>
<li>Queremos hacer una unión de A con B con la llave x, de forma que
queden pareados todos los elementos tales que <span class="math inline">\(sim(A.x_i, A.y_j)\)</span> es chica.</li>
</ul>
<p>Un ejemplo es pegar dos tablas de datos de películas de
fuentes distintas mediante el título (que a veces varía en cómo está escrito, de manera que no podemos hacer un join usual), o títulos
de pláticas en diferentes conferencias, o juntar registros de personas que pueden tener
escrito su nombre de manera un poco diferente o con errores, netc.</p>
<p>Usando LSH podemos hacer un <em>join aproximado por similitud</em>. La
idea es la misma que antes:</p>
<ol style="list-style-type: decimal">
<li>Calculamos cubetas de la misma forma para cada tabla (mismos hashes y bandas)</li>
<li>Unimos las cubetas de las dos fuentes</li>
<li>Los pares candidatos son todos los pares (uno de A y uno de B) que
caen en la misma cubeta.</li>
<li>Usando criterios adicionales, podemos filtrar falsos positivos.</li>
</ol>
</div>
<div id="ejemplo-entity-matching" class="section level2" number="3.13">
<h2><span class="header-section-number">3.13</span> Ejemplo: entity matching</h2>
<p>Ver tarea 4 en el repositorio del curso.</p>

</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-mmd" class="csl-entry">
Leskovec, Jure, Anand Rajaraman, and Jeffrey David Ullman. 2014. <em>Mining of Massive Datasets</em>. 2nd ed. New York, NY, USA: Cambridge University Press. <a href="http://www.mmds.org">http://www.mmds.org</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="frecuentes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dvs-y-reducción-de-dimensionalidad.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/felipegonzalez/metodos-analiticos-mcd-2022/edit/master/notas/02-similitud-1.Rmd",
"text": "Editar"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
